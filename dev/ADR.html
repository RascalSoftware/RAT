
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Architectural Decision Records &#8212; RAT  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=7138875e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=881e7dcd"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ADR';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://rascalsoftware.github.io/RAT/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="RAT  documentation - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="RAT  documentation - Home"/>`);</script>
  
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="index.html">
                        Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="reference/matlab/index.html">
                        MATLAB API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="support.html">
                        Support
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="index.html">
                        Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="reference/matlab/index.html">
                        MATLAB API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="support.html">
                        Support
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Architectura...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="architectural-decision-records">
<span id="adr"></span><h1>Architectural Decision Records<a class="headerlink" href="#architectural-decision-records" title="Link to this heading">#</a></h1>
<section id="alexandrian-pattern">
<h2><strong>Alexandrian pattern</strong><a class="headerlink" href="#alexandrian-pattern" title="Link to this heading">#</a></h2>
<section id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Prologue (Summary)</p></li>
<li><p>Discussion (Context)</p></li>
<li><p>Solution (Decision)</p></li>
<li><p>Consequences (Results)</p></li>
</ul>
</section>
<section id="specifics">
<h3>Specifics<a class="headerlink" href="#specifics" title="Link to this heading">#</a></h3>
<ul>
<li><p>Prologue (Summary)</p>
<ul>
<li><p>Statement to summarize:</p>
<ul>
<li><div class="line-block">
<div class="line">In the context of (use case)</div>
<div class="line">facing (concern)</div>
<div class="line">we decided for (option)</div>
<div class="line">to achieve (quality)</div>
<div class="line">accepting (downside).</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Discussion (Context)</p>
<ul class="simple">
<li><p>Explain the forces at play (technical, political, social,
project).</p></li>
<li><p>This is the story explaining the problem we are looking to
resolve.</p></li>
</ul>
</li>
<li><p>Solution</p>
<ul class="simple">
<li><p>Explain how the decision will solve the problem.</p></li>
</ul>
</li>
<li><p>Consequences</p>
<ul class="simple">
<li><p>Explain the results of the decision over the long term.</p></li>
<li><p>Did it work, not work, was changed, upgraded, etc.</p></li>
</ul>
</li>
</ul>
<p><strong>TLDR: This record contains justifications, reasons as to why something
had to be done, the way it was done, and how to improve on it (as of
July 2022)</strong></p>
</section>
</section>
<section id="decision-record-1-using-anvil-as-a-webhook-and-pull-request-trigger-for-merge-checks">
<h2>Decision Record 1: Using Anvil as a webhook and Pull Request trigger for merge checks<a class="headerlink" href="#decision-record-1-using-anvil-as-a-webhook-and-pull-request-trigger-for-merge-checks" title="Link to this heading">#</a></h2>
<section id="introduction-1">
<span id="id1"></span><h3>Introduction<a class="headerlink" href="#introduction-1" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://anvil.softeng-support.ac.uk/">Anvil</a> is a research software
testing platform built by STFC (Science and Technology Facilities
Council) to run tests on a range of platforms in an automated manner.
Anvil is based on Jenkins, a famous DevOps tool, which helps to automate
the mundane tasks of running tests, compilation, etc.</p>
<p>RAT Toolbox is a CLI application in MATLAB which needs a test suite in
an automated manner and Jenkins proved to be a worthy tool for this job
after talks between Lamar, Martyn and Arwel.</p>
<p>With Anvil being run on Jenkins, it is decided that Anvil is an
excellent choice to manage the webhooks and merge checks.</p>
</section>
<section id="specifics-1">
<span id="id2"></span><h3>Specifics<a class="headerlink" href="#specifics-1" title="Link to this heading">#</a></h3>
<section id="discussion">
<h4>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h4>
<p>RAT Toolbox is going to be an open-source data analysis software for
Neutron Reflectivity calculations. Once it has become public, it
attracts a wide range of contributors, especially on GitHub. It is
important that the contributors follow certain instructions to NOT break
the code. To ensure that, every time a contributor tries to commit code
into the repository through a pull request, it is decided that the
repository needs to be put through a series of automated tasks to ensure
nothing has been changed in a way that could break the code or result in
unexpected outputs.</p>
</section>
<section id="solution">
<h4>Solution<a class="headerlink" href="#solution" title="Link to this heading">#</a></h4>
<p>The whole thing can be automated using a Jenkins pipeline with Anvil as
a trigger and manager for the webhooks and pull requests, respectively.
Anvil is available to GitHub repositories as a GitHub App that can be
‘downloaded’ into desired repositories from GitHub Marketplace. This
allows Anvil to have proper rights and settings to tether the Pull
Requests to an instance of Jenkins that builds the job in a freshly
created Virtual Machine to make sure everything works in order.</p>
</section>
</section>
<section id="consequences">
<h3>Consequences<a class="headerlink" href="#consequences" title="Link to this heading">#</a></h3>
<p>This idea seems to be working very well for now and the foreseeable
future as long as Anvil and its dependencies (STFC Cloud) are also
functional. Although, occasional system-wide shutdown causes disruptions
in availability of the nodes in which case developer needs to manually
login to the machine to ssh back to the Jenkins instance of Anvil.
Contact Alan Kyffin for more details on this.</p>
</section>
</section>
<section id="decision-record-2-converting-matlab-code-to-c">
<h2>Decision Record 2: Converting MATLAB code to C++<a class="headerlink" href="#decision-record-2-converting-matlab-code-to-c" title="Link to this heading">#</a></h2>
<section id="introduction-2">
<span id="id3"></span><h3>Introduction<a class="headerlink" href="#introduction-2" title="Link to this heading">#</a></h3>
<p>RAT is made of MATLAB and so was RasCal. Arwel decided to introduce some
major performance upgrades to RAT by converting MATLAB code base to C++.
A MATLAB app called MATLAB Coder can be used to automatically convert
the MATLAB code into C++ as opposed to the mundane task of
hand-scripting MATLAB to C++.</p>
</section>
<section id="specifics-2">
<span id="id4"></span><h3>Specifics<a class="headerlink" href="#specifics-2" title="Link to this heading">#</a></h3>
<p>“C++ averages a processing speed that is over <strong>500 times</strong> faster than
Matlab code. Not only does this apply for this code, but this can also
be applied for any other code comparison between Matlab and C++
MEX-files “ (<a class="reference external" href="https://core.ac.uk/download/pdf/19152615.pdf">Andrews</a>)</p>
<p>To be able to use C++ MEX files, MATLAB coder can integrate the
generated code into the projects as source code, static libraries, or
dynamic libraries. The generated code can also be packaged as a
MEX-function for use in MATLAB. Moreover, the generated code is readable
and portable.</p>
</section>
<section id="consequences-1">
<span id="id5"></span><h3>Consequences<a class="headerlink" href="#consequences-1" title="Link to this heading">#</a></h3>
<p>MATLAB coder is a fantastic way to do this task, especially with great
technical support from MathWorks. <strong>Improved speed but introduced a
little bit of complexity to the code.</strong> This could be a stable,
long-standing approach to converting MATLAB code to C++, but more
efficient converters could be on their way, especially with OpenAI’s
<a class="reference external" href="https://www.infoq.com/news/2021/08/openai-codex/">Codex models</a></p>
</section>
</section>
<section id="decision-record-3-using-matlabs-project-environment-for-internal-matlab-workflow">
<h2>Decision Record 3: Using MATLAB’s Project environment for internal MATLAB workflow<a class="headerlink" href="#decision-record-3-using-matlabs-project-environment-for-internal-matlab-workflow" title="Link to this heading">#</a></h2>
<section id="introduction-3">
<span id="id6"></span><h3>Introduction<a class="headerlink" href="#introduction-3" title="Link to this heading">#</a></h3>
<p>MATLAB’s Project is a scalable environment where one can manage,
customize tasks, put all the files in one place and use version control
from MATLAB. Using such an environment can help reduce time and effort
in simple tasks like running tests, checks etc. So, Arwel and Sethu has
decided to make use of this by putting RAT into this scalable project
environment.</p>
</section>
<section id="specifics-3">
<span id="id7"></span><h3>Specifics<a class="headerlink" href="#specifics-3" title="Link to this heading">#</a></h3>
<p>RAT has many folders with many files in it. Project environment has a
dependency checker which analyses the relations between all the folders
and it also helps prevent unexpected folder/file ‘moves’ which might
bring dependency issues. Moreover, the Project environment can run tests
which is useful, especially while working with the DevOps side. It can
ease the process of code generation since selected files can do selected
tasks. RAT has a file which adds folders to the path so that they can be
accessed straight away while a program is running but this is a manual
task. With the Project environment, the task can be automated using a
startup file that does whatever needs to be done when the Project
environment is instantiated. MATLAB Coder can directly accept a .prj
(project file similar file type for Matlab Coder) and convert desired
files to C++.</p>
</section>
<section id="consequences-2">
<span id="id8"></span><h3>Consequences<a class="headerlink" href="#consequences-2" title="Link to this heading">#</a></h3>
<p>The Project environment eases many mundane tasks hence enabling
automation and solving the problem of adding paths in a separate file
and updating it as new files are being added. The Project environment is
a relatively new feature from MATLAB, with time it can only get better
and assist RAT with more useful tools.</p>
<p><strong>Update</strong>: The Project does get complicated especially if a developer
pushes one commit from the Project environment (GUI) which is,
surprising, highly recommended and the other from the command line. It
gets even worse as multiple commits from multiple people follow the
same. This would cause problems of merge conflicts if one were not
careful.</p>
<p><strong>Update</strong>:</p>
<p>Project env has been removed since it is too underdeveloped/too messy to
act as a rigid base for version control and continuous integration. It
is very prone to merge conflicts. Especially, when working from
different OS.</p>
</section>
</section>
<section id="decision-record-4-enabling-users-to-use-custom-scripts-from-multiple-languages">
<h2>Decision Record 4: Enabling users to use custom scripts from multiple languages<a class="headerlink" href="#decision-record-4-enabling-users-to-use-custom-scripts-from-multiple-languages" title="Link to this heading">#</a></h2>
<section id="introduction-4">
<span id="id9"></span><h3>Introduction<a class="headerlink" href="#introduction-4" title="Link to this heading">#</a></h3>
<p>The idea of custom scripts is a jail-break way of achieving extreme
flexibility in terms of data analysis of desired inputs. Having the
flexibility of being able to support languages like python, MATLAB and
C++ really multiplies the users and also provides the feasibility of
adapting to new features by simply adding those corresponding libraries
to the code base. Irrespective of the language used, the compiler adapts
to the language and automatically manages the compatibility issues.</p>
</section>
<section id="why">
<h3><strong>Why</strong><a class="headerlink" href="#why" title="Link to this heading">#</a></h3>
<p>Flexibility. A user does not have to code in an unfamiliar language to
use the software. Also, increases the user base.</p>
</section>
<section id="id10">
<h3>Specifics<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>As of July 2022, RAT supports 2 famous languages for the custom models
feature. Matlab and C++. The way it works is as follows:</p>
<ol class="arabic simple">
<li><p>Converting user’s cpp file into a .dll or .so dynamic lib (in short)</p></li>
<li><p>Using an open-source project called dylib to help extract the user
function from the dynamic library made by user and then pass the
inputs to that. (Check dev docs for more)</p></li>
<li><p>Get the outputs back.</p></li>
</ol>
</section>
<section id="future">
<h3>Future<a class="headerlink" href="#future" title="Link to this heading">#</a></h3>
<p>There are plans to add Python to the list of supported languages once
the current iteration is stable enough.</p>
</section>
</section>
<section id="decision-record-5-increasing-error-tolerance-to-ignore-the-slight-differences-in-mex-functions-in-unit-tests">
<h2>Decision Record 5: Increasing Error Tolerance to ignore the slight differences in Mex functions in Unit Tests<a class="headerlink" href="#decision-record-5-increasing-error-tolerance-to-ignore-the-slight-differences-in-mex-functions-in-unit-tests" title="Link to this heading">#</a></h2>
<section id="introduction-5">
<span id="id11"></span><h3>Introduction<a class="headerlink" href="#introduction-5" title="Link to this heading">#</a></h3>
<p>There was an error just beyond the RelTol (relative tolerance) limit set
by Arwel which is 4.44089209850063e-15. There are 3 test cases that
crossed the tolerance limit. One of the failed tests has an error of
1.30104260698261e-17.</p>
</section>
<section id="id12">
<h3><strong>Why</strong><a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<p>Such micro-errors may creep in from compilers and may vary by OS
(Operating System) as well. Since the current experience with error
tolerances is too limited, the ideal tolerance shall be set in the later
stages of development.</p>
</section>
<section id="how">
<h3><strong>How</strong><a class="headerlink" href="#how" title="Link to this heading">#</a></h3>
<p>The tolerances can be set for each test file in the testSuite folder of
the RAT home directory. Tolerances can also be set by each test as well.
This gives flexibility if one of the functions acts mysteriously.</p>
</section>
</section>
<section id="decision-record-6-use-c-api-to-manage-custom-scripts-instead-of-c-api-for-matlab-and-back-to-c">
<h2>Decision Record 6: Use C API to manage custom scripts instead of C++ API for Matlab and back to C++<a class="headerlink" href="#decision-record-6-use-c-api-to-manage-custom-scripts-instead-of-c-api-for-matlab-and-back-to-c" title="Link to this heading">#</a></h2>
<div class="line-block">
<div class="line"><strong>Introduction</strong></div>
</div>
<div class="line-block">
<div class="line">The whole RAT toolbox is <em>technically a</em> C++ codebase and in order to
manage custom scripts from users, the RAT needs to talk to the user
script’s language and make a connection to seek the variables from the
script.</div>
</div>
<section id="history">
<h3>History<a class="headerlink" href="#history" title="Link to this heading">#</a></h3>
<p>At first, Arwel and Sethu decided to create a C++ class that constructs
MATLAB Engine pointer which can be referenced to a feval() command to
exercise in MATLAB workspace. This feature helps us exercise user’s
scripts and get them back to C++. The problem with this approach is that
MATLAB Coder is internally embedded with MATLAB Data array and <em>these
classes are really bad when we include engine.h as a header in our C++.</em>
A total week of trying to make it work in multiple only concluded that
the approach is impossible.</p>
<div class="line-block">
<div class="line">As a plan B, Arwel suggested Sethu to create a class that inherits
from Handle class. This MATLAB class creates an instance of MATLAB
Engine which can started,closed and used to execute a MATLAB function.
This superficially looks absurd especially with executing MATLAB from
MATLAB but the main reason to do this was to have the Handle class
converted to a pointer with Coder’s help. Sethu and Arwel got to a
really good stage with this and then one fine morning, Arwel found out
that the MATLAB coder allows only one instance of handle class to go
through which means we cannot parallelize over multiple instances.
This meant we could not use the MATLAB class anymore.</div>
<div class="line">This brought us to a new blended idea of using C function in C++ to
eliminate the need for MATLAB in between. This is currently being
worked on but god help us.</div>
</div>
</section>
<section id="update">
<h3>Update:<a class="headerlink" href="#update" title="Link to this heading">#</a></h3>
<p>God did help us. This method didn’t work out but this work can be used
to compile RAT successfully! (A diff use currently being planned)</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alexandrian-pattern"><strong>Alexandrian pattern</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifics">Specifics</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-record-1-using-anvil-as-a-webhook-and-pull-request-trigger-for-merge-checks">Decision Record 1: Using Anvil as a webhook and Pull Request trigger for merge checks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-1">Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifics-1">Specifics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">Solution</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#consequences">Consequences</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-record-2-converting-matlab-code-to-c">Decision Record 2: Converting MATLAB code to C++</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-2">Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifics-2">Specifics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#consequences-1">Consequences</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-record-3-using-matlabs-project-environment-for-internal-matlab-workflow">Decision Record 3: Using MATLAB’s Project environment for internal MATLAB workflow</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-3">Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifics-3">Specifics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#consequences-2">Consequences</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-record-4-enabling-users-to-use-custom-scripts-from-multiple-languages">Decision Record 4: Enabling users to use custom scripts from multiple languages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-4">Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why"><strong>Why</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Specifics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#future">Future</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-record-5-increasing-error-tolerance-to-ignore-the-slight-differences-in-mex-functions-in-unit-tests">Decision Record 5: Increasing Error Tolerance to ignore the slight differences in Mex functions in Unit Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-5">Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12"><strong>Why</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how"><strong>How</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-record-6-use-c-api-to-manage-custom-scripts-instead-of-c-api-for-matlab-and-back-to-c">Decision Record 6: Use C API to manage custom scripts instead of C++ API for Matlab and back to C++</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#history">History</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update">Update:</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/ADR.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022-2024, ISIS Neutron and Muon Source.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>

<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Custom Models &#8212; RAT  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=7138875e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=881e7dcd"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/customModels';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://rascalsoftware.github.io/RAT/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Saving Your Work (working with classes)" href="savingAndClasses.html" />
    <link rel="prev" title="A Closer Look at the Controls Class" href="controlsInfo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="RAT  documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="RAT  documentation - Home"/>`);</script>
  
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../index.html">
                        Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/matlab/index.html">
                        MATLAB API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../support.html">
                        Support
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../index.html">
                        Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/matlab/index.html">
                        MATLAB API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../support.html">
                        Support
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="chapter1.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="chapter2.html">The Problem Definition Input Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="controlsInfo.html">A Closer Look at the Controls Class</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Custom Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="savingAndClasses.html">Saving Your Work (working with classes)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../algorithms/index.html">Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../algorithms/simplex.html">Nelder-Mead Simplex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algorithms/DE.html">Differential Evolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algorithms/DREAM.html">Bayesian Analysis - DREAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algorithms/nestedSampling.html">Bayesian Model Selection - Nested Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algorithms/paramonte.html">The Paramonte Sampler</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced/index.html">Advanced Topics</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced/resampling.html">Profile Resampling (‘microslicing’)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/parallelisation.html">Parallelising Calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/customLanguages.html">Custom Models in Python or C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/events.html">Handling Events During Calculations</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../calcTypes/index.html">Different Calculation Types</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../calcTypes/imaginary.html">Adding the Imaginary Refractive Index</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../calcTypes/incoherent.html">Incoherent Summing (Domains)</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../calcTypes/domainsStanlay.html">Standard Layers Domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calcTypes/domainsCustomModels.html">Custom Models with Domains</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../utilities/index.html">Utility Functions</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilities/plotFuns.html">Basic Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/plotFunsBayes.html">Plotting Bayesian Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/livePlot.html">Live Updating Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/conversionFuncs.html">Convert between RAT and RasCAL1</a></li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../guide.html" class="nav-link">User Guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Tutorial</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Custom Models</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="custom-models">
<span id="custommodels"></span><h1>Custom Models<a class="headerlink" href="#custom-models" title="Link to this heading">#</a></h1>
<p>The Standard Layers approach is useful for quickly setting up simple models, but parameterising models in this way is not always the best way of analysing data. For example, in the case of lipids, it is often natural and intuitive to analyse the data in terms of area per lipid rather than in terms of d, <span class="math notranslate nohighlight">\(\rho\)</span> and roughness. Similarly, for solid state samples thinking in terms of density and composition is often more appropriate than SLD. In common with RasCAL, you can parameterise your model in any way you like, and then rather than building the model in the input class, the model is constructed using a custom model script. This is by far the most powerful method for using RAT for data analysis, as virtually any type of model can be implemented in this way.</p>
<p>Again in common with RasCAL, there are two main options for custom modelling:</p>
<ul class="simple">
<li><p><strong>Custom Layers</strong> - In this method, the parameters are grouped into layers within the script, with the output then defining layers as [d, <span class="math notranslate nohighlight">\(\rho\)</span>, r] triplets.</p></li>
<li><p><strong>Custom XY Profile</strong> - In this method the input parameters are used to create a z (in Angstroms) versus SLD curve, from which the reflectivity is calculated.</p></li>
</ul>
<section id="custom-layers-models">
<h2>Custom Layers Models<a class="headerlink" href="#custom-layers-models" title="Link to this heading">#</a></h2>
<p>The general principle of custom layers models is that we take the defined parameters, and arrange them into an array layers using some code. This is a very powerful
way of defining your model, since you have the freedom to parameterise and define your model however you wish. So rather than beong restricted to just simple [d, rho, sigma] combinations as parameters, you can
define your model in terms of more scientifically useful parameters, such are Area per molecule or density for example. The basic structure of any custom layers script always has the same format:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-0">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[layers,subRough]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">myCustomModel</span><span class="p">(</span>params,bulkIn,bulkOut,contrast<span class="p">)</span>

<span class="c">% Some code to define your model</span>

<span class="n">layers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">d1</span><span class="p">,</span><span class="w"> </span><span class="n">rho1</span><span class="p">,</span><span class="w"> </span><span class="n">sig1</span><span class="p">;</span><span class="w"> </span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">rho2</span><span class="p">,</span><span class="w"> </span><span class="n">sig2</span><span class="p">];</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-1">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myCustomModel</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">bulk_in</span><span class="p">,</span> <span class="n">bulk_out</span><span class="p">,</span> <span class="n">contrast</span><span class="p">):</span>

    <span class="c1"># Some code to define your model</span>

    <span class="n">layers</span> <span class="o">=</span> <span class="p">[[</span><span class="n">d1</span><span class="p">,</span> <span class="n">rho1</span><span class="p">,</span> <span class="n">sig1</span><span class="p">],</span>
              <span class="p">[</span><span class="n">d2</span><span class="p">,</span> <span class="n">rho2</span><span class="p">,</span> <span class="n">sig2</span><span class="p">]];</span>

    <span class="k">return</span> <span class="n">layers</span><span class="p">,</span> <span class="n">sub_rough</span>
</pre></div>
</div>
</div>
</div>
<p>In other words, you get parameters and bulk SLD’s in (along with a flag ‘contrast’ telling your script which contrast to work on), and your code needs to construct the layers array defining the model.
In the next section we’ll demonstrate this by making an example to fit a lipid bilayer sample.</p>
<section id="dspc-bilayer-example">
<h3>DSPC Bilayer Example<a class="headerlink" href="#dspc-bilayer-example" title="Link to this heading">#</a></h3>
<p>In biophysical studies, one of the most common parameters of interest is the area occupied per lipid, be it in a bilayer or a monolayer. Often for lipids, the volume occupied per component is known, which leads to a simple way of calculating the thickness of the head and tail groups. Let the volume of the heads and tails be V<sub>Head</sub> and V<sub>Tail</sub> respectively. Then, for a given Area per Lipid, the thickness of the two layers will be given by <span class="math notranslate nohighlight">\(D_\mathrm{Head} = \frac{V_\mathrm{Head}}{APM}\)</span> for the headgroup thickness, and <span class="math notranslate nohighlight">\(D_\mathrm{Tail} = \frac{V_\mathrm{Tail}}{APM}\)</span> for the tail layers.</p>
<p>In terms of the SLD’s, because the volume and composition of each layer is known, then for each, the SLD can be calculated as <span class="math notranslate nohighlight">\(\rho = \frac {\sum_{i} n_\mathrm{i} b_\mathrm{i}}{V}\)</span> in the usual way. Using literature values for the volumes therefore, rather than parameterising a lipid in terms of thickness, roughness, SLD and coverage of the lipid layers (i.e. head and tail) separately, we can just use a single APM parameter for the whole lipid. In terms of the calculation, we still specify d, <span class="math notranslate nohighlight">\(\rho\)</span>, rough and coverage on a per layer basis for RAT, but we calculate these in a script for the bilayer from the APM and known composition and volume. This not only gives us the ability to fit our data using more realistic biophysical parameters (in our case APM), but also reduces the number of parameters (dimensions) of our model.</p>
<p>The figure shows the system we are measuring. We have a single, hydrogenated DSPC bilayer supported on a silicon surface. The silicon is, as always, coated with an oxide layer. The bilayer may or may not be complete (i.e. partially hydrated) so we will need hydration parameters, and there is the possibility of a thin water layer between the bilayer and the substrate. We also need some roughness parameters, both for the substrate and the bilayer itself. We will build a custom model for this and use it to analyse the bilayer data at three contrasts.</p>
<img alt="Bilayer on silicon diagram" src="../_images/bilayer.png" />
<p>Looking at our system, we can see that we are going to need 8 parameters in total:</p>
<table class="table">
<tbody>
<tr class="row-odd"><td><p><strong>Parameters</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>Substrate Roughness</p></td>
<td><p>This roughness is used for the silicon and oxide layer</p></td>
</tr>
<tr class="row-odd"><td><p>Oxide Thickness</p></td>
<td><p>Thickness of the oxide layer</p></td>
</tr>
<tr class="row-even"><td><p>Oxide hydration</p></td>
<td><p>Required to deal with incomplete coverage of the oxide, which is common</p></td>
</tr>
<tr class="row-odd"><td><p>Lipid APM</p></td>
<td><p>Area per molecule of the DSPC bilayer, which is the same for both heads and tails.</p></td>
</tr>
<tr class="row-even"><td><p>Head Hydration</p></td>
<td><p>The hydration level of the bilayer headgroups</p></td>
</tr>
<tr class="row-odd"><td><p>Bilayer Hydration</p></td>
<td><p>Overall coverage parameter for the DSPC bilayer</p></td>
</tr>
<tr class="row-even"><td><p>Bilayer roughness</p></td>
<td><p>Roughness parameter for the bilayer, which we assume is the same for heads and tails.</p></td>
</tr>
<tr class="row-odd"><td><p>Water Thickness</p></td>
<td><p>Thickness of a possible hydrating layer between the membrane and the oxide.</p></td>
</tr>
</tbody>
</table>
<p>These are the parameters that we will define in the parameters block.</p>
<p>We start in the usual way by making in instance of the project class, but this time we change the project type to <em>custom layers</em>, and also change the geometry to <em>solid/liquid</em>:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-2">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">projectClass</span><span class="p">(</span><span class="s">&#39;Orso lipid example - custom layers&#39;</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setModelType</span><span class="p">(</span><span class="s">&#39;custom layers&#39;</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="s">&#39;Substrate/liquid&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-3">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">Project</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Orso lipid example - custom layers&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;custom layers&#39;</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;substrate/liquid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If you look at the class, you will see that the <em>layers</em> block is no longer visible. We aren’t going to need this for <em>custom layers</em>. Instead, we need a custom script, which takes our inputs and converts this in to a list of [d, <span class="math notranslate nohighlight">\(\rho\)</span>, r] layers.</p>
<p>First, we add our seven parameters (remember that Substrate Roughness is always there as the first parameter):</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-4">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">Parameters</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c">%  Name                min          val         max     fit?</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Oxide thick&#39;</span><span class="p">,</span><span class="w">         </span><span class="mi">5</span><span class="p">,</span><span class="w">          </span><span class="mi">20</span><span class="p">,</span><span class="w">         </span><span class="mi">60</span><span class="p">,</span><span class="w">     </span><span class="nb">true</span><span class="w">   </span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Oxide Hydration&#39;</span><span class="w">      </span><span class="mi">0</span><span class="p">,</span><span class="w">          </span><span class="mf">0.2</span><span class="p">,</span><span class="w">        </span><span class="mf">0.5</span><span class="p">,</span><span class="w">    </span><span class="nb">true</span><span class="w">   </span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Lipid APM&#39;</span><span class="w">            </span><span class="mi">45</span><span class="w">          </span><span class="mi">55</span><span class="w">          </span><span class="mi">65</span><span class="w">      </span><span class="nb">true</span><span class="w">   </span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Head Hydration&#39;</span><span class="w">       </span><span class="mi">0</span><span class="w">           </span><span class="mf">0.2</span><span class="w">         </span><span class="mf">0.5</span><span class="w">     </span><span class="nb">true</span><span class="w">   </span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Bilayer Hydration&#39;</span><span class="w">    </span><span class="mi">0</span><span class="w">           </span><span class="mf">0.1</span><span class="w">         </span><span class="mf">0.2</span><span class="w">     </span><span class="nb">true</span><span class="w">   </span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Bilayer Roughness&#39;</span><span class="w">    </span><span class="mi">2</span><span class="w">           </span><span class="mi">4</span><span class="w">           </span><span class="mi">8</span><span class="w">       </span><span class="nb">true</span><span class="w">   </span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Water Thickness&#39;</span><span class="w">      </span><span class="mi">0</span><span class="w">           </span><span class="mi">2</span><span class="w">           </span><span class="mi">10</span><span class="w">      </span><span class="nb">true</span><span class="w">   </span><span class="p">};</span>
<span class="w">        </span><span class="p">};</span>

<span class="n">problem</span><span class="p">.</span><span class="n">addParamGroup</span><span class="p">(</span><span class="n">Parameters</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-5">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Oxide thick&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Oxide Hydration&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Lipid APM&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">45.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">55.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">65.0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Head Hydration&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bilayer Hydration&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bilayer Roughness&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Water Thickness&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The custom file that we are going to use is called <em>customBilayer.m</em>. This is a MATLAB function, which takes our input parameters and translates them into a list of layers. To add the file, we do the following:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-6">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% name filename language path</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addCustomFile</span><span class="p">(</span><span class="s">&#39;DSPC Model&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;customBilayer.m&#39;</span><span class="p">,</span><span class="s">&#39;matlab&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">pwd</span><span class="p">);</span>
<span class="c">% Or</span>
<span class="c">% problem.addCustomFile(&#39;DSPC Model&#39;, &#39;customBilayer.py&#39;, &#39;python&#39;, pwd, &#39;customBilayer&#39;);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-7" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-7">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">custom_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;DSPC Model&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;customBilayer.m&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;matlab&#39;</span><span class="p">)</span>
<span class="c1"># Or</span>
<span class="c1"># problem.custom_files.append(name=&#39;DSPC Model&#39;, filename=&#39;customBilayer.py&#39;, language=&#39;python&#39;, function_name=&#39;customBilayer&#39;)</span>
</pre></div>
</div>
</div>
</div>
<p>The custom files are in exactly the same format at those in RasCAL. To add it to our project in RAT we always need to specify four things:</p>
<ul class="simple">
<li><p><strong>Name</strong> - This is any name we choose for this custom file. This is the name we use later to add this to the contrasts.</p></li>
<li><p><strong>Filename</strong> - This is the actual filename of the custom file, including its file extension (MATLAB extension is ‘.m’)</p></li>
<li><p><strong>Function name</strong> - This is the name of the function to call from the specified file. For Matlab, the function name is always the same as the filename but for python and dynamic library functions the function name can be different from filename.</p></li>
<li><p><strong>Language</strong> - The language which we are going to use to process the file. We are choosing MATLAB, which means that the native MATLAB interpreter (i.e. the one we are using to call the project in this example) will be used to process the script. There is further discussion on the languages available and their merits in chapter 6.</p></li>
<li><p><strong>Path</strong> - The path to our custom file. In this case it is in the same directory as the model script (pwd).</p></li>
</ul>
<p>At this point it is useful to look at <em>customBilayer.m</em> and then go through it section by section:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-8" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-8">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[output,sub_rough]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">customBilayer</span><span class="p">(</span>params,bulk_in,bulk_out,contrast<span class="p">)</span>
<span class="c">%CUSTOMBILAYER  RASCAL Custom Layer Model File.</span>
<span class="c">%</span>
<span class="c">%</span>
<span class="c">% This file accepts 3 vectors containing the values for</span>
<span class="c">% Params, bulk in and bulk out</span>
<span class="c">% The final parameter is an index of the contrast being calculated</span>
<span class="c">% The m-file should output a matrix of layer values, in the form..</span>
<span class="c">% Output = [thick 1, SLD 1, Rough 1, Percent Hydration 1, Hydrate how 1</span>
<span class="c">%           ....</span>
<span class="c">%           thick n, SLD n, Rough n, Percent Hydration n, Hydration how n]</span>
<span class="c">% The &#39;hydrate how&#39; parameter decides if the layer is hydrated with</span>
<span class="c">% Bulk out or Bulk in phases. Set to 1 for Bulk out, zero for Bulk in.</span>
<span class="c">% Alternatively, leave out hydration and just return..</span>
<span class="c">% Output = [thick 1, SLD 1, Rough 1,</span>
<span class="c">%           ....</span>
<span class="c">%           thick n, SLD n, Rough n] };</span>
<span class="c">% The second output parameter should be the substrate roughness</span>

<span class="n">sub_rough</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">oxide_thick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">oxide_hydration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">lipidAPM</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="n">headHydration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="n">bilayerHydration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<span class="n">bilayerRough</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
<span class="n">waterThick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

<span class="c">% We have a constant SLD for the oxide</span>
<span class="n">oxide_SLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.41e-6</span><span class="p">;</span>

<span class="c">% Now make the lipid layers..</span>
<span class="c">% Use known lipid volume and compositions</span>
<span class="c">% to make the layers.</span>

<span class="c">% define all the neutron b&#39;s.</span>
<span class="n">bc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.6646e-4</span><span class="p">;</span><span class="w">     </span><span class="c">%Carbon</span>
<span class="n">bo</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.5843e-4</span><span class="p">;</span><span class="w">     </span><span class="c">%Oxygen</span>
<span class="n">bh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3739e-4</span><span class="p">;</span><span class="w">        </span><span class="c">%Hydrogen</span>
<span class="n">bp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.513e-4</span><span class="p">;</span><span class="w">      </span><span class="c">%Phosphorus</span>
<span class="n">bn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.936e-4</span><span class="p">;</span><span class="w">      </span><span class="c">%Nitrogen</span>
<span class="n">bd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.6671e-4</span><span class="p">;</span><span class="w">     </span><span class="c">%Deuterium</span>

<span class="c">% Now make the lipid groups..</span>
<span class="n">COO</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">bo</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bc</span><span class="p">);</span>
<span class="n">GLYC</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">bh</span><span class="p">);</span>
<span class="n">CH3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">bh</span><span class="p">);</span>
<span class="n">PO4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bp</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">bo</span><span class="p">);</span>
<span class="n">CH2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bh</span><span class="p">);</span>
<span class="n">CHOL</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bn</span><span class="p">);</span>

<span class="c">% Group these into heads and tails:</span>
<span class="n">Head</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">CHOL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PO4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GLYC</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">COO</span><span class="p">;</span>
<span class="n">Tails</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">34</span><span class="o">*</span><span class="n">CH2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">CH3</span><span class="p">);</span>

<span class="c">% We need volumes for each.</span>
<span class="c">% Use literature values:</span>
<span class="n">vHead</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">319</span><span class="p">;</span>
<span class="n">vTail</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">782</span><span class="p">;</span>

<span class="c">% we use the volumes to calculate the SLD&#39;s</span>
<span class="n">SLDhead</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Head</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vHead</span><span class="p">;</span>
<span class="n">SLDtail</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Tails</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vTail</span><span class="p">;</span>

<span class="c">% We calculate the layer thickness&#39; from</span>
<span class="c">% the volumes and the APM...</span>
<span class="n">headThick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">vHead</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lipidAPM</span><span class="p">;</span>
<span class="n">tailThick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">vTail</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lipidAPM</span><span class="p">;</span>

<span class="c">% Manually deal with hydration for layers in</span>
<span class="c">% this example.</span>
<span class="n">oxSLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">oxide_hydration</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bulk_out</span><span class="p">(</span><span class="nb">contrast</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">oxide_hydration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oxide_SLD</span><span class="p">);</span>
<span class="n">headSLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">headHydration</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bulk_out</span><span class="p">(</span><span class="nb">contrast</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">headHydration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">SLDhead</span><span class="p">);</span>
<span class="n">tailSLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">bilayerHydration</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bulk_out</span><span class="p">(</span><span class="nb">contrast</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bilayerHydration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">SLDtail</span><span class="p">);</span>

<span class="c">% Make the layers</span>
<span class="n">oxide</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">oxide_thick</span><span class="w"> </span><span class="n">oxSLD</span><span class="w"> </span><span class="n">sub_rough</span><span class="p">];</span>
<span class="n">water</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">waterThick</span><span class="w"> </span><span class="n">bulk_out</span><span class="p">(</span><span class="nb">contrast</span><span class="p">)</span><span class="w"> </span><span class="n">bilayerRough</span><span class="p">];</span>
<span class="nb">head</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">headThick</span><span class="w"> </span><span class="n">headSLD</span><span class="w"> </span><span class="n">bilayerRough</span><span class="p">];</span>
<span class="nb">tail</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">tailThick</span><span class="w"> </span><span class="n">tailSLD</span><span class="w"> </span><span class="n">bilayerRough</span><span class="p">];</span>

<span class="c">% Group the layers to make the output</span>
<span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">oxide</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">water</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nb">head</span><span class="p">];</span>

<span class="k">end</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-9">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">customBilayer</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">bulk_in</span><span class="p">,</span> <span class="n">bulk_out</span><span class="p">,</span> <span class="n">contrast</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">bulk_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bulk_in</span><span class="p">)</span>
    <span class="n">bulk_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bulk_out</span><span class="p">)</span>

    <span class="n">sub_rough</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">oxide_thick</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">oxide_hydration</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">lipidAPM</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">headHydration</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">bilayerHydration</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">bilayerRough</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">waterThick</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>

    <span class="c1"># We have a constant SLD for the bilayer</span>
    <span class="n">oxide_SLD</span> <span class="o">=</span> <span class="mf">3.41e-6</span>

    <span class="c1"># Now make the lipid layers..</span>
    <span class="c1"># Use known lipid volume and compositions</span>
    <span class="c1"># to make the layers</span>

    <span class="c1"># define all the neutron b&#39;s.</span>
    <span class="n">bc</span> <span class="o">=</span> <span class="mf">0.6646e-4</span>     <span class="c1"># Carbon</span>
    <span class="n">bo</span> <span class="o">=</span> <span class="mf">0.5843e-4</span>     <span class="c1"># Oxygen</span>
    <span class="n">bh</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.3739e-4</span>    <span class="c1"># Hydrogen</span>
    <span class="n">bp</span> <span class="o">=</span> <span class="mf">0.513e-4</span>      <span class="c1"># Phosphorus</span>
    <span class="n">bn</span> <span class="o">=</span> <span class="mf">0.936e-4</span>      <span class="c1"># Nitrogen</span>
    <span class="n">bd</span> <span class="o">=</span> <span class="mf">0.6671e-4</span>     <span class="c1"># Deuterium</span>

    <span class="c1"># Now make the lipid groups..</span>
    <span class="n">COO</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">bo</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span>
    <span class="n">GLYC</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span>
    <span class="n">CH3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span>
    <span class="n">PO4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bp</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">bo</span><span class="p">)</span>
    <span class="n">CH2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span>
    <span class="n">CHOL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bn</span><span class="p">)</span>

    <span class="c1"># Group these into heads and tails:</span>
    <span class="n">Head</span> <span class="o">=</span> <span class="n">CHOL</span> <span class="o">+</span> <span class="n">PO4</span> <span class="o">+</span> <span class="n">GLYC</span> <span class="o">+</span> <span class="n">COO</span>
    <span class="n">Tails</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">*</span><span class="n">CH2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">CH3</span><span class="p">)</span>

    <span class="c1"># We need volumes for each.</span>
    <span class="c1"># Use literature values:</span>
    <span class="n">vHead</span> <span class="o">=</span> <span class="mi">319</span>
    <span class="n">vTail</span> <span class="o">=</span> <span class="mi">782</span>

    <span class="c1"># we use the volumes to calculate the SLD&#39;s</span>
    <span class="n">SLDhead</span> <span class="o">=</span> <span class="n">Head</span> <span class="o">/</span> <span class="n">vHead</span>
    <span class="n">SLDtail</span> <span class="o">=</span> <span class="n">Tails</span> <span class="o">/</span> <span class="n">vTail</span>

    <span class="c1"># We calculate the layer thickness&#39; from</span>
    <span class="c1"># the volumes and the APM...</span>
    <span class="n">headThick</span> <span class="o">=</span> <span class="n">vHead</span> <span class="o">/</span> <span class="n">lipidAPM</span>
    <span class="n">tailThick</span> <span class="o">=</span> <span class="n">vTail</span> <span class="o">/</span> <span class="n">lipidAPM</span>

    <span class="c1"># Manually deal with hydration for layers in</span>
    <span class="c1"># this example.</span>
    <span class="n">oxSLD</span> <span class="o">=</span> <span class="p">(</span><span class="n">oxide_hydration</span> <span class="o">*</span> <span class="n">bulk_out</span><span class="p">[</span><span class="n">contrast</span><span class="p">])</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">oxide_hydration</span><span class="p">)</span> <span class="o">*</span> <span class="n">oxide_SLD</span><span class="p">)</span>
    <span class="n">headSLD</span> <span class="o">=</span> <span class="p">(</span><span class="n">headHydration</span> <span class="o">*</span> <span class="n">bulk_out</span><span class="p">[</span><span class="n">contrast</span><span class="p">])</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">headHydration</span><span class="p">)</span> <span class="o">*</span> <span class="n">SLDhead</span><span class="p">)</span>
    <span class="n">tailSLD</span> <span class="o">=</span> <span class="p">(</span><span class="n">bilayerHydration</span> <span class="o">*</span> <span class="n">bulk_out</span><span class="p">[</span><span class="n">contrast</span><span class="p">])</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bilayerHydration</span><span class="p">)</span> <span class="o">*</span> <span class="n">SLDtail</span><span class="p">)</span>

    <span class="c1"># Make the layers</span>
    <span class="n">oxide</span> <span class="o">=</span> <span class="p">[</span><span class="n">oxide_thick</span><span class="p">,</span> <span class="n">oxSLD</span><span class="p">,</span> <span class="n">sub_rough</span><span class="p">]</span>
    <span class="n">water</span> <span class="o">=</span> <span class="p">[</span><span class="n">waterThick</span><span class="p">,</span> <span class="n">bulk_out</span><span class="p">[</span><span class="n">contrast</span><span class="p">],</span> <span class="n">bilayerRough</span><span class="p">]</span>
    <span class="n">head</span> <span class="o">=</span> <span class="p">[</span><span class="n">headThick</span><span class="p">,</span> <span class="n">headSLD</span><span class="p">,</span> <span class="n">bilayerRough</span><span class="p">]</span>
    <span class="n">tail</span> <span class="o">=</span> <span class="p">[</span><span class="n">tailThick</span><span class="p">,</span> <span class="n">tailSLD</span><span class="p">,</span> <span class="n">bilayerRough</span><span class="p">]</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">oxide</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="n">head</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">sub_rough</span>
</pre></div>
</div>
</div>
</div>
<p>The standard format for a custom layers file always has 4 inputs (<em>params</em>, <em>bulk_in</em>, <em>bulk_out</em>, <em>contrast</em>).</p>
<p>Params is a list of parameter values for the layers, which appear in the same order that we defined them in our parameters block, so is
always a [1 x nParams] array of doubles. It is useful to split this array into its individual parameters at the start of the custom file, although you don’t have to do this:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-10" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-10">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">sub_rough</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">oxide_thick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">oxide_hydration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">lipidAPM</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="n">headHydration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="n">bilayerHydration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<span class="n">bilayerRough</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
<span class="n">waterThick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-11" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-11">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sub_rough</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">oxide_thick</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">oxide_hydration</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">lipidAPM</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">headHydration</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">bilayerHydration</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">bilayerRough</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="n">waterThick</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The next two inputs are arrays of all the bulk in and bulk out values for all the contrasts, and ‘contrast’ is an integer telling the script which contrast it should calculate. The reason for passing the values of the bulk phases is that these are needed to calculate the SLD’s of the layers if they are hydrated. So, to calculate the SLD of the Oxide layer, we take the known SLD for Silicon dioxide, and then use the oxide coverage parameter to calculate the effective SLD of the oxide. Because we define our coverage as a parameter between 0 and 1, where 1 is full coverage and 0 is fully hydrated, we can work out this SLD as a simple ratio between oxide SLD and water SLD</p>
<p><span class="math notranslate nohighlight">\(SLD_\mathrm{Hydrated layer} = (Hydration * SLD_\mathrm{water}) + ((1-Hydration)*SLD_\mathrm{layer})\)</span></p>
<p>The input parameter <em>bulk_in</em> is an array which is a list of the current SLD’s for all the contrasts, so the current SLD of the water (which may be being fitted) is given by bulk_out(contrast). Therefore, the effective SLD of the oxide layer at a particular contrast is given by:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-12" name="sd-tab-set-6" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-12">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">oxide_SLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.41e-6</span><span class="p">;</span>
<span class="n">oxSLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">oxide_hydration</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bulk_out</span><span class="p">(</span><span class="nb">contrast</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">oxide_hydration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oxide_SLD</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-6" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-13">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">oxide_SLD</span> <span class="o">=</span> <span class="mf">3.41e-6</span>
<span class="n">oxSLD</span> <span class="o">=</span> <span class="p">(</span><span class="n">oxide_hydration</span> <span class="o">*</span> <span class="n">bulk_out</span><span class="p">[</span><span class="n">contrast</span><span class="p">])</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">oxide_hydration</span><span class="p">)</span> <span class="o">*</span> <span class="n">oxide_SLD</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To work out the thickness of the lipid layers, we use literature values for the head and tails volumes, and divide these by the APM (parameter 4 in our list):</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-14" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-14">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% We need volumes for each.</span>
<span class="c">% Use literature values:</span>
<span class="n">vHead</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">319</span><span class="p">;</span>
<span class="n">vTail</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">782</span><span class="p">;</span>

<span class="c">% We calculate the layer thickness&#39; from</span>
<span class="c">% the volumes and the APM...</span>
<span class="n">headThick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">vHead</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lipidAPM</span><span class="p">;</span>
<span class="n">tailThick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">vTail</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lipidAPM</span><span class="p">;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-15" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-15">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># We need volumes for each.</span>
<span class="c1"># Use literature values:</span>
<span class="n">vHead</span> <span class="o">=</span> <span class="mi">319</span>
<span class="n">vTail</span> <span class="o">=</span> <span class="mi">782</span>

<span class="c1"># We calculate the layer thickness&#39; from</span>
<span class="c1"># the volumes and the APM...</span>
<span class="n">headThick</span> <span class="o">=</span> <span class="n">vHead</span> <span class="o">/</span> <span class="n">lipidAPM</span>
<span class="n">tailThick</span> <span class="o">=</span> <span class="n">vTail</span> <span class="o">/</span> <span class="n">lipidAPM</span>
</pre></div>
</div>
</div>
</div>
<p>For the SLD’s, we again make use of these volumes, but we need to work out the sum of the scattering lengths from the layers compositions:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-16" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-16">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% define all the neutron b&#39;s.</span>
<span class="n">bc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.6646e-4</span><span class="p">;</span><span class="w">     </span><span class="c">%Carbon</span>
<span class="n">bo</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.5843e-4</span><span class="p">;</span><span class="w">     </span><span class="c">%Oxygen</span>
<span class="n">bh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3739e-4</span><span class="p">;</span><span class="w">    </span><span class="c">%Hydrogen</span>
<span class="n">bp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.513e-4</span><span class="p">;</span><span class="w">      </span><span class="c">%Phosphorus</span>
<span class="n">bn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.936e-4</span><span class="p">;</span><span class="w">      </span><span class="c">%Nitrogen</span>
<span class="n">bd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.6671e-4</span><span class="p">;</span><span class="w">     </span><span class="c">%Deuterium</span>

<span class="c">% Now make the lipid groups..</span>
<span class="n">COO</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">bo</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bc</span><span class="p">);</span>
<span class="n">GLYC</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">bh</span><span class="p">);</span>
<span class="n">CH3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">bh</span><span class="p">);</span>
<span class="n">PO4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bp</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">bo</span><span class="p">);</span>
<span class="n">CH2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bh</span><span class="p">);</span>
<span class="n">CHOL</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bn</span><span class="p">);</span>

<span class="c">% Group these into heads and tails:</span>
<span class="n">Head</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">CHOL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PO4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GLYC</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">COO</span><span class="p">;</span>
<span class="n">Tails</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">34</span><span class="o">*</span><span class="n">CH2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">CH3</span><span class="p">);</span>

<span class="c">% we use the volumes to calculate the SLD&#39;s</span>
<span class="n">SLDhead</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Head</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vHead</span><span class="p">;</span>
<span class="n">SLDtail</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Tails</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vTail</span><span class="p">;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-17" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-17">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define all the neutron b&#39;s.</span>
<span class="n">bc</span> <span class="o">=</span> <span class="mf">0.6646e-4</span>     <span class="c1"># Carbon</span>
<span class="n">bo</span> <span class="o">=</span> <span class="mf">0.5843e-4</span>     <span class="c1"># Oxygen</span>
<span class="n">bh</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.3739e-4</span>    <span class="c1"># Hydrogen</span>
<span class="n">bp</span> <span class="o">=</span> <span class="mf">0.513e-4</span>      <span class="c1"># Phosphorus</span>
<span class="n">bn</span> <span class="o">=</span> <span class="mf">0.936e-4</span>      <span class="c1"># Nitrogen</span>
<span class="n">bd</span> <span class="o">=</span> <span class="mf">0.6671e-4</span>     <span class="c1"># Deuterium</span>

<span class="c1"># Now make the lipid groups..</span>
<span class="n">COO</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">bo</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span>
<span class="n">GLYC</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span>
<span class="n">CH3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span>
<span class="n">PO4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bp</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">bo</span><span class="p">)</span>
<span class="n">CH2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span>
<span class="n">CHOL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">bh</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">bn</span><span class="p">)</span>

<span class="c1"># Group these into heads and tails:</span>
<span class="n">Head</span> <span class="o">=</span> <span class="n">CHOL</span> <span class="o">+</span> <span class="n">PO4</span> <span class="o">+</span> <span class="n">GLYC</span> <span class="o">+</span> <span class="n">COO</span>
<span class="n">Tails</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">*</span><span class="n">CH2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">CH3</span><span class="p">)</span>

<span class="c1"># we use the volumes to calculate the SLD&#39;s</span>
<span class="n">SLDhead</span> <span class="o">=</span> <span class="n">Head</span> <span class="o">/</span> <span class="n">vHead</span>
<span class="n">SLDtail</span> <span class="o">=</span> <span class="n">Tails</span> <span class="o">/</span> <span class="n">vTail</span>
</pre></div>
</div>
</div>
</div>
<p>We also do the coverage correction as we did for the Oxide:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-18" name="sd-tab-set-9" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-18">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">headSLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">headHydration</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bulk_out</span><span class="p">(</span><span class="nb">contrast</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">headHydration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">SLDhead</span><span class="p">);</span>
<span class="n">tailSLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">bilayerHydration</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bulk_out</span><span class="p">(</span><span class="nb">contrast</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bilayerHydration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">SLDtail</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-19" name="sd-tab-set-9" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-19">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">headSLD</span> <span class="o">=</span> <span class="p">(</span><span class="n">headHydration</span> <span class="o">*</span> <span class="n">bulk_out</span><span class="p">[</span><span class="n">contrast</span><span class="p">])</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">headHydration</span><span class="p">)</span> <span class="o">*</span> <span class="n">SLDhead</span><span class="p">)</span>
<span class="n">tailSLD</span> <span class="o">=</span> <span class="p">(</span><span class="n">bilayerHydration</span> <span class="o">*</span> <span class="n">bulk_out</span><span class="p">[</span><span class="n">contrast</span><span class="p">])</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bilayerHydration</span><span class="p">)</span> <span class="o">*</span> <span class="n">SLDtail</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This gives us all the parameters we need to define our layers. In other words, we have a thickness, SLD and roughness for each layer then put these together to make our stack:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-20" name="sd-tab-set-10" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-20">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Make the layers</span>
<span class="n">oxide</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">oxide_thick</span><span class="w"> </span><span class="n">oxSLD</span><span class="w"> </span><span class="n">sub_rough</span><span class="p">];</span>
<span class="n">water</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">waterThick</span><span class="w"> </span><span class="n">bulk_out</span><span class="p">(</span><span class="nb">contrast</span><span class="p">)</span><span class="w"> </span><span class="n">bilayerRough</span><span class="p">];</span>
<span class="nb">head</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">headThick</span><span class="w"> </span><span class="n">headSLD</span><span class="w"> </span><span class="n">bilayerRough</span><span class="p">];</span>
<span class="nb">tail</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">tailThick</span><span class="w"> </span><span class="n">tailSLD</span><span class="w"> </span><span class="n">bilayerRough</span><span class="p">];</span>

<span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">oxide</span><span class="p">;</span><span class="w"> </span><span class="n">water</span><span class="p">;</span><span class="w"> </span><span class="nb">head</span><span class="p">;</span><span class="w"> </span><span class="nb">tail</span><span class="p">;</span><span class="w"> </span><span class="nb">tail</span><span class="p">;</span><span class="w"> </span><span class="nb">head</span><span class="p">];</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-21" name="sd-tab-set-10" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-21">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make the layers</span>
<span class="n">oxide</span> <span class="o">=</span> <span class="p">[</span><span class="n">oxide_thick</span><span class="p">,</span> <span class="n">oxSLD</span><span class="p">,</span> <span class="n">sub_rough</span><span class="p">]</span>
<span class="n">water</span> <span class="o">=</span> <span class="p">[</span><span class="n">waterThick</span><span class="p">,</span> <span class="n">bulk_out</span><span class="p">[</span><span class="n">contrast</span><span class="p">],</span> <span class="n">bilayerRough</span><span class="p">]</span>
<span class="n">head</span> <span class="o">=</span> <span class="p">[</span><span class="n">headThick</span><span class="p">,</span> <span class="n">headSLD</span><span class="p">,</span> <span class="n">bilayerRough</span><span class="p">]</span>
<span class="n">tail</span> <span class="o">=</span> <span class="p">[</span><span class="n">tailThick</span><span class="p">,</span> <span class="n">tailSLD</span><span class="p">,</span> <span class="n">bilayerRough</span><span class="p">]</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">oxide</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="n">head</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Note the use of semicolons. In Matlab syntax, this concatenates arrays column-wise. So if you take an array a = [a1, a2, a3], and another b = [b1, b2, b3], then [a ; b] produces an array that looks like this:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix} a_\mathrm{1} &amp; a_\mathrm{2} &amp; a_\mathrm{3} \\ b_\mathrm{1} &amp; b_\mathrm{2} &amp; b_\mathrm{3} \end{bmatrix}\end{split}\]</div>
<p>In other words, the entire purpose of our custom layer file is to take our parameters in a scientifically useful form (e.g. Area per Lipid in our case), and to translate these into a list of thick, SLD, rough layers for the whole interface.
You have complete freedom in how you do this, which means that you can make any kind of layer model you can think of using a custom layers file, including layers that are mixtures of adjoining layers and so on. As long as you can describe your
system as layers with an error function (i.e. Nevot and Croce) roughness you can describe them using custom layer modelling.</p>
<p>The rest of the custom model is defined similar to the standard layers model shown in <a class="reference internal" href="chapter2.html#chapter2"><span class="std std-ref">The Problem Definition Input Class</span></a>. So, since we want to analyse three contrasts simultaneously, we need the following:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-22" name="sd-tab-set-11" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-22">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Change bulk in from air to silicon....</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBulkIn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Silicon&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.07e-6</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;value&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.073e-6</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.08e-6</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>

<span class="c">% Add two more values for bulk out....</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBulkOut</span><span class="p">(</span><span class="s">&#39;SLD SMW&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">2.073e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">3e-6</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBulkOut</span><span class="p">(</span><span class="s">&#39;SLD H2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6e-6</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.56e-6</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3e-6</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>

<span class="n">problem</span><span class="p">.</span><span class="n">setBulkOut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">5e-6</span><span class="p">);</span>

<span class="c">% Read in the datafiles</span>
<span class="n">root</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">getappdata</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;root&#39;</span><span class="p">);</span>
<span class="n">dataPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/examples/normalReflectivity/customLayers/&#39;</span><span class="p">;</span>
<span class="n">D2O_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">readmatrix</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">dataPath</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;c_PLP0016596.dat&#39;</span><span class="p">));</span>
<span class="n">SMW_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">readmatrix</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">dataPath</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;c_PLP0016601.dat&#39;</span><span class="p">));</span>
<span class="n">H2O_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">readmatrix</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">dataPath</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;c_PLP0016607.dat&#39;</span><span class="p">));</span>

<span class="c">% Add the data to the project</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addData</span><span class="p">(</span><span class="s">&#39;Bilayer / D2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">D2O_data</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">));</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addData</span><span class="p">(</span><span class="s">&#39;Bilayer / SMW&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SMW_data</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">));</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addData</span><span class="p">(</span><span class="s">&#39;Bilayer / H2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">H2O_data</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">));</span>

<span class="n">problem</span><span class="p">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39; dataRange&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">0.013</span><span class="w"> </span><span class="mf">0.37</span><span class="p">]);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&#39; dataRange&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">0.013</span><span class="w"> </span><span class="mf">0.37</span><span class="p">]);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&#39; dataRange&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">0.013</span><span class="w"> </span><span class="mf">0.37</span><span class="p">]);</span>

<span class="c">% Change the name of the existing parameters to refer to D2O</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBackgroundParam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;Backs par D2O&#39;</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">,</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mf">1e-10</span><span class="p">,</span><span class="s">&#39;max&#39;</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">,</span><span class="s">&#39;val&#39;</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">);</span>

<span class="c">% Add two new backs parameters for the other two.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBackgroundParam</span><span class="p">(</span><span class="s">&#39;Backs par SMW&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-10</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-5</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBackgroundParam</span><span class="p">(</span><span class="s">&#39;Backs par H2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-10</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-5</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>

<span class="c">% And add the two new constant backgrounds.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBackground</span><span class="p">(</span><span class="s">&#39;Background SMW&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;constant&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Backs par SMW&#39;</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBackground</span><span class="p">(</span><span class="s">&#39;Background H2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;constant&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Backs par H2O&#39;</span><span class="p">);</span>

<span class="c">% And edit the other one.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Background D2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;value1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Backs par D2O&#39;</span><span class="p">);</span>

<span class="c">% Set the scalefactor.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setScalefactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Value&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;max&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>

<span class="c">% Make the contrasts.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addContrast</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;Bilayer / D2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;background&#39;</span><span class="p">,</span><span class="s">&#39;Background D2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;resolution&#39;</span><span class="p">,</span><span class="s">&#39;Resolution 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;scalefactor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Scalefactor 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;nbs&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD D2O&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">        % This is bulk out (&#39;Nb Subs&#39;)</span>
<span class="w">                    </span><span class="s">&#39;nba&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Silicon&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">        % This is bulk in (&#39;Nb Air&#39;)</span>
<span class="w">                    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Bilayer / D2O&#39;</span><span class="p">);</span>

<span class="c">% SMW contrast.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addContrast</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;Bilayer / SMW&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;background&#39;</span><span class="p">,</span><span class="s">&#39;Background SMW&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;resolution&#39;</span><span class="p">,</span><span class="s">&#39;Resolution 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;scalefactor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Scalefactor 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;nbs&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD SMW&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">        % This is bulk out</span>
<span class="w">                    </span><span class="s">&#39;nba&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Silicon&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">        % This is bulk in</span>
<span class="w">                    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Bilayer / SMW&#39;</span><span class="p">);</span>

<span class="c">% SMW contrast.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addContrast</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;Bilayer / H2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;background&#39;</span><span class="p">,</span><span class="s">&#39;Background H2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;resolution&#39;</span><span class="p">,</span><span class="s">&#39;Resolution 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;scalefactor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Scalefactor 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;nbs&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD H2O&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">        % This is bulk out</span>
<span class="w">                    </span><span class="s">&#39;nba&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Silicon&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">        % This is bulk in</span>
<span class="w">                    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Bilayer / H2O&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-23" name="sd-tab-set-11" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-23">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Need to add the relevant Bulk SLD&#39;s. Change the bulk in from air to silicon, and add two additional water contrasts:</span>
<span class="n">problem</span><span class="o">.</span><span class="n">bulk_in</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Silicon&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">2.07e-6</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.073e-6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">2.08e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">problem</span><span class="o">.</span><span class="n">bulk_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;SLD SMW&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.073e-6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">3.0e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">bulk_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;SLD H2O&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.6e-6</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">0.56e-6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=-</span><span class="mf">0.3e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">problem</span><span class="o">.</span><span class="n">bulk_out</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">5.0e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Now add the datafiles. We have three datasets we need to consider - the bilayer against D2O, Silicon Matched water</span>
<span class="c1"># and H2O.Load these datafiles in and put them in the data block</span>

<span class="c1"># Read in the datafiles</span>
<span class="n">D2O_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;c_PLP0016596.dat&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">SMW_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;c_PLP0016601.dat&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">H2O_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;c_PLP0016607.dat&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="c1"># Add the data to the project - note this data has a resolution 4th column</span>
<span class="n">problem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bilayer / D2O&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">D2O_data</span><span class="p">,</span> <span class="n">data_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.013</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">])</span>
<span class="n">problem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bilayer / SMW&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">SMW_data</span><span class="p">,</span> <span class="n">data_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.013</span><span class="p">,</span> <span class="mf">0.32996</span><span class="p">])</span>
<span class="n">problem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bilayer / H2O&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">H2O_data</span><span class="p">,</span> <span class="n">data_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.013</span><span class="p">,</span> <span class="mf">0.33048</span><span class="p">])</span>

<span class="c1"># Add the custom file to the project</span>
<span class="c1"># problem.custom_files.append(name=&#39;DSPC Model&#39;, filename=&#39;customBilayerDSPC.m&#39;, language=&#39;matlab&#39;)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">custom_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;DSPC Model&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;customBilayerDSPC.py&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>

<span class="c1"># Also, add the relevant background parameters - one each for each contrast:</span>
<span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Background parameter D2O&#39;</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.0e-10</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0e-5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0e-07</span><span class="p">)</span>

<span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Background parameter SMW&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.0e-10</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0e-5</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Background parameter H2O&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.0e-10</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0e-5</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># And add the two new constant backgrounds</span>
<span class="n">problem</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Background SMW&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">value_1</span><span class="o">=</span><span class="s1">&#39;Background parameter SMW&#39;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Background H2O&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">value_1</span><span class="o">=</span><span class="s1">&#39;Background parameter H2O&#39;</span><span class="p">)</span>

<span class="c1"># And edit the other one....</span>
<span class="n">problem</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Background D2O&#39;</span><span class="p">,</span> <span class="n">value_1</span><span class="o">=</span><span class="s1">&#39;Background parameter D2O&#39;</span><span class="p">)</span>

<span class="c1"># Finally modify some of the other parameters to be more suitable values for a solid / liquid experiment</span>
<span class="n">problem</span><span class="o">.</span><span class="n">scalefactors</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Also, we are going to use the data resolution.</span>
<span class="n">problem</span><span class="o">.</span><span class="n">resolutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data Resolution&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Now add the three contrasts</span>

<span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bilayer / D2O&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;Background D2O&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;Data Resolution&#39;</span><span class="p">,</span>
                        <span class="n">scalefactor</span><span class="o">=</span><span class="s1">&#39;Scalefactor 1&#39;</span><span class="p">,</span> <span class="n">bulk_out</span><span class="o">=</span><span class="s1">&#39;SLD D2O&#39;</span><span class="p">,</span> <span class="n">bulk_in</span><span class="o">=</span><span class="s1">&#39;Silicon&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Bilayer / D2O&#39;</span><span class="p">)</span>

<span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bilayer / SMW&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;Background SMW&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;Data Resolution&#39;</span><span class="p">,</span>
                        <span class="n">scalefactor</span><span class="o">=</span><span class="s1">&#39;Scalefactor 1&#39;</span><span class="p">,</span> <span class="n">bulk_out</span><span class="o">=</span><span class="s1">&#39;SLD SMW&#39;</span><span class="p">,</span> <span class="n">bulk_in</span><span class="o">=</span><span class="s1">&#39;Silicon&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Bilayer / SMW&#39;</span><span class="p">)</span>

<span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bilayer / H2O&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;Background H2O&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;Data Resolution&#39;</span><span class="p">,</span>
                        <span class="n">scalefactor</span><span class="o">=</span><span class="s1">&#39;Scalefactor 1&#39;</span><span class="p">,</span> <span class="n">bulk_out</span><span class="o">=</span><span class="s1">&#39;SLD H2O&#39;</span><span class="p">,</span> <span class="n">bulk_in</span><span class="o">=</span><span class="s1">&#39;Silicon&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Bilayer / H2O&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we add the model, but in this case we give the name of our custom model from the custom files block (rather than a list of layers):</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-24" name="sd-tab-set-12" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-24">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setContrastModel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;DSPC Model&#39;</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setContrastModel</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;DSPC Model&#39;</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setContrastModel</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;DSPC Model&#39;</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-25" name="sd-tab-set-12" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-25">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DSPC Model&#39;</span><span class="p">])</span>
<span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DSPC Model&#39;</span><span class="p">])</span>
<span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DSPC Model&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Our final project class when printed to the console looks like this :</p>
<div class="sd-tab-set tab-label-hidden docutils">
<input checked="checked" id="sd-tab-item-26" name="sd-tab-set-13" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-26">
Matlab</label><div class="sd-tab-content docutils">
<p>TODO</p>
</div>
<input id="sd-tab-item-27" name="sd-tab-set-13" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-27">
Python</label><div class="sd-tab-content docutils">
<p>TODO</p>
</div>
</div>
<p>To run this, we make a controls block as before, and pass this to RAT. This time we will do a DREAM analysis (see <a class="reference internal" href="../algorithms/index.html#algorithms"><span class="std std-ref">Algorithms</span></a>).</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-28" name="sd-tab-set-14" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-28">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">controls</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">controlsClass</span><span class="p">();</span>
<span class="n">controls</span><span class="p">.</span><span class="n">parallel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;contrasts&#39;</span><span class="p">;</span>
<span class="p">[</span><span class="n">problem</span><span class="p">,</span><span class="n">results</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">RAT</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="n">controls</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-29" name="sd-tab-set-14" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-29">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">controls</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">Controls</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="s1">&#39;contrasts&#39;</span><span class="p">)</span>
<span class="n">problem</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="custom-xy-profile-models">
<h3>Custom XY Profile Models<a class="headerlink" href="#custom-xy-profile-models" title="Link to this heading">#</a></h3>
<p>Although many systems can be well described by layers, sometimes these are not the most appropriate. So for example, we may want to incorporate SLD profiles from molecular simulations, or use interfaces that are not error functions. In these cases, a second type of custom model can be used, where instead of the custom model function outputting a list of layers, it builds a continuous SLD profile, which is then automatically microsliced by RAT to calculate the reflectivity. This gives a high degree of flexibility for the type of model that can be generated.
The inputs into customXY are the same as for Custom Layers, but the output is now always an [n x 2] array defining a continuous SLD:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-30" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-30">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[SLD,subRough]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">myCustomXY</span><span class="p">(</span>params, bulkIn, bulkOut, contrast<span class="p">)</span>

<span class="c">% Some code to define your model</span>

<span class="n">SLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">Y1</span><span class="p">;</span><span class="w"> </span><span class="n">X2</span><span class="p">,</span><span class="w"> </span><span class="n">Y2</span><span class="p">;</span><span class="w"> </span><span class="k">...</span><span class="c">; Xn  Yn];</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-31" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-31">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myCustomXY</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">bulk_in</span><span class="p">,</span> <span class="n">bulk_out</span><span class="p">,</span> <span class="n">contrast</span><span class="p">):</span>

    <span class="c1"># Some code to define your model</span>

    <span class="n">SLD</span> <span class="o">=</span> <span class="p">[[</span><span class="n">X1</span><span class="p">,</span> <span class="n">Y1</span><span class="p">],</span> <span class="p">[</span><span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span><span class="p">],</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="p">[</span><span class="n">Xn</span>  <span class="n">Yn</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">SLD</span><span class="p">,</span> <span class="n">sub_rough</span>
</pre></div>
</div>
</div>
</div>
<p>In other words, as the name suggests, a customXY model outputs a continuous SLD profile rather than a list of layers. THis makes it easy to incorporate information
such as protein volume fractions from simulations, or to make interfaces that are not describes as error functions, for example.</p>
<p>As an example, we will do a simulation of a metal layer on Silicon, with a surface roughness that is governed by a tanh function rather than an error function.</p>
<p>Because we are making the full SLD profile, if we want layers in it then we have to define our own. This is quite easy since a layer is just two error functions back-to-back.
The following code snippet we’ll make an example of a simple layer….</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-32" name="sd-tab-set-16" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-32">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Make a range for our simulation</span>
<span class="n">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">;</span>

<span class="c">% Define fome layer patameters</span>
<span class="nb">height</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">roughLeft</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="n">roughRight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="n">centre</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
<span class="nb">width</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>

<span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">centre</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nb">width</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
<span class="n">l</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">centre</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nb">width</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>

<span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">./</span><span class="p">((</span><span class="mi">2</span>^<span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">roughLeft</span><span class="p">);</span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">./</span><span class="p">((</span><span class="mi">2</span>^<span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">roughRight</span><span class="p">);</span>

<span class="n">f</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">erf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="nb">erf</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>

<span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="nb">clf</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="mi">0</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mf">1.5</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-33" name="sd-tab-set-16" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-33">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a range for our simulation</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>

<span class="c1"># Define fome layer patameters</span>
<span class="n">height</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">roughLeft</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">roughRight</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">centre</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">centre</span> <span class="o">+</span> <span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">centre</span> <span class="o">-</span> <span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mi">2</span><span class="o">^</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">roughLeft</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mi">2</span><span class="o">^</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">roughRight</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">erf</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="mi">0</span> <span class="mi">100</span> <span class="mi">0</span> <span class="mf">1.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/simpleLayer.png"><img alt="simple layer" src="../_images/simpleLayer.png" style="width: 800px;" />
</a>
<p>A simple stack of such layers covers any regions of your model that are intended to be simple layers. For our tanh layer, we will do a similar thing, but replace one side with a tanh distribution…</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-34" name="sd-tab-set-17" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-34">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[SLD,subRough]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">tanhExample</span><span class="p">(</span>params,bulkIn,bulkOut,contrast<span class="p">)</span>

<span class="c">% Flag to control whether we do a debug plot....</span>
<span class="n">debugPlot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="c">% Make the z array.....</span>
<span class="n">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="mi">150</span><span class="p">;</span>

<span class="c">% Split up the parameters...</span>
<span class="n">subRough</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">layerThick</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">layerSLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">layerRough</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c">% Make a layer for the silicon..</span>
<span class="nb">width</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
<span class="p">[</span><span class="n">silicon</span><span class="p">,</span><span class="n">siSurface</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">erfLayer</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="nb">width</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">subRough</span><span class="p">,</span><span class="n">subRough</span><span class="p">,</span><span class="mf">2.073e-6</span><span class="p">);</span>

<span class="c">% Make the tanh layer....</span>
<span class="n">centre</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">siSurface</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">layerThick</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="n">layer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tanhLayer</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">layerThick</span><span class="p">,</span><span class="n">centre</span><span class="p">,</span><span class="n">subRough</span><span class="p">,</span><span class="n">layerRough</span><span class="p">,</span><span class="n">layerSLD</span><span class="p">);</span>

<span class="c">% Our total SLD is just the sum of the functions representing our model,</span>
<span class="c">% but we flip it so that the substrate is on the fight side of the model</span>
<span class="n">silicon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fliplr</span><span class="p">(</span><span class="n">silicon</span><span class="p">);</span>
<span class="n">layer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fliplr</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
<span class="n">SLD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">silicon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">layer</span><span class="p">;</span>

<span class="c">% Do a debug plot...</span>
<span class="k">if</span><span class="w"> </span><span class="n">debugPlot</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="nb">clf</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">silicon</span><span class="p">);</span>
<span class="n">hold</span><span class="w"> </span><span class="s">on</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">layer</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">SLD</span><span class="p">,</span><span class="s">&#39;k-&#39;</span><span class="p">,</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mf">2.0</span><span class="p">);</span>

<span class="k">end</span>

<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>[f,layerSurface]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">erfLayer</span><span class="p">(</span>x,xw,xcen,s1,s2,h<span class="p">);</span>
<span class="c">% Produces a step function convoluted with differnt error functions</span>
<span class="c">% on each side.</span>
<span class="c">% Convstep (x,xw,xcen,s1,s2,h)</span>
<span class="c">%       x = vector of x values</span>
<span class="c">%      xw = Width of step function</span>
<span class="c">%    xcen = Centre point of step function</span>
<span class="c">%       s1 = Roughness parameter of left side</span>
<span class="c">%       s2 = Roughness parameter of right side</span>
<span class="c">%       h = Height of step function.</span>

<span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">xcen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">xw</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
<span class="n">l</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">xcen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">xw</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>

<span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">./</span><span class="p">((</span><span class="mi">2</span>^<span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">s1</span><span class="p">);</span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">./</span><span class="p">((</span><span class="mi">2</span>^<span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">s2</span><span class="p">);</span>

<span class="n">f</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">erf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="nb">erf</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>

<span class="n">layerSurface</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>

<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>[f,layerSurface]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">tanhLayer</span><span class="p">(</span>x,xw,xcen,s1,s2,h<span class="p">);</span>

<span class="c">% tanhlayer (x,xw,xcen,s1,s2,h)</span>
<span class="c">%       x = vector of x values</span>
<span class="c">%      xw = Width of step function</span>
<span class="c">%    xcen = Centre point of step function</span>
<span class="c">%       s1 = Roughness parameter of left side</span>
<span class="c">%       s2 = Roughness parameter of right side</span>
<span class="c">%       h = Height of step function.</span>

<span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">xcen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">xw</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
<span class="n">l</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">xcen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">xw</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>

<span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">./</span><span class="p">((</span><span class="mi">2</span>^<span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">s1</span><span class="p">);</span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">./</span><span class="p">((</span><span class="mi">2</span>^<span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">s2</span><span class="p">);</span>

<span class="n">f</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">erf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="nb">tanh</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>

<span class="n">layerSurface</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>

<span class="k">end</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-35" name="sd-tab-set-17" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-35">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tanhLayer</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">bulk_in</span><span class="p">,</span> <span class="n">bulk_out</span><span class="p">,</span> <span class="n">contrast</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SLD</span><span class="p">,</span> <span class="n">subRough</span>

<span class="n">function</span> <span class="o">=</span> <span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xw</span><span class="p">,</span> <span class="n">xcen</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="c1"># tanhlayer (x, xw, xcen, s1, s2, h)</span>
    <span class="c1">#  x = vector of x values</span>
    <span class="c1">#  xw = Width of step function</span>
    <span class="c1">#  xcen = Centre point of step function</span>
    <span class="c1">#  s1 = Roughness parameter of left side</span>
    <span class="c1">#  s2 = Roughness parameter of right side</span>
    <span class="c1">#  h = Height of step function.</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">layer_surface</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since we want this to be an air-liquid sample, we flip the model once we have created it to leave the substrate on the right of the plot. Broadly speaking,
you can imagine the neutrons travelling left to right, with the left side of the plot being Bulk In, and Bulk Out on the right..</p>
</div>
<p>To run our simulation, we make a RAT model as normal:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-36" name="sd-tab-set-18" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-36">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">createProject</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;custom XY&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">geometry</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Air/substrate&#39;</span><span class="p">);</span>

<span class="c">% Add the parameters</span>
<span class="n">parameters</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{{</span><span class="s">&#39;layerThick&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="w">   </span><span class="mi">50</span><span class="p">,</span><span class="w">   </span><span class="mi">70</span><span class="w">  </span><span class="p">}</span>
<span class="w">            </span><span class="p">{</span><span class="s">&#39;layerSLD&#39;</span><span class="p">,</span><span class="w">  </span><span class="mf">2e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">3e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">4e-6</span><span class="p">}</span>
<span class="w">            </span><span class="p">{</span><span class="s">&#39;layerRough&#39;</span><span class="p">,</span><span class="w">  </span><span class="mi">5</span><span class="p">,</span><span class="w">  </span><span class="mi">8</span><span class="p">,</span><span class="w">    </span><span class="mi">12</span><span class="w">  </span><span class="p">}</span>
<span class="w">            </span><span class="p">};</span>

<span class="n">problem</span><span class="p">.</span><span class="n">addParameterGroup</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span>

<span class="c">% Change the bulk-out to Si.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBulkOut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;SLD Silicon&#39;</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">,</span><span class="mf">2.073e-6</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>

<span class="c">% Add the custom model.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addCustomFile</span><span class="p">(</span><span class="s">&#39;LayerMod&#39;</span><span class="p">,</span><span class="s">&#39;tanhLayer.m&#39;</span><span class="p">,</span><span class="s">&#39;matlab&#39;</span><span class="p">,</span><span class="nb">pwd</span><span class="p">);</span>

<span class="c">% Make the contrast.</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addContrast</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="w">         </span><span class="s">&#39;Simple Layer&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                </span><span class="s">&#39;bulkIn&#39;</span><span class="p">,</span><span class="w">       </span><span class="s">&#39;SLD Air&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                </span><span class="s">&#39;bulkOut&#39;</span><span class="p">,</span><span class="w">      </span><span class="s">&#39;SLD Silicon&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                </span><span class="s">&#39;resolution&#39;</span><span class="p">,</span><span class="w">   </span><span class="s">&#39;Resolution 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                </span><span class="s">&#39;scalefactor&#39;</span><span class="p">,</span><span class="w">  </span><span class="s">&#39;Scalefactor 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                </span><span class="s">&#39;background&#39;</span><span class="p">,</span><span class="w">   </span><span class="s">&#39;Background 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                </span><span class="s">&#39;Data&#39;</span><span class="p">,</span><span class="w">         </span><span class="s">&#39;Simulation&#39;</span><span class="p">);</span>

<span class="n">problem</span><span class="p">.</span><span class="n">setContrastModel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;LayerMod&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-37" name="sd-tab-set-18" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-37">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">RAT</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">Project</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;custom xy&#39;</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;air/substrate&#39;</span><span class="p">)</span>

<span class="c1"># Add the parameters</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;layerThick&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">70.0</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;layerSLD&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">2e-6</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">3e-6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">4e-6</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;layerRough&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">12.0</span><span class="p">)</span>

<span class="c1"># Change the bulk-out to Si.</span>
<span class="n">problem</span><span class="o">.</span><span class="n">bulk_out</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Silicon&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">2.07e-6</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.073e-6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">2.08e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Add the custom model.</span>
<span class="n">problem</span><span class="o">.</span><span class="n">custom_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;LayerMod&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;tanhLayer.py&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>

<span class="c1"># Make the contrast.</span>
<span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Simple Layer&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;Background 1&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;Resolution 1&#39;</span><span class="p">,</span>
                         <span class="n">scalefactor</span><span class="o">=</span><span class="s1">&#39;Scalefactor 1&#39;</span><span class="p">,</span> <span class="n">bulk_out</span><span class="o">=</span><span class="s1">&#39;SLD Silicon&#39;</span><span class="p">,</span> <span class="n">bulk_in</span><span class="o">=</span><span class="s1">&#39;SLD Air&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Simulation&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>run it and plot the results</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-38" name="sd-tab-set-19" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-38">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">problem</span><span class="p">,</span><span class="n">resuts</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">RAT</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="n">controls</span><span class="p">);</span>

<span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="nb">clf</span><span class="p">;</span>
<span class="n">plotRefSLD</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="n">results</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-39" name="sd-tab-set-19" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-39">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">,</span><span class="n">resuts</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>
<span class="n">RAT</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_ref_sld</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/customTwoLayerFig.png"><img alt="Dtwo layers XY" src="../_images/customTwoLayerFig.png" style="width: 500px;" />
</a>
<p>When sent to RAT, customXY SLD profiles are automatically resampled into layers with adaptive resampling:</p>
<a class="reference internal image-reference" href="../_images/twoLayerRAT.png"><img alt="Displays the final customXY result" src="../_images/twoLayerRAT.png" style="width: 800px;" />
</a>
</section>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-layers-models">Custom Layers Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dspc-bilayer-example">DSPC Bilayer Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-xy-profile-models">Custom XY Profile Models</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/tutorial/customModels.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022-2024, ISIS Neutron and Muon Source.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>
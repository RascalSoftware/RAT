<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of plotBayesCorrFig</title>
  <meta name="keywords" content="plotBayesCorrFig">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # utilities --><!-- # plotting -->
<h1>plotBayesCorrFig
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function plotBayesCorrFig(chain, fitNames, hFig) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="plotBayes.html" class="code" title="function plotBayes(problem,results,varargin)">plotBayes</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function findax = findaxpos(ax, axpos)</a></li><li><a href="#_sub2" class="code">function smoothhist2DLocal(X,lambda,nbins,outliercutoff,plottype)</a></li><li><a href="#_sub3" class="code">function Z = smooth1D(Y,lambda)</a></li><li><a href="#_sub4" class="code">function Z = filter2D(Y,bw)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function plotBayesCorrFig(chain, fitNames, hFig)</a>
0002 
0003 x = chain;
0004 y = chain;
0005 
0006 nPars = size(chain,2);
0007 <span class="keyword">for</span> i = 1:nPars
0008     
0009     [N,edges] = histcounts(chain(:,i),15, <span class="string">'Normalization'</span>,<span class="string">'pdf'</span>);
0010     edges2 = edges(2:end) - (edges(2)-edges(1))/2;
0011     N2 = smoothdata(N, <span class="string">'movmean'</span>);
0012     newDists{i} = [N2(:) edges2(:)];
0013     
0014 <span class="keyword">end</span>
0015 
0016 rows = size(chain,2);
0017 cols = rows;
0018 figure(hFig);
0019 parent = handle(get(groot, <span class="string">'CurrentFigure'</span>));
0020 <span class="comment">% inLayout=isa(parent,'matlab.graphics.layout.Layout');</span>
0021 <span class="comment">% if inLayout &amp;&amp; isempty(cax)</span>
0022     cax=gca;
0023 <span class="comment">%end</span>
0024 
0025 <span class="comment">% Create/find BigAx and make it invisible</span>
0026 BigAx = newplot(cax);
0027 fig = ancestor(BigAx,<span class="string">'figure'</span>);
0028 hold_state = ishold(BigAx);
0029 set(BigAx,<span class="string">'Visible'</span>,<span class="string">'off'</span>,<span class="string">'color'</span>,<span class="string">'none'</span>)
0030 disableDefaultInteractivity(BigAx);
0031 
0032 units = get(BigAx,<span class="string">'units'</span>);
0033 set(BigAx,<span class="string">'units'</span>,<span class="string">'pixels'</span>);
0034 pos = get(BigAx,<span class="string">'Position'</span>);
0035 set(BigAx,<span class="string">'units'</span>,units);
0036 markersize = max(1,min(15,round(15*min(pos(3:4))/max(1,size(x,1))/max(rows,cols))));
0037 
0038 <span class="comment">% Create and plot into axes</span>
0039 ax = gobjects(rows,cols);
0040 pos = get(BigAx,<span class="string">'Position'</span>);
0041 BigAxUnits = get(BigAx,<span class="string">'Units'</span>);
0042 width = pos(3)/cols;
0043 height = pos(4)/rows;
0044 space = .07; <span class="comment">% 2 percent space between axes</span>
0045 pos(1:2) = pos(1:2) + space*[width height];
0046 m = size(y,1);
0047 k = size(y,3);
0048 xlim = zeros([rows cols 2]);
0049 ylim = zeros([rows cols 2]);
0050 BigAxHV = get(BigAx,<span class="string">'HandleVisibility'</span>);
0051 BigAxParent = get(BigAx,<span class="string">'Parent'</span>);
0052 <span class="comment">% if inLayout</span>
0053 <span class="comment">%     % In TiledChartLayouts BigAx will be parented to the layout, but the</span>
0054 <span class="comment">%     % visible axes (which use BigAxParent below) will be parented to the</span>
0055 <span class="comment">%     % container holding the layout.</span>
0056 <span class="comment">%     BigAxParent=ancestor(BigAx, 'matlab.ui.container.CanvasContainer','node');</span>
0057 <span class="comment">% end</span>
0058 
0059 paxes = findobj(fig,<span class="string">'Type'</span>,<span class="string">'axes'</span>,<span class="string">'tag'</span>,<span class="string">'PlotMatrixScatterAx'</span>);
0060 
0061 <span class="keyword">for</span> i=rows:-1:1
0062     <span class="keyword">for</span> j=i:-1:1
0063         axPos = [pos(1)+(j-1)*width pos(2)+(rows-i)*height <span class="keyword">...</span>
0064             width*(1-space) height*(1-space)];
0065         findax = <a href="#_sub1" class="code" title="subfunction findax = findaxpos(ax, axpos)">findaxpos</a>(paxes, axPos);
0066         <span class="keyword">if</span> isempty(findax)
0067             ax(i,j) = axes(<span class="string">'Units'</span>,BigAxUnits,<span class="string">'Position'</span>,axPos,<span class="string">'HandleVisibility'</span>,BigAxHV,<span class="string">'parent'</span>,BigAxParent, <span class="string">'Toolbar'</span>, []);
0068             set(ax(i,j),<span class="string">'visible'</span>,<span class="string">'on'</span>,<span class="string">'box'</span>,<span class="string">'on'</span>);
0069         <span class="keyword">else</span>
0070             ax(i,j) = findax(1);
0071         <span class="keyword">end</span>
0072         
0073         xx = reshape(x(:,j,:),[m k]);
0074         yy = reshape(y(:,i,:),[m k]);
0075         
0076         data = [xx(:) yy(:)];
0077         
0078 <span class="comment">%        smoothhist2DLocal(data,30,[200 200]);</span>
0079 <span class="comment">%         [ctrs1,ctrs2,F] = makeSmoothHist2D(date,20,[200 200]);</span>
0080 <span class="comment">%         contourf(ctrs1,ctrs2,F);</span>
0081 <span class="comment">%         colormap(gca,[1 1 1; 0.7 0.7 0.7; 0.3 0.3 0.3]);</span>
0082         
0083         <span class="comment">%n = hist3(data,[30 30]);</span>
0084         
0085         plot(xx,yy,<span class="string">'.'</span>,<span class="string">'parent'</span>,ax(i,j));
0086         <span class="comment">%contour(ax(i,j),n,[20 20],'k-');</span>
0087         <span class="comment">%axes(ax(i,j));</span>
0088         <span class="comment">%contour(n,20);</span>
0089         <span class="comment">%pcolor(n);</span>
0090         
0091         hh(i,j,:) = ax(i,j);
0092         
0093         set(hh(i,j,:),<span class="string">'Visible'</span>,<span class="string">'on'</span>,<span class="string">'Tag'</span>,<span class="string">'corrAxis'</span>);
0094         
0095         set(ax(i,j),<span class="string">'xlimmode'</span>,<span class="string">'auto'</span>,<span class="string">'ylimmode'</span>,<span class="string">'auto'</span>,<span class="string">'xgrid'</span>,<span class="string">'off'</span>,<span class="string">'ygrid'</span>,<span class="string">'off'</span>);
0096         
0097         <span class="keyword">if</span> j ~= 1
0098             set(ax(i,j),<span class="string">'YTick'</span>,[]);
0099         <span class="keyword">end</span>
0100         
0101         <span class="keyword">if</span> i ~= rows
0102             set(ax(i,j),<span class="string">'XTick'</span>,[]);
0103         <span class="keyword">end</span>
0104         
0105         xlim(i,j,:) = get(ax(i,j),<span class="string">'xlim'</span>);
0106         ylim(i,j,:) = get(ax(i,j),<span class="string">'ylim'</span>);
0107         
0108         <span class="comment">% Disable AxesToolbar</span>
0109         currAx = ax(i,j);
0110         currAx.Toolbar = [];
0111     <span class="keyword">end</span>
0112 <span class="keyword">end</span>
0113 
0114 xlimmin = min(xlim(:,:,1),[],1); xlimmax = max(xlim(:,:,2),[],1);
0115 ylimmin = min(ylim(:,:,1),[],2); ylimmax = max(ylim(:,:,2),[],2);
0116 
0117 <span class="comment">% Try to be smart about axes limits and labels.  Set all the limits of a</span>
0118 <span class="comment">% row or column to be the same and inset the tick marks by 10 percent.</span>
0119 <span class="comment">% inset = .15;</span>
0120 <span class="comment">% for i=1:rows</span>
0121 <span class="comment">%     thisAx = ax(i,1);</span>
0122 <span class="comment">%     if strcmpi(get(thisAx,'Tag'),'corrAxis')</span>
0123 <span class="comment">%         set(thisAx,'ylim',[ylimmin(i,1) ylimmax(i,1)])</span>
0124 <span class="comment">%         dy = diff(get(ax(i,1),'ylim'))*inset;</span>
0125 <span class="comment">%         set(thisAx,'ylim',[ylimmin(i,1)-dy ylimmax(i,1)+dy])</span>
0126 <span class="comment">%     end</span>
0127 <span class="comment">% end</span>
0128 <span class="comment">% dx = zeros(1,cols);</span>
0129 <span class="comment">% for j=1:cols</span>
0130 <span class="comment">%     if strcmpi(class(ax(1,j)),'matlab.graphics.axis.Axes')</span>
0131 <span class="comment">%         set(ax(1,j),'xlim',[xlimmin(1,j) xlimmax(1,j)])</span>
0132 <span class="comment">%         dx(j) = diff(get(ax(1,j),'xlim'))*inset;</span>
0133 <span class="comment">%         set(ax(:,j),'xlim',[xlimmin(1,j)-dx(j) xlimmax(1,j)+dx(j)])</span>
0134 <span class="comment">%     end</span>
0135 <span class="comment">% end</span>
0136 
0137 <span class="comment">% for n = 1:rows-1</span>
0138 <span class="comment">%     if strcmpi(class(ax(1,j)),'matlab.graphics.axis.Axes')</span>
0139 <span class="comment">%         set(ax(n,:),'xticklabel','')</span>
0140 <span class="comment">%     end</span>
0141 <span class="comment">% end</span>
0142 <span class="comment">% set(ax(:,2:cols),'yticklabel','')</span>
0143 <span class="comment">% set(BigAx,'XTick',get(ax(rows,1),'xtick'),'YTick',get(ax(rows,1),'ytick'), ...</span>
0144 <span class="comment">%     'YLim',get(ax(rows,1),'ylim'),... %help Axes make room for y-label</span>
0145 <span class="comment">%     'tag','PlotMatrixBigAx')</span>
0146 <span class="comment">% set(ax,'tag','PlotMatrixScatterAx');</span>
0147 
0148 dohist = 1;
0149 <span class="keyword">if</span> dohist <span class="comment">% Put a histogram on the diagonal for plotmatrix(y) case</span>
0150     histAxes = gobjects(1, rows);
0151     paxes = findobj(fig,<span class="string">'Type'</span>,<span class="string">'axes'</span>,<span class="string">'tag'</span>,<span class="string">'PlotMatrixHistAx'</span>);
0152     pax = gobjects(1, rows);
0153     <span class="keyword">for</span> i=rows:-1:1
0154         axPos = get(ax(i,i),<span class="string">'Position'</span>);
0155         findax = <a href="#_sub1" class="code" title="subfunction findax = findaxpos(ax, axpos)">findaxpos</a>(paxes, axPos);
0156         <span class="keyword">if</span> isempty(findax)
0157             axUnits = get(ax(i,i),<span class="string">'Units'</span>);
0158             histax = axes(<span class="string">'Units'</span>,axUnits,<span class="string">'Position'</span>,axPos,<span class="string">'HandleVisibility'</span>,BigAxHV,<span class="string">'parent'</span>,BigAxParent, <span class="string">'Toolbar'</span>, []);
0159             set(histax,<span class="string">'visible'</span>,<span class="string">'on'</span>);
0160             histAxes(i) = histax;
0161         <span class="keyword">else</span>
0162             histax = findax(1);
0163         <span class="keyword">end</span>
0164         thisHist = newDists{i};
0165         hhist(i) = bar(thisHist(:,2),thisHist(:,1),<span class="string">'w'</span>);
0166         
0167         <span class="comment">%hhist(i) = histogram(histax,y(:,i,:));</span>
0168 <span class="comment">%         set(histax,'xtick',[],'ytick',[],'xgrid','off','ygrid','off');</span>
0169 <span class="comment">%         set(histax,'xlim',[xlimmin(1,i)-dx(i) xlimmax(1,i)+dx(i)])</span>
0170         set(histax,<span class="string">'tag'</span>,<span class="string">'PlotMatrixHistAx'</span>,<span class="string">'YTick'</span>,[],<span class="string">'TitleFontSizeMultiplier'</span>,0.8);
0171         ht = title(histax,split(fitNames{i}));
0172         
0173         
0174         <span class="keyword">if</span> i ~= rows
0175             set(histax,<span class="string">'XTick'</span>,[]);
0176         <span class="keyword">end</span>
0177         
0178         <span class="comment">% Disable the AxesToolbar</span>
0179         histax.Toolbar = [];
0180         pax(i) = histax;  <span class="comment">% ax handles for histograms</span>
0181     <span class="keyword">end</span>
0182 <span class="keyword">else</span>
0183     histAxes = []; <span class="comment">% Make empty for listener</span>
0184 <span class="keyword">end</span>
0185 
0186 drawnow;
0187 
0188 <span class="keyword">end</span>
0189 
0190 <a name="_sub1" href="#_subfunctions" class="code">function findax = findaxpos(ax, axpos)</a>
0191 tol = eps;
0192 findax = [];
0193 <span class="keyword">for</span> i = 1:length(ax)
0194     axipos = get(ax(i),<span class="string">'Position'</span>);
0195     diffpos = axipos - axpos;
0196     <span class="keyword">if</span> (max(max(abs(diffpos))) &lt; tol)
0197         findax = ax(i);
0198         <span class="keyword">break</span>;
0199     <span class="keyword">end</span>
0200 <span class="keyword">end</span>
0201 
0202 <span class="keyword">end</span>
0203 
0204 <a name="_sub2" href="#_subfunctions" class="code">function smoothhist2DLocal(X,lambda,nbins,outliercutoff,plottype)</a>
0205 <span class="comment">% SMOOTHHIST2D Plot a smoothed histogram of bivariate data.</span>
0206 <span class="comment">%   SMOOTHHIST2D(X,LAMBDA,NBINS) plots a smoothed histogram of the bivariate</span>
0207 <span class="comment">%   data in the N-by-2 matrix X.  Rows of X correspond to observations.  The</span>
0208 <span class="comment">%   first column of X corresponds to the horizontal axis of the figure, the</span>
0209 <span class="comment">%   second to the vertical. LAMBDA is a positive scalar smoothing parameter;</span>
0210 <span class="comment">%   higher values lead to more smoothing, values close to zero lead to a plot</span>
0211 <span class="comment">%   that is essentially just the raw data.  NBINS is a two-element vector</span>
0212 <span class="comment">%   that determines the number of histogram bins in the horizontal and</span>
0213 <span class="comment">%   vertical directions.</span>
0214 <span class="comment">%</span>
0215 <span class="comment">%   SMOOTHHIST2D(X,LAMBDA,NBINS,CUTOFF) plots outliers in the data as points</span>
0216 <span class="comment">%   overlaid on the smoothed histogram.  Outliers are defined as points in</span>
0217 <span class="comment">%   regions where the smoothed density is less than (100*CUTOFF)% of the</span>
0218 <span class="comment">%   maximum density.</span>
0219 <span class="comment">%</span>
0220 <span class="comment">%   SMOOTHHIST2D(X,LAMBDA,NBINS,[],'surf') plots a smoothed histogram as a</span>
0221 <span class="comment">%   surface plot.  SMOOTHHIST2D ignores the CUTOFF input in this case, and</span>
0222 <span class="comment">%   the surface plot does not include outliers.</span>
0223 <span class="comment">%</span>
0224 <span class="comment">%   SMOOTHHIST2D(X,LAMBDA,NBINS,CUTOFF,'image') plots the histogram as an</span>
0225 <span class="comment">%   image plot, the default.</span>
0226 <span class="comment">%</span>
0227 <span class="comment">%   Example:</span>
0228 <span class="comment">%       X = [mvnrnd([0 5], [3 0; 0 3], 2000);</span>
0229 <span class="comment">%            mvnrnd([0 8], [1 0; 0 5], 2000);</span>
0230 <span class="comment">%            mvnrnd([3 5], [5 0; 0 1], 2000)];</span>
0231 <span class="comment">%       smoothhist2D(X,5,[100, 100],.05);</span>
0232 <span class="comment">%       smoothhist2D(X,5,[100, 100],[],'surf');</span>
0233 <span class="comment">%</span>
0234 <span class="comment">%   Reference:</span>
0235 <span class="comment">%      Eilers, P.H.C. and Goeman, J.J (2004) &quot;Enhancing scaterplots with</span>
0236 <span class="comment">%      smoothed densities&quot;, Bioinformatics 20(5):623-628.</span>
0237 
0238 <span class="comment">%   Copyright 2009 The MathWorks, Inc.</span>
0239 <span class="comment">%   Revision: 1.0  Date: 2006/12/12</span>
0240 <span class="comment">%</span>
0241 <span class="comment">%   Requires MATLABÂ® R14.</span>
0242 
0243 <span class="keyword">if</span> nargin &lt; 4 || isempty(outliercutoff), outliercutoff = .05; <span class="keyword">end</span>
0244 <span class="keyword">if</span> nargin &lt; 5, plottype = <span class="string">'image'</span>; <span class="keyword">end</span>
0245 
0246 minx = min(X,[],1);
0247 maxx = max(X,[],1);
0248 edges1 = linspace(minx(1), maxx(1), nbins(1)+1);
0249 ctrs1 = edges1(1:end-1) + .5*diff(edges1);
0250 edges1 = [-Inf edges1(2:end-1) Inf];
0251 edges2 = linspace(minx(2), maxx(2), nbins(2)+1);
0252 ctrs2 = edges2(1:end-1) + .5*diff(edges2);
0253 edges2 = [-Inf edges2(2:end-1) Inf];
0254 
0255 [n,p] = size(X);
0256 bin = zeros(n,2);
0257 <span class="comment">% Reverse the columns of H to put the first column of X along the</span>
0258 <span class="comment">% horizontal axis, the second along the vertical.</span>
0259 [dum,bin(:,2)] = histc(X(:,1),edges1);
0260 [dum,bin(:,1)] = histc(X(:,2),edges2);
0261 H = accumarray(bin,1,nbins([2 1])) ./ n;
0262 
0263 <span class="comment">% Eiler's 1D smooth, twice</span>
0264 G = <a href="#_sub3" class="code" title="subfunction Z = smooth1D(Y,lambda)">smooth1D</a>(H,lambda);
0265 F = <a href="#_sub3" class="code" title="subfunction Z = smooth1D(Y,lambda)">smooth1D</a>(G',lambda)';
0266 <span class="comment">% % An alternative, using filter2.  However, lambda means totally different</span>
0267 <span class="comment">% % things in this case: for smooth1D, it is a smoothness penalty parameter,</span>
0268 <span class="comment">% % while for filter2D, it is a window halfwidth</span>
0269 <span class="comment">% F = filter2D(H,lambda);</span>
0270 
0271 relF = F./max(F(:));
0272 <span class="keyword">if</span> outliercutoff &gt; 0
0273     outliers = (relF(nbins(2)*(bin(:,2)-1)+bin(:,1)) &lt; outliercutoff);
0274 <span class="keyword">end</span>
0275 
0276 nc = 256;
0277 contour(ctrs1,ctrs2,F)
0278 <span class="comment">%colormap(gca,[1 1 1; 0.7 0.7 0.7; 0.3 0.3 0.3])</span>
0279 
0280 
0281 <span class="comment">% colormap(hot(nc));</span>
0282 <span class="comment">% switch plottype</span>
0283 <span class="comment">% case 'surf'</span>
0284 <span class="comment">%     surf(ctrs1,ctrs2,F,'edgealpha',0);</span>
0285 <span class="comment">% case 'image'</span>
0286 <span class="comment">%     image(ctrs1,ctrs2,floor(nc.*relF) + 1);</span>
0287 <span class="comment">%     hold on</span>
0288 <span class="comment">%     % plot the outliers</span>
0289 <span class="comment">%     if outliercutoff &gt; 0</span>
0290 <span class="comment">%         plot(X(outliers,1),X(outliers,2),'.','MarkerEdgeColor',[.8 .8 .8]);</span>
0291 <span class="comment">%     end</span>
0292 <span class="comment">% %     % plot a subsample of the data</span>
0293 <span class="comment">% %     Xsample = X(randsample(n,n/10),:);</span>
0294 <span class="comment">% %     plot(Xsample(:,1),Xsample(:,2),'bo');</span>
0295 <span class="comment">%     hold off</span>
0296 <span class="comment">% end</span>
0297 <span class="keyword">end</span>
0298 <span class="comment">%-----------------------------------------------------------------------------</span>
0299 <a name="_sub3" href="#_subfunctions" class="code">function Z = smooth1D(Y,lambda)</a>
0300 [m,n] = size(Y);
0301 E = eye(m);
0302 D1 = diff(E,1);
0303 D2 = diff(D1,1);
0304 P = lambda.^2 .* D2'*D2 + 2.*lambda .* D1'*D1;
0305 Z = (E + P) \ Y;
0306 <span class="comment">% This is a better solution, but takes a bit longer for n and m large</span>
0307 <span class="comment">% opts.RECT = true;</span>
0308 <span class="comment">% D1 = [diff(E,1); zeros(1,n)];</span>
0309 <span class="comment">% D2 = [diff(D1,1); zeros(1,n)];</span>
0310 <span class="comment">% Z = linsolve([E; 2.*sqrt(lambda).*D1; lambda.*D2],[Y; zeros(2*m,n)],opts);</span>
0311 <span class="keyword">end</span>
0312 
0313 <span class="comment">%-----------------------------------------------------------------------------</span>
0314 <a name="_sub4" href="#_subfunctions" class="code">function Z = filter2D(Y,bw)</a>
0315 z = -1:(1/bw):1;
0316 k = .75 * (1 - z.^2); <span class="comment">% epanechnikov-like weights</span>
0317 k = k ./ sum(k);
0318 Z = filter2(k'*k,Y);
0319 
0320 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 14-Jun-2022 14:25:37 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API &mdash; RAT 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/design-tabs.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Target Functions" href="targetFunctions.html" />
    <link rel="prev" title="Source Code Layout" href="sourceCodeLayout.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> RAT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">RAT Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="sourceCodeLayout.html">Source Code Layout</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#project-class">Project Class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameters-class">Parameters Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layers-in-project-class">Layers in Project Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bulk-in-and-bulk-out">Bulk In and Bulk Out</a></li>
<li class="toctree-l4"><a class="reference internal" href="#background-class">Background Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-class">Data Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-file-class">Custom File Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contrast-class">Contrast Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resolution-class">Resolution Class</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#controlsdef">ControlsDef</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rat">RAT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="targetFunctions.html">Target Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="devDocumentation.html">Developer Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ADR.html">Architectural Decision Records</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="userDocumentation.html">User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About RAT</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RAT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="sourceCodeLayout.html">Source Code Layout</a></li>
      <li class="breadcrumb-item active">API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="api">
<span id="id1"></span><h1>API<a class="headerlink" href="#api" title="Permalink to this heading"></a></h1>
<p>API is the folder that contains the two main classes of RAT are. They are <strong>Project Class</strong> and <strong>ControlsDef Class</strong> and these are the classes user interacts with.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The “API” name comes from the generalised view how APIs work. In this case, the API sends the information back and forth from the top level classes to targetFunctions.</p>
</div>
<section id="project-class">
<span id="projectclass"></span><h2>Project Class<a class="headerlink" href="#project-class" title="Permalink to this heading"></a></h2>
<p>Project Class is all about data. It contains the very data user wants to work with. It stores all the data required for reflectivity calculations.
Everything in RAT comes from projectClass in one way or another. There are many functions that deal with breaking down the data from Project Class into smaller pieces
so that they can be used in other parts of the software.</p>
<p>Project Class has lot of other classes that help create objects for inputs. They are :</p>
<ol class="arabic simple">
<li><p>Parameter Class</p></li>
<li><p>Resolution Class</p></li>
<li><p>Data Class</p></li>
<li><p>Contrasts Class</p></li>
<li><p>Custom File Class</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most of these classes have the following in common:</p>
<ol class="arabic simple">
<li><p>They are all called from Project Class.</p></li>
<li><p>Methods to add or remove or change an attribute depending on the class.</p></li>
<li><p>Methods to find the location based on input value. Finding row when given an atrribute’s name or vice versa (Not all of them though).</p></li>
<li><dl class="simple">
<dt>Display methods</dt><dd><ol class="arabic simple" start="5">
<li><p>A ‘toStruct’ method which output the class parameters as a struct.</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
</div>
<section id="parameters-class">
<h3>Parameters Class<a class="headerlink" href="#parameters-class" title="Permalink to this heading"></a></h3>
<p>Parameters Class helps to add,set or remove parameters to the Project Class. The class has a constructor that gets initiated when Parameter class is called. This constructor
sets important inital values to the class obj (object) like variable name, types. It also initiates a “table” that helps to store all the parameters. Table is a really usefull
data type provided by matlab. Check this link to know more about <a class="reference external" href="https://uk.mathworks.com/help/matlab/tables.html">table</a>.</p>
<table class="colwidths-given docutils align-default" id="id3">
<caption><span class="caption-text">The methods on the left call the methods on the right in the table.</span><a class="headerlink" href="#id3" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method in Project Class</p></th>
<th class="head"><p>Method in Parameters Class</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>projectClass.addParamGroup()</p></td>
<td><p>parametersClass.addParam()</p></td>
</tr>
<tr class="row-odd"><td><p>projectClass.addParam()</p></td>
<td><p>parametersClass.addParam()</p></td>
</tr>
<tr class="row-even"><td><p>projectClass.removeParam()</p></td>
<td><p>parametersClass.removeParam()</p></td>
</tr>
<tr class="row-odd"><td><p>projectClass.setParameter()</p></td>
<td><p>parametersClass.setParameter()</p></td>
</tr>
<tr class="row-even"><td><p>projectClass.setParameter()</p></td>
<td><p>parametersClass.setValue()</p></td>
</tr>
</tbody>
</table>
<p>When adding parameters, they can be added individually or as a group (see below). When added as a group, <cite>addParamGroup</cite> method in projectClass iterates over the
list of parameters and adds them one by one using <cite>addParam</cite> method which is used to add individual parameters.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Adding parameters as a group. Can set to a class using projectClass.addParamGroup(Parameters)</span><a class="headerlink" href="#id4" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">Parameters</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c">%   Name                min         val         max     fit?</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Oxide thick&#39;</span><span class="p">,</span><span class="w">         </span><span class="mi">5</span><span class="p">,</span><span class="w">         </span><span class="mi">20</span><span class="p">,</span><span class="w">         </span><span class="mi">60</span><span class="p">,</span><span class="w">     </span><span class="nb">true</span><span class="w">   </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Oxide SLD&#39;</span><span class="p">,</span><span class="w">           </span><span class="mf">3e-6</span><span class="p">,</span><span class="w">       </span><span class="mf">3.41e-6</span><span class="p">,</span><span class="w">    </span><span class="mf">4e-6</span><span class="p">,</span><span class="w">   </span><span class="nb">false</span><span class="w">  </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Oxide Hydration&#39;</span><span class="w">      </span><span class="mi">0</span><span class="p">,</span><span class="w">          </span><span class="mi">20</span><span class="p">,</span><span class="w">         </span><span class="mi">30</span><span class="p">,</span><span class="w">     </span><span class="nb">true</span><span class="w">   </span><span class="p">}};</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Adding parameters individually. Can set to a class using projectClass.addParam(Parameter)</span><a class="headerlink" href="#id5" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">Oxide</span><span class="w"> </span><span class="p">=</span><span class="w">     </span><span class="p">{</span><span class="s">&#39;Oxide Layer&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">          % Name of the layer</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;Oxide thick&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">           % Layer thickness</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;Oxide SLD&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">             % Layer SLD</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;Substrate Roughness&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">   % Layer roughness</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;Oxide Hydration&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">       % Oxide hydration (precent)</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;bulk out&#39;</span><span class="w"> </span><span class="p">};</span><span class="w">               </span><span class="c">% Which bulk phase is hydrating the layer</span><span class="w"></span>

<span class="c">% Add this to the projectClass...</span><span class="w"></span>
<span class="n">projectClass</span><span class="p">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">Oxide</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>When <em>addParam</em> method is called, the method checks the input through a series of checks to find out
if there are any unexpected values at unexpected places. For example, having logical value in place of a numerical value argument. With <em>setParameter</em> method,
one can set the value of any parameter independently. However, there are other methods that helps setting individual parameters. For example, <em>setName</em> method helps
to set the name of a parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>You can add Bulk in and Bulk out with this class</p></li>
<li><p>You can add scale factor with this class</p></li>
</ol>
</div>
</section>
<section id="layers-in-project-class">
<h3>Layers in Project Class<a class="headerlink" href="#layers-in-project-class" title="Permalink to this heading"></a></h3>
<p>Like Parameters, Layers can be added as a group or individually. When added as a group, <cite>addLayerGroup</cite> method in projectClass iterates over the list of layers and
adds them one by one using <cite>addLayer</cite> method which is used to add individual layers.</p>
<table class="colwidths-given docutils align-default" id="id6">
<caption><span class="caption-text">The methods on the left call the methods on the right in the table.</span><a class="headerlink" href="#id6" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method in Project Class</p></th>
<th class="head"><p>Method in Layers Class</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>projectClass.addLayerGroup()</p></td>
<td><p>layersClass_realSLD.addLayer()</p></td>
</tr>
<tr class="row-odd"><td><p>projectClass.addLayer()</p></td>
<td><p>layersClass_realSLD.addLayer()</p></td>
</tr>
<tr class="row-even"><td><p>projectClass.setLayerValue()</p></td>
<td><p>layersClass_realSLD.setLayerValue()</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Adding layers as a group. Can set to a class using projectClass.addLayerGroup(Layers)</span><a class="headerlink" href="#id7" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">projectClass</span><span class="p">.</span><span class="n">addLayerGroup</span><span class="p">({</span><span class="n">waterLayer</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">bilInnerHead</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">bilTails</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">bilOuterHead</span><span class="p">})</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Adding layers individually. Can set to a class using projectClass.addLayer(Layer)</span><a class="headerlink" href="#id8" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">waterLayer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;Water Layer&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">           % Layer name</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;Water thick&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;Water SLD&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;Bilayer heads rough&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">    % Outer interface of the water layer is a bilayer headgroup</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;Water hydr&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;Bulk out&#39;</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="n">projectClass</span><span class="p">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">waterLayer</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="bulk-in-and-bulk-out">
<h3>Bulk In and Bulk Out<a class="headerlink" href="#bulk-in-and-bulk-out" title="Permalink to this heading"></a></h3>
<p>Bulk In and Bulk Out are ……………………to be added. They are set using the <cite>addParam</cite> method in parameter class since they have the same columns in the table.</p>
<table class="colwidths-given docutils align-default" id="id9">
<caption><span class="caption-text">The methods on the left call the methods on the right in the table.</span><a class="headerlink" href="#id9" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method in Project Class</p></th>
<th class="head"><p>Method in Parameter Class</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>projectClass.addBulkIn/addBulkOut()</p></td>
<td><p>parametersClass.addParam()</p></td>
</tr>
<tr class="row-odd"><td><p>projectClass.removeBulkIn/removeBulkOut()</p></td>
<td><p>parametersClass.removeParam()</p></td>
</tr>
<tr class="row-even"><td><p>projectClass.setBulkIn/setBulkOut()</p></td>
<td><p>parametersClass.setParameter()</p></td>
</tr>
</tbody>
</table>
<p>Although, Project class provides one level higher interface so that one can use <cite>addBulkIn</cite> and <cite>addBulkOut</cite> methods from projectClass to set these parameters.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Adding Bulk Out. Can set to a class using projectClass.addBulkOut(BulkIn)</span><a class="headerlink" href="#id10" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c">%                   Name       min     val   max  fit?</span><span class="w"></span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">addBulkOut</span><span class="p">({</span><span class="s">&#39;SLD SMW&#39;</span><span class="p">,</span><span class="mf">2e-6</span><span class="p">,</span><span class="mf">2.073e-6</span><span class="p">,</span><span class="mf">3e-6</span><span class="p">,</span><span class="nb">true</span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
</div>
<p><cite>setParameter</cite> or <cite>setBulk(In/Out)</cite> does the same thing which is converting cell array to struct.</p>
</section>
<section id="background-class">
<h3>Background Class<a class="headerlink" href="#background-class" title="Permalink to this heading"></a></h3>
<p>This class makes the backgrounds in RAT. Backgrounds are defined in a two stage process. Firstly we define the actual fitted parameters.
These are held in a ‘ParametersClass’ table. Then, we group these into the backgrounds themselves using a multiTypeTable(<a class="reference external" href="https://uk.mathworks.com/help/matlab/tables.html">table</a>). So, we can then use the
background parameters to either define background as constant, data or a function.</p>
<table class="colwidths-given docutils align-default" id="id11">
<caption><span class="caption-text">The methods on the left call the methods on the right in the table.</span><a class="headerlink" href="#id11" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method in Project Class</p></th>
<th class="head"><p>Method in backgroundsClass</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>projectClass.addBacksPar()</p></td>
<td><p>backgroundsClass.addBacksPar()</p></td>
</tr>
<tr class="row-odd"><td><p>projectClass.removeBacksPar()</p></td>
<td><p>backgroundsClass.removeBacksPar()</p></td>
</tr>
<tr class="row-even"><td><p>projectClass.setBacksPar()</p></td>
<td><p>backgroundsClass.setBacksPar()</p></td>
</tr>
<tr class="row-odd"><td><p>projectClass.addBackground()</p></td>
<td><p>backgroundsClass.addBackground()</p></td>
</tr>
<tr class="row-even"><td><p>projectClass.removeBackground()</p></td>
<td><p>backgroundsClass.removeBackground()</p></td>
</tr>
<tr class="row-odd"><td><p>projectClass.setBackground{Value/Name}()</p></td>
<td><p>backgroundsClass.setBackground{Value/Name}()</p></td>
</tr>
</tbody>
</table>
<p>Some of the methods of Background Class are:</p>
<ol class="arabic simple">
<li><p><cite>addBacksPar</cite> - This method adds the parameter to the back parameter table.</p></li>
<li><p><cite>setBacksParValue</cite> - Set a parameter value in the back parameter table.</p></li>
<li><p><cite>removeBacksPar</cite> - Remove a parameter from the backsPar/ back parameter table.</p></li>
<li><p><cite>addBackground</cite> - Add a background to the background table.</p></li>
<li><p><cite>setBackgroundValue</cite> - Set a background value in the background table. (Based on row)</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>For constant, only one parameter is supplied to multi type table.</p></li>
<li><p>For data, only the data itself is supplied as a cell.</p></li>
<li><p>For function, the function name is supplied, along with up to three parameters (from the parameters table) which are then supplied to the function to
calculate the background.</p></li>
</ol>
</div>
<p>In each case, the background can either be added to the simulation or subtracted from the data.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Example showing how backgroundsClass methods are called.</span><a class="headerlink" href="#id12" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c">% Change the name of the existing parameters to refer to D2O</span><span class="w"></span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">setBacksPar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;Backs par D2O&#39;</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">,</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mf">1e-8</span><span class="p">,</span><span class="s">&#39;max&#39;</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c">% Add a new constant background</span><span class="w"></span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">addBackground</span><span class="p">(</span><span class="s">&#39;Background SMW&#39;</span><span class="p">,</span><span class="s">&#39;constant&#39;</span><span class="p">,</span><span class="s">&#39;Backs par SMW&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<section id="multi-type-table">
<h4>Multi-Type Table<a class="headerlink" href="#multi-type-table" title="Permalink to this heading"></a></h4>
<p>Multi-type Table is a custom table type. It is a general type of table that can altered to one’s needs by taking advantage of methods that allow
adding rows, setting values of an element, etc. This class is used in Background Class.</p>
</section>
</section>
<section id="data-class">
<h3>Data Class<a class="headerlink" href="#data-class" title="Permalink to this heading"></a></h3>
<p>Data Class is a class to helps add or set data. Data can be addded using <cite>addData</cite> method. The <cite>addData</cite> method expects a cell array of cell array. Like other methods there’s
a check that directs different cases based on the length of inputs (1 meaning only name or data entered. If only name is entered, error prompted saying ‘Single input is expected
to be data name’. Case 2 being both name and data supplied and data is added accordingly). It uses <a class="reference external" href="https://uk.mathworks.com/help/matlab/tables.html">table</a> data type to do that.
The dataTable is a <a class="reference external" href="https://uk.mathworks.com/help/matlab/tables.html">table</a> with 4 columns. The following are the 4 columns:</p>
<ol class="arabic simple">
<li><p>Name of the data</p></li>
<li><p>Second column is the data itself</p></li>
<li><p>Data range. The data range is a cell array with two elements, the first element is the minimum value of the data, and
the second element is the maximum value of the data. (optional)</p></li>
<li><p>Simulation range. The simulation range is a cell array with two elements, the first element is the minimum value of the
simulation, and the second element is the maximum value of the simulation. (optional)</p></li>
</ol>
<table class="colwidths-given docutils align-default" id="id13">
<caption><span class="caption-text">The methods on the left call the methods on the right in the table.</span><a class="headerlink" href="#id13" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method in Project Class</p></th>
<th class="head"><p>Method in Data Class</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>projectClass.addData()</p></td>
<td><p>dataClass.addData()</p></td>
</tr>
<tr class="row-odd"><td><p>projectClass.setData()</p></td>
<td><p>dataClass.setData()</p></td>
</tr>
</tbody>
</table>
<p>Like other classes, it has methods to setData, setDataRange or any individual column/parameter. It also checks if the data given is in the right format,
and if so, it stores it. If not, it has proper conditional statements to pinpoint the error. Like warning about duplicate names, number of inputs, type of an
input .. etc.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">Adding data. Usually, the data is in .dat files. So, <cite>dlmread</cite> built-in mehtod is used to read the data into a variable.</span><a class="headerlink" href="#id14" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">D2O_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dlmread</span><span class="p">(</span><span class="s">&#39;c_PLP0016596.dat&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c">% Add the data to the project</span><span class="w"></span>
<span class="w">    </span><span class="n">projectClass</span><span class="p">.</span><span class="n">addData</span><span class="p">(</span><span class="s">&#39;Bilayer / D2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">D2O_data</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">Setting data range. (Min and Max values)</span><a class="headerlink" href="#id15" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;dataRange&#39;</span><span class="p">,[</span><span class="mf">0.013</span><span class="w"> </span><span class="mf">0.35</span><span class="p">]);</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="custom-file-class">
<h3>Custom File Class<a class="headerlink" href="#custom-file-class" title="Permalink to this heading"></a></h3>
<p>RAT enables users to define their own custom files. They can be linked to RAT through Custom File class. Like other classes, the inputs are checked for
the right order and type. Also, it uses <a class="reference external" href="https://uk.mathworks.com/help/matlab/tables.html">table</a> data type to store the custom files. Custom files can be added or removed using the methods this class provides.</p>
<p>The custom file table has the following columns:</p>
<ol class="arabic simple">
<li><p>Name of the row in the Custom File table</p></li>
<li><p>Name of the custom file</p></li>
<li><p>Language of the custom file</p></li>
<li><p>Path of the custom file</p></li>
</ol>
<p>If all of the 4 columns are supplied, a new row (cell array of strings) is made using the supplied inputs. Then, <cite>apendNewRow</cite> method is used to append the row to the obj.
This method takes care of the error checking and incrementing the count of the custom files. It also makes a table of the row supplied. This table helps with displaying it
properly on terminal.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">Adding MATLAB custom file.</span><a class="headerlink" href="#id16" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c">%                       Row Name   Custom File Name  Language   Path</span><span class="w"></span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">addCustomFile</span><span class="p">(</span><span class="s">&#39;DSPC Model&#39;</span><span class="p">,</span><span class="s">&#39;customBilayer.m&#39;</span><span class="p">,</span><span class="s">&#39;matlab&#39;</span><span class="p">,</span><span class="s">&#39;pwd&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">Adding C++ custom file.</span><a class="headerlink" href="#id17" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="c">% For C++, function name of the cpp file is supplied</span><span class="w"></span>
<span class="w">        </span><span class="c">%                       Row Name        DLL/function Name  Language   Path</span><span class="w"></span>
<span class="w">        </span><span class="n">problem</span><span class="p">.</span><span class="n">addCustomFile</span><span class="p">(</span><span class="s">&#39;DSPC CPP Model&#39;</span><span class="p">,</span><span class="s">&#39;customBilayer&#39;</span><span class="p">,</span><span class="s">&#39;c++&#39;</span><span class="p">,</span><span class="s">&#39;pwd&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>RAT only supports C++, MATLAB, Octave and potentially Python.</p>
</div>
</section>
<section id="contrast-class">
<h3>Contrast Class<a class="headerlink" href="#contrast-class" title="Permalink to this heading"></a></h3>
<p>Contrast Class is a class to responsible to manipulate contrasts. While adding the contrast, the input(cell array) goes through some checks and if no input is given, the contrast is
automatically named and counter is incremented. If only name was given, contrast is incremented and the cell array’s name is set to current name.</p>
<p>The cell array of contrasts is sent to Contrast Class to get converted to a struct <cite>parseContrastInput</cite> method which gets attached to the class object.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">Adding a contrast (D20 Contrast)</span><a class="headerlink" href="#id18" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">addContrast</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;Bilayer / D2O&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;background&#39;</span><span class="p">,</span><span class="s">&#39;Background D2O&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;resolution&#39;</span><span class="p">,</span><span class="s">&#39;Resolution 1&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;scalefactor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Scalefactor 1&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;resample&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="k">...</span><span class="c">.</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;nbs&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD D2O&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">        % This is bulk out (&#39;Nb Subs&#39;)</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;nba&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Silicon&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">        % This is bulk in (&#39;Nb Air&#39;)</span><span class="w"></span>
<span class="w">        </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Bilayer / D2O&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>While setting contrasts to a model, <cite>setContrastModel</cite> method is called. This method is called with a cell array of a { number , cell array }. The number being what contrast
is and the cell array containing the information about the model. The main purpose of this method is to set the contrast to a model based on specified type of model. Based
on the type of model, the code checks whether some of contrast names are allowed or not. If not, it throws an error.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">Setting a contrast to a model</span><a class="headerlink" href="#id19" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c">% 1 refers to the contrast number and the rest Layer information</span><span class="w"></span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">setContrastModel</span><span class="p">(</span><span class="mi">1</span><span class="p">,{</span><span class="s">&#39;Oxide Layer&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="s">&#39;Water Layer&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="s">&#39;Bil inner head&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="s">&#39;Bil tail&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="s">&#39;Bil tail&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="s">&#39;Bil outer head&#39;</span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="resolution-class">
<h3>Resolution Class<a class="headerlink" href="#resolution-class" title="Permalink to this heading"></a></h3>
<p>Resolutions are defined in a two stage process. Firstly, acutal fitted parameters are defined. These are held in a ‘Parameter Class’ table (refering to data type).
Then,these are grouped into the resolutions themselves using a multi-type table. Then the resolution parameters can be used to either define resolution as
constant, data, or a function.</p>
<p>The constructor is called with the parameters and resolutions as input. The parameters are stored in the resolPars table whereas the resolutions are stored in
the resolutions table and the allowed types are defined in the allowedTypes variable.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>For constant only one parameter is supplied to multi-type table.</p></li>
<li><p>For data, the name is supplied, along with name of the data in the data table.</p></li>
<li><p>For function, the function name is supplied, along with up to three parameters (from the parameters table) which are then supplied to the function to calculate the resultion.</p></li>
</ol>
</div>
<p>In each case, the Resultions can either be added to or subtracted from the data.</p>
</section>
</section>
<section id="controlsdef">
<span id="id2"></span><h2>ControlsDef<a class="headerlink" href="#controlsdef" title="Permalink to this heading"></a></h2>
<p>ControlsDef Class is all about control. It is neccessary in determine the way RAT works. It deals with how the user interacts with the software. From type of parallelization
to whether the users wants to calculate SLD during fit and even how many iteration an algorithm should do ..etc.</p>
<p>There are 4 different <cite>controlsDef.procedures</cite> that can be used with RAT. They are:</p>
<ol class="arabic simple">
<li><p><strong>Simplex</strong></p></li>
<li><p><strong>Differential Evolution</strong> - Optimizes a problem by iteratively improving a candidate solution based on an evolutionary process</p></li>
<li><p><strong>Nested Sampler</strong> -  Estimates directly how the likelihood function relates to prior mass</p></li>
<li><p><strong>Bayes MCMC</strong> - used in Bayesian inference in order to generate, directly from the “not normalised part” of the posterior, samples to work with instead of dealing with intractable
computations</p></li>
</ol>
<p>Each of them has their own unique set of options. The fields in class object of constrolsDef are
automatically updated based on the procedure selected.</p>
<p>RAT uses parallelization to speed up the calculation. This is acheieved using Parallel Computing Toolbox. The user can choose to use the parallelization or not and
if yes, what to parallelize on. (Points or Contrasts or all)</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">Sample usage of controlsDef class.</span><a class="headerlink" href="#id20" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">controls</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">controlsDef</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">controls</span><span class="p">.</span><span class="n">calcSldDuringFit</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;no&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">controls</span><span class="p">.</span><span class="n">nsimu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">7000</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">controls</span><span class="p">.</span><span class="n">repeats</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">controls</span><span class="p">.</span><span class="n">parallel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;contrasts&#39;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="rat">
<h2>RAT<a class="headerlink" href="#rat" title="Permalink to this heading"></a></h2>
<p>After the user has defined the projectClass and controlsDef class, the user can run RAT like shown below</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">Sample usage of RAT class.</span><a class="headerlink" href="#id21" title="Permalink to this code"></a></div>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c">% Initialize the project class</span><span class="w"></span>
<span class="w">    </span><span class="n">problem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">projectClass</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c">% Initialize the controls class</span><span class="w"></span>
<span class="w">    </span><span class="n">controls</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">controlsDef</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c">% call the RAT function</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">problem</span><span class="p">,</span><span class="n">results</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">RAT</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="n">controls</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>When the RAT function is called, the classes are passed into internal functions like <cite>RatParseClassToStructs_new</cite> which takes the classes and breaks them down into cells,
limits,prior and more importantly converts the project class to struct.</p>
<p>Then, then <cite>RAT_main</cite> function redirects the control flow based on what procedure is selected in controlsDef class. One of the redirecting functions will call the reflectivity_calculation_wrappper
which starts the reflectivity calculation.</p>
<p>Some interesting data type changes are needed because of how things work with coder. Coder wont accept variable sized cell arrays contains variable sized arrays (strings for eg)
in a field of a struct. So, look at <cite>RatParseClassToStructs_new</cite> function to understand how the data is converted.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sourceCodeLayout.html" class="btn btn-neutral float-left" title="Source Code Layout" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="targetFunctions.html" class="btn btn-neutral float-right" title="Target Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Arwel Hughes,Sethu Pastula.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
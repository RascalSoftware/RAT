<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of RatParseClassToStructs</title>
  <meta name="keywords" content="RatParseClassToStructs">
  <meta name="description" content="Breaks up the classes into the relevant structures for inputting into C">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html API -->

<h1>RatParseClassToStructs
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Breaks up the classes into the relevant structures for inputting into C</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [problemDef,problemDef_cells,problemDef_limits,controls] = RatParseClassToStructs(inputProblemDef,inputControls) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Breaks up the classes into the relevant structures for inputting into C
</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [problemDef,problemDef_cells,problemDef_limits,controls] = RatParseClassToStructs(inputProblemDef,inputControls)</a>
0002 
0003 <span class="comment">% Breaks up the classes into the relevant structures for inputting into C</span>
0004 
0005 <span class="comment">% Put the extracted fields into a cell array...</span>
0006 <span class="comment">% Structure of problemDef_cells array.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% {1} - inputProblemDef.contrastRepeatSLDs</span>
0009 <span class="comment">%       {1 x nContrasts} array of cells</span>
0010 <span class="comment">%       Each cell is {1 x 2 double}.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% {2} - inputProblemDef.allData</span>
0013 <span class="comment">%       {1 x nContrasts} array of cells</span>
0014 <span class="comment">%       Each cell is {Inf x 3 double}</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% {3} - inputProblemDef.dataLimits</span>
0017 <span class="comment">%       {1 x nContrasts} array of cells</span>
0018 <span class="comment">%       Each cell is {1 x 2 double}</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% {4} - inputProblemDef.simLimits</span>
0021 <span class="comment">%       {1 x nContrasts} array of cells</span>
0022 <span class="comment">%       Each cell is {1 x 2 double}</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% {5} - inputProblemDef.contrastLayers</span>
0025 <span class="comment">%       {1 x nContrasts} array of cells</span>
0026 <span class="comment">%       Each cell is {1 x Inf double}</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% {6} - inputProblemDef.layersDetails</span>
0029 <span class="comment">%       {n x 1} array of cells</span>
0030 <span class="comment">%       Each cell is (1 x 5 double}</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% {7} - inputProblemDef.paramNames</span>
0033 <span class="comment">%       {1 x nParams} array of cells</span>
0034 <span class="comment">%       Each cell is {1 x Inf char}</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% {8} - inputProblemDef.backgroundsNames</span>
0037 <span class="comment">%       {1 x nBackgrounds} array of cells</span>
0038 <span class="comment">%       Each cell is {1 x Inf char}</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% {9} - inputProblemDef.scalefactorNames</span>
0041 <span class="comment">%       {1 x nScales} array of cells</span>
0042 <span class="comment">%       Each cell is {1 x Inf char}</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% {10}- inputProblemDef.qzshiftNames</span>
0045 <span class="comment">%       {1 x nShifts} array of cells</span>
0046 <span class="comment">%       Each cell is {1 x Inf char}</span>
0047 <span class="comment">%</span>
0048 <span class="comment">% {11}- inputProblemDef.nbairNames</span>
0049 <span class="comment">%       {1 x nNba} array of cells</span>
0050 <span class="comment">%       Each cell is {1 x Inf char}</span>
0051 <span class="comment">%</span>
0052 <span class="comment">% {12}- inputProblemDef.nbsrNames</span>
0053 <span class="comment">%       {1 x nNba} array of cells</span>
0054 <span class="comment">%       Each cell is {1 x Inf char}</span>
0055 <span class="comment">%</span>
0056 <span class="comment">% {13}- inputProblemDef.resolNames</span>
0057 <span class="comment">%       {1 x nNba} array of cells</span>
0058 <span class="comment">%       Each cell is {1 x Inf char}</span>
0059  
0060 
0061 <span class="comment">%Start by removing the cell arrays</span>
0062 repeatLayers = inputProblemDef.contrastRepeatSLDs;
0063 allData = inputProblemDef.allData;
0064 dataLimits = inputProblemDef.dataLimits;
0065 simLimits = inputProblemDef.simLimits;
0066 contrastLayers = inputProblemDef.contrastLayers;
0067 layersDetails = inputProblemDef.layersDetails;
0068 paramNames = inputProblemDef.paramNames;
0069 backsNames = inputProblemDef.backgroundNames;
0070 sfNames = inputProblemDef.scalefactorNames;
0071 shiftsNames = inputProblemDef.qzshiftNames;
0072 nbaNames = inputProblemDef.nbairNames;
0073 nbsNames = inputProblemDef.nbsubNames;
0074 resolNames = inputProblemDef.resolutionNames;
0075 
0076 <span class="comment">% Pull out all the cell arrays into one array</span>
0077 problemDef_cells{1} = repeatLayers;
0078 problemDef_cells{2} = allData;
0079 problemDef_cells{3} = dataLimits;
0080 problemDef_cells{4} = simLimits;
0081 problemDef_cells{5} = contrastLayers;
0082 
0083 <span class="comment">% Fix for cell array bug with custom layers</span>
0084 <span class="keyword">if</span> strcmpi(inputProblemDef.modelType,<span class="string">'custom layers'</span>) || strcmpi(inputProblemDef.modelType,<span class="string">'Custom XY'</span>)
0085     <span class="keyword">for</span> i = 1:length(problemDef_cells{5})
0086         problemDef_cells{5}{i} = 0;
0087     <span class="keyword">end</span>
0088 <span class="keyword">end</span>
0089 
0090 problemDef_cells{6} = layersDetails;
0091 problemDef_cells{7} = paramNames;
0092 problemDef_cells{8} = backsNames;
0093 problemDef_cells{9} = sfNames;
0094 problemDef_cells{10} = shiftsNames;
0095 problemDef_cells{11} = nbaNames;
0096 problemDef_cells{12} = nbsNames;
0097 problemDef_cells{13} = resolNames;
0098 
0099 <span class="comment">%Split up the contrastBacks array</span>
0100 contrastBacks = inputProblemDef.contrastBacks;
0101 <span class="keyword">for</span> i = 1:length(contrastBacks)
0102     problemDef.contrastBacks(i) = contrastBacks{i}(1);
0103     problemDef.contrastBacksType(i) = contrastBacks{i}(2);
0104 <span class="keyword">end</span>
0105     
0106 <span class="comment">%Now make the limits array</span>
0107 <span class="keyword">for</span> i = 1:length(inputProblemDef.paramConstr)
0108     problemDef_limits.params(i,:) = inputProblemDef.paramConstr{i};
0109 <span class="keyword">end</span>
0110 
0111 <span class="keyword">for</span> i = 1:length(inputProblemDef.backgroundConstr)
0112     problemDef_limits.backs(i,:) = inputProblemDef.backgroundConstr{i};
0113 <span class="keyword">end</span>
0114 
0115 <span class="keyword">for</span> i = 1:length(inputProblemDef.scalefactorConstr)
0116     problemDef_limits.scales(i,:) = inputProblemDef.scalefactorConstr{i};
0117 <span class="keyword">end</span>
0118 
0119 <span class="keyword">for</span> i = 1:length(inputProblemDef.qzshiftConstr)
0120     problemDef_limits.shifts(i,:) = inputProblemDef.qzshiftConstr{i};
0121 <span class="keyword">end</span>
0122 
0123 <span class="keyword">for</span> i = 1:length(inputProblemDef.nbairConstr)
0124     problemDef_limits.nba(i,:) = inputProblemDef.nbairConstr{i};
0125 <span class="keyword">end</span>
0126 
0127 <span class="keyword">for</span> i = 1:length(inputProblemDef.nbsubConstr)
0128     problemDef_limits.nbs(i,:) = inputProblemDef.nbsubConstr{i};
0129 <span class="keyword">end</span>
0130 
0131 <span class="keyword">for</span> i = 1:length(inputProblemDef.resolutionConstr)
0132     problemDef_limits.res(i,:) = inputProblemDef.resolutionConstr{i};
0133 <span class="keyword">end</span>
0134 
0135 <span class="comment">%Now remove all these fields from inputProblemDef</span>
0136 removedFields = {<span class="string">'contrastRepeatSLDs'</span>,<span class="keyword">...</span>
0137     <span class="string">'allData'</span>,<span class="keyword">...</span>
0138     <span class="string">'dataLimits'</span>,<span class="keyword">...</span>
0139     <span class="string">'simLimits'</span>,<span class="keyword">...</span>
0140     <span class="string">'contrastLayers'</span>,<span class="keyword">...</span>
0141     <span class="string">'layersDetails'</span>,<span class="keyword">...</span>
0142     <span class="string">'paramNames'</span>,<span class="keyword">...</span>
0143     <span class="string">'backgroundNames'</span>,<span class="keyword">...</span>
0144     <span class="string">'scalefactorNames'</span>,<span class="keyword">...</span>
0145     <span class="string">'qzshiftNames'</span>,<span class="keyword">...</span>
0146     <span class="string">'nbairNames'</span>,<span class="keyword">...</span>
0147     <span class="string">'nbsubsNames'</span>,<span class="keyword">...</span>
0148     <span class="string">'resolutionNames'</span>,<span class="keyword">...</span>
0149     <span class="string">'paramConstr'</span>,<span class="keyword">...</span>
0150     <span class="string">'backgroundConstr'</span>,<span class="keyword">...</span>
0151     <span class="string">'scalefactorConstr'</span>,<span class="keyword">...</span>
0152     <span class="string">'nbairConstr'</span>,<span class="keyword">...</span>
0153     <span class="string">'nbsubConstr'</span>,<span class="keyword">...</span>
0154     <span class="string">'resolutionConstr'</span>};
0155 
0156 <span class="comment">%Make the problemDef structure from the bits left.....</span>
0157 problemDef.TF = <span class="string">'standardTF'</span>; <span class="comment">%for now....</span>
0158 problemDef.resample = inputProblemDef.resample;
0159 problemDef.dataPresent = inputProblemDef.dataPresent;
0160 problemDef.numberOfContrasts = inputProblemDef.numberOfContrasts;
0161 problemDef.geometry = inputProblemDef.experimentGeometry;
0162 <span class="comment">%problemDef.contrastBacks = contrastBacks;</span>
0163 problemDef.contrastShifts = inputProblemDef.contrastShifts;
0164 problemDef.contrastScales = inputProblemDef.contrastScales;
0165 problemDef.contrastNbas = inputProblemDef.contrastNbas;
0166 problemDef.contrastNbss = inputProblemDef.contrastNbss;
0167 problemDef.contrastRes = inputProblemDef.contrastRes;
0168 problemDef.backs = inputProblemDef.backgrounds;
0169 problemDef.shifts = inputProblemDef.qzshifts;
0170 problemDef.sf = inputProblemDef.scalefactors;
0171 problemDef.nba = inputProblemDef.nbairs;
0172 problemDef.nbs = inputProblemDef.nbsubs;
0173 problemDef.res = inputProblemDef.resolutions;
0174 problemDef.params = inputProblemDef.params;
0175 problemDef.numberOfLayers = inputProblemDef.numberOfLayers;
0176 problemDef.modelType = inputProblemDef.modelType;
0177 <span class="keyword">if</span> ~isempty(inputProblemDef.modelFilename)
0178     [path,fname,extension] = fileparts(inputProblemDef.modelFilename);
0179 <span class="keyword">else</span>
0180     fname = <span class="string">'0'</span>;
0181 <span class="keyword">end</span>
0182 problemDef.modelFilename = fname;
0183 problemDef.path = pwd;
0184 problemDef.modelLanguage = inputProblemDef.modelLanguage;
0185 <span class="keyword">if</span> isempty(inputProblemDef.modelLanguage)
0186     problemDef.modelLanguage = <span class="string">'matlab'</span>;
0187 <span class="keyword">end</span>
0188     
0189 problemDef.fitpars = [];
0190 problemDef.otherpars = [];
0191 problemDef.fitconstr = [];
0192 problemDef.otherconstr = [];
0193 
0194 <span class="comment">%Now deal with the controls class</span>
0195 controls.para = inputControls.parallel;
0196 controls.proc = inputControls.procedure;
0197 controls.display = inputControls.display;
0198 controls.tolX = inputControls.tolX;
0199 controls.tolFun = inputControls.tolFun;
0200 controls.maxFunEvals = inputControls.maxFunEvals;
0201 controls.maxIter = inputControls.maxIter;
0202 controls.populationSize = inputControls.populationSize;
0203 controls.F_weight = inputControls.F_weight;
0204 controls.F_CR = inputControls.crossoverProbability;
0205 controls.VTR = inputControls.targetValue;
0206 controls.numGen = inputControls.numGenerations;
0207 controls.strategy = inputControls.strategy;
0208 controls.Nlive = inputControls.Nlive;
0209 controls.nmcmc = inputControls.Nmcmc;
0210 controls.propScale = inputControls.propScale;
0211 controls.nsTolerance = inputControls.nsTolerance;
0212 <span class="keyword">switch</span> inputControls.calcSldDuringFit
0213     <span class="keyword">case</span> <span class="string">'no'</span>
0214         controls.calcSld = 0;
0215     <span class="keyword">otherwise</span>
0216         controls.calcSld = 1;
0217 <span class="keyword">end</span>
0218 
0219 <span class="comment">%Also need to deal with the checks...</span>
0220 
0221 checks.params_fitYesNo = inputProblemDef.paramFitYesNo;
0222 checks.backs_fitYesNo = inputProblemDef.backgroundFitYesNo;
0223 checks.shifts_fitYesNo = inputProblemDef.qzshiftFitYesNo;
0224 checks.scales_fitYesNo = inputProblemDef.scalefactorFitYesNo;
0225 checks.nbairs_fitYesNo = inputProblemDef.nbairFitYesNo;
0226 checks.nbsubs_fitYesNo = inputProblemDef.nbsubFitYesNo;
0227 checks.resol_fitYesNo = inputProblemDef.resolutionFitYesNo;
0228 
0229 controls.checks = checks;
0230 
0231 
0232 
0233 
0234 
0235 
0236 
0237 
0238 
0239 
0240 
0241 
0242 <span class="comment">%********* Old API problem structure******</span>
0243 <span class="comment">%              resample: [7×1 double]</span>
0244 <span class="comment">%     numberOfContrasts: 7</span>
0245 <span class="comment">%              geometry: 'Air / Liquid (or solid)'</span>
0246 <span class="comment">%                nbairs: [0 0 0 0 0 0 0]</span>
0247 <span class="comment">%                nbsubs: [0 6.3500e-06 0 6.3500e-06 0 6.3500e-06 6.3500e-06]</span>
0248 <span class="comment">%         contrastBacks: [2 1 2 1 2 1 1]</span>
0249 <span class="comment">%        contrastShifts: [1 1 1 1 1 1 1]</span>
0250 <span class="comment">%        contrastScales: [1 1 1 1 1 1 1]</span>
0251 <span class="comment">%          contrastNbas: [1 1 1 1 1 1 1]</span>
0252 <span class="comment">%          contrastNbss: [2 1 2 1 2 1 1]</span>
0253 <span class="comment">%           contrastRes: [1 1 1 1 1 1 1]</span>
0254 <span class="comment">%                 backs: [2.9718e-06 5.1473e-06]</span>
0255 <span class="comment">%                shifts: 0</span>
0256 <span class="comment">%                    sf: 0.2325</span>
0257 <span class="comment">%                   nba: 0</span>
0258 <span class="comment">%                   nbs: [6.3500e-06 0]</span>
0259 <span class="comment">%                   res: 0.0300</span>
0260 <span class="comment">%           dataPresent: [1 1 1 1 1 1 1]</span>
0261 <span class="comment">%               nParams: 10</span>
0262 <span class="comment">%                params: [6.9950 18.6911 6.9473e-06 3.0000 -2.2818e-07 7.0421 5.8839e-06 3.0000 1.8126e-06 10.0536]</span>
0263 <span class="comment">%        numberOfLayers: 4</span>
0264 <span class="comment">%             whichType: 1</span>
0265 <span class="comment">%            fileHandle: []</span>
0266 <span class="comment">%                  lang: []</span>
0267 <span class="comment">%                module: []</span>
0268 <span class="comment">%               fitpars: [18×1 double]</span>
0269 <span class="comment">%             otherpars: [0×1 double]</span>
0270 <span class="comment">%             fitconstr: [18×2 double]</span>
0271 <span class="comment">%           otherconstr: [0×2 double]</span>
0272 <span class="comment">%             fitConstr: [18×2 double]</span>
0273 
0274 
0275 <span class="comment">%old API limits structure....</span>
0276 <span class="comment">% problemDef_limits =</span>
0277 <span class="comment">%</span>
0278 <span class="comment">%   struct with fields:</span>
0279 <span class="comment">%</span>
0280 <span class="comment">%     params: [10×2 double]</span>
0281 <span class="comment">%      backs: [2×2 double]</span>
0282 <span class="comment">%     scales: [0.1000 0.4000]</span>
0283 <span class="comment">%     shifts: [-0.0300 0.0300]</span>
0284 <span class="comment">%        nba: [-1.0000e-05 1.0000e-05]</span>
0285 <span class="comment">%        nbs: [2×2 double]</span>
0286 <span class="comment">%        res: [0.0100 0.0500]</span>
0287 
0288 
0289 
0290 
0291 
0292 
0293 
0294 
0295 
0296 
0297 <span class="comment">%new API style problem struct....</span>
0298 
0299 
0300 
0301 
0302 
0303 
0304 
0305 
0306 
0307 <span class="keyword">end</span>
</pre></div>

<hr><address>Generated on Tue 31-Jan-2023 15:40:27 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>

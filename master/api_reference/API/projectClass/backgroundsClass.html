<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of backgroundsClass</title>
  <meta name="keywords" content="backgroundsClass">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html API -->
<!-- menu.html projectClass -->

<h1>backgroundsClass
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="backgroundsClass.html" class="code" title="">backgroundsClass</a>	</li>
<li><a href="multiTypeTable.html" class="code" title="">multiTypeTable</a>	</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="backgroundsClass.html" class="code" title="">backgroundsClass</a>	</li>
<li><a href="projectClass.html" class="code" title="">projectClass</a>	</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function  obj = backgroundsClass(parameters, startBackground)</a></li>
<li><a href="#_sub2" class="code">function flag = get.showPriors(obj)</a></li>
<li><a href="#_sub3" class="code">function set.showPriors(obj, value)</a></li>
<li><a href="#_sub4" class="code">function names = getBackgroundNames(obj)</a></li>
<li><a href="#_sub5" class="code">function obj = addBackground(obj,varargin)</a></li>
<li><a href="#_sub6" class="code">function obj = removeBackground(obj, row)</a></li>
<li><a href="#_sub7" class="code">function obj = setBackground(obj, row, varargin)</a></li>
<li><a href="#_sub8" class="code">function obj = setBackgroundName(obj, index, name)</a></li>
<li><a href="#_sub9" class="code">function displayBackgroundsObject(obj)</a></li>
<li><a href="#_sub10" class="code">function backStruct = toStruct(obj)</a></li>
<li><a href="#_sub11" class="code">function thisPar = validateParam(obj, par)</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="backgroundsClass.html" class="code" title="">backgroundsClass</a> &lt; handle
0002     <span class="comment">% Backgrounds are defined in a two stage process. Firstly we define the</span>
0003     <span class="comment">% actual fitted parameters. These are held in a 'ParametersClass'</span>
0004     <span class="comment">% table. Then, we group these into the backgrounds themselves using a</span>
0005     <span class="comment">% multiTypeTable. So, we can then use the background parameters to</span>
0006     <span class="comment">% either define background as  constant, data or a function.</span>
0007     <span class="comment">%</span>
0008     <span class="comment">% For constant only one parameter is supplied to multi type table.</span>
0009     <span class="comment">%</span>
0010     <span class="comment">% For data only the itself is supplied as a cell.</span>
0011     <span class="comment">%</span>
0012     <span class="comment">% For function, the function name is supplied, along with up to three</span>
0013     <span class="comment">% parameters (from the parameters table) which are then supplied to the</span>
0014     <span class="comment">% function to calculate the background.</span>
0015     <span class="comment">%</span>
0016     <span class="comment">% In each case, the background can either be added to the simulation or</span>
0017     <span class="comment">% subtracted from the data.</span>
0018     
0019     properties
0020        backPars 
0021        backgrounds
0022     <span class="keyword">end</span>
0023 
0024     properties(Dependent)
0025        showPriors
0026     <span class="keyword">end</span>
0027 
0028     properties(Access = private, Constant, Hidden)
0029        invalidTypeMessage = &quot;Unrecognised type <span class="string">'%s'</span>. Must be one of the types defined in <span class="string">'obj.allowedTypes'</span>&quot;
0030     <span class="keyword">end</span>
0031     
0032     properties (Access = private)
0033        allowedTypes = {<span class="string">'constant'</span>, <span class="string">'data'</span>, <span class="string">'function'</span>}
0034     <span class="keyword">end</span>
0035     
0036     methods
0037         <a name="_sub0" href="#_subfunctions" class="code">function  obj = backgroundsClass(parameters, startBackground)</a>
0038             <span class="comment">% Creates a background object. The arguments should be</span>
0039             <span class="comment">% an instance of the parameter class with the background parameters</span>
0040             <span class="comment">% and a cell array of  backgrounds</span>
0041             <span class="comment">%</span>
0042             <span class="comment">% params = parametersClass({'Backs par 1', 1e-7, 1e-6, 1e-5, false, 'uniform', 0, Inf});</span>
0043             <span class="comment">% background = backgroundClass(params, {'Background 1', 'constant', 'Backs Par 1'});</span>
0044             obj.backPars = parameters;
0045             
0046             <span class="comment">% Make a multiType table to define the actual backgrounds</span>
0047             obj.backgrounds = <a href="multiTypeTable.html" class="code" title="">multiTypeTable</a>();
0048             obj.backgrounds.allowedTypes = obj.allowedTypes;
0049             obj.backgrounds.typesAutoNameString = <span class="string">'New background'</span>;
0050             obj.addBackground(startBackground{:});
0051         <span class="keyword">end</span>
0052 
0053         <a name="_sub1" href="#_subfunctions" class="code">function flag = get.showPriors(obj)</a>
0054             flag = obj.backPars.showPriors;
0055         <span class="keyword">end</span>
0056         
0057         <a name="_sub2" href="#_subfunctions" class="code">function set.showPriors(obj, value)</a>
0058             obj.backPars.showPriors = value;
0059         <span class="keyword">end</span>
0060         
0061         <a name="_sub3" href="#_subfunctions" class="code">function names = getBackgroundNames(obj)</a>
0062             <span class="comment">% Returns a N x 1 cell array of names of the backgrounds</span>
0063             <span class="comment">% in the object.</span>
0064             <span class="comment">%</span>
0065             <span class="comment">% names = background.getBackgroundNames();</span>
0066             backsTable = obj.backgrounds.typesTable;
0067             names = backsTable{:,1};      
0068         <span class="keyword">end</span>
0069                  
0070         <a name="_sub4" href="#_subfunctions" class="code">function obj = addBackground(obj,varargin)</a>
0071             <span class="comment">% Adds a new entry to the background table.</span>
0072             <span class="comment">%</span>
0073             <span class="comment">% background.addBackground('New Row');</span>
0074             <span class="comment">% background.addBackground('New Row', 'constant', 'param_name');</span>
0075             <span class="comment">% background.addBackground('New Row', 'function', 'function_name', 'param_name');</span>
0076             <span class="comment">% background.addBackground('New Row', 'data');</span>
0077             in = varargin;
0078 
0079             <span class="keyword">if</span> isempty(in)
0080                 thisRow = {};
0081             <span class="keyword">else</span>
0082                 thisRow = {<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>};
0083                 <span class="keyword">if</span> length(in) == 1
0084                     <span class="comment">% Assume the input is just a name</span>
0085                     thisRow = {in};
0086                 <span class="keyword">else</span>
0087                     thisRow{1} = in;
0088                 <span class="keyword">end</span>
0089             <span class="keyword">end</span>
0090  
0091             <span class="keyword">if</span> length(in) &gt; 1
0092                <span class="comment">% Check that second param is legal</span>
0093                typeVal = in{2};
0094                <span class="keyword">if</span> ~strcmpi(typeVal,obj.allowedTypes)
0095                     throw(invalidOption(sprintf(obj.invalidTypeMessage, typeVal)));
0096                <span class="keyword">end</span>
0097 
0098                thisRow{1} = in{1};
0099                thisRow{2} = in{2};
0100 
0101                <span class="comment">% Check that the other params inputted are either valid</span>
0102                <span class="comment">% background names, or numbers in range..</span>
0103                <span class="keyword">switch</span> typeVal
0104                    <span class="keyword">case</span> <span class="string">'constant'</span>
0105                        <span class="comment">% Param 3 must be a valid parameter</span>
0106                        thisParam = obj.validateParam(in(3));
0107                        thisRow{3} = thisParam;
0108 
0109                    <span class="keyword">case</span> <span class="string">'function'</span>
0110                        <span class="comment">% Param 3 is assumed to be function name</span>
0111                        <span class="comment">% any other given parameters must be in paramNames</span>
0112                        <span class="comment">% list or numbers in range</span>
0113                        thisRow{3} = in{3};
0114                        <span class="keyword">for</span> i = 4:length(in)
0115                           thisParam = obj.validateParam(in(i));
0116                           thisRow{i} = thisParam;
0117                        <span class="keyword">end</span>
0118                    <span class="keyword">case</span> <span class="string">'data'</span>
0119                        <span class="comment">% Background is assumed to be given by a 4th column</span>
0120                        <span class="comment">% of a data file. We don't have access to the</span>
0121                        <span class="comment">% data files at this point so this (i.e. that data is</span>
0122                        <span class="comment">% [n x 4] ) will be checked downstream</span>
0123                        thisRow = {in(1), in(2), <span class="string">''</span>, <span class="string">''</span>, <span class="string">''</span>, <span class="string">''</span>, <span class="string">''</span>};
0124                 <span class="keyword">end</span>
0125             <span class="keyword">end</span>
0126             obj.backgrounds.addRow(thisRow);   
0127         <span class="keyword">end</span>
0128         
0129         <a name="_sub5" href="#_subfunctions" class="code">function obj = removeBackground(obj, row)</a>
0130             <span class="comment">% Removes a background entry from the table. Expects the</span>
0131             <span class="comment">% index or array of indices of background(s) to remove.</span>
0132             <span class="comment">%</span>
0133             <span class="comment">% background.removeBackground(2);</span>
0134             <span class="comment">% background.removeBackground([1, 3]);</span>
0135             obj.backgrounds.removeRow({row});
0136         <span class="keyword">end</span>
0137         
0138         <a name="_sub6" href="#_subfunctions" class="code">function obj = setBackground(obj, row, varargin)</a>
0139             <span class="comment">% Changes the value of a given background in the table. Expects the</span>
0140             <span class="comment">% index or name of background and keyword/value pairs to set.</span>
0141             <span class="comment">%</span>
0142             <span class="comment">% background.setBackground(1, 'name', 'back 1', 'type', 'constant', 'value1', 'param_name');</span>
0143             <span class="keyword">if</span> ischar(row)
0144                 row = obj.backgrounds.findRowIndex(row, obj.getBackgroundNames());
0145             <span class="keyword">elseif</span> isnumeric(row)
0146                 count = obj.backgrounds.typesCount;
0147                 <span class="keyword">if</span> (row &lt; 1) || (row &gt; count)
0148                     throw(indexOutOfRange(sprintf(<span class="string">'The row index %d is not within the range 1 - %d'</span>, row, count)));
0149                 <span class="keyword">end</span>
0150             <span class="keyword">else</span>
0151                 throw(invalidType(<span class="string">'Unrecognised row'</span>));
0152             <span class="keyword">end</span>
0153             
0154             p = inputParser;
0155             addParameter(p, <span class="string">'name'</span>, obj.backgrounds.typesTable{row, 1}, @(x) isstring(x) || ischar(x));
0156             addParameter(p, <span class="string">'type'</span>, obj.backgrounds.typesTable{row, 2}, @(x) isstring(x) || ischar(x));
0157             addParameter(p, <span class="string">'value1'</span>, obj.backgrounds.typesTable{row, 3}, @(x) isstring(x) || ischar(x));
0158             addParameter(p, <span class="string">'value2'</span>, obj.backgrounds.typesTable{row, 4}, @(x) isstring(x) || ischar(x));
0159             addParameter(p, <span class="string">'value3'</span>, obj.backgrounds.typesTable{row, 5}, @(x) isstring(x) || ischar(x));
0160             addParameter(p, <span class="string">'value4'</span>, obj.backgrounds.typesTable{row, 6}, @(x) isstring(x) || ischar(x));
0161 
0162             parse(p, varargin{:});
0163             inputBlock = p.Results;
0164 
0165             obj.backgrounds.setValue({row, 1, inputBlock.name});
0166             
0167             <span class="keyword">if</span> ~strcmpi(inputBlock.type, obj.allowedTypes)
0168                throw(invalidOption(sprintf(obj.invalidTypeMessage, inputBlock.type)));
0169             <span class="keyword">end</span>
0170             obj.backgrounds.setValue({row, 2, inputBlock.type});      
0171             
0172             values = {inputBlock.value1, inputBlock.value2, inputBlock.value3, inputBlock.value4};
0173             <span class="keyword">for</span> i = 1:4
0174                 value = convertStringsToChars(values{i});
0175                 <span class="comment">% for function type, value 1 is the function name so no validation is done</span>
0176                 <span class="keyword">if</span> ~isempty(value) &amp;&amp; ~(i==1 &amp;&amp; strcmpi(inputBlock.type,<span class="string">'function'</span>))
0177                     value = obj.validateParam(value);
0178                 <span class="keyword">end</span>
0179                 obj.backgrounds.setValue({row, i + 2, value});
0180             <span class="keyword">end</span>
0181         <span class="keyword">end</span>
0182          
0183         <a name="_sub7" href="#_subfunctions" class="code">function obj = setBackgroundName(obj, index, name)</a>
0184             <span class="comment">% Sets the name of a given background in the table. Expects</span>
0185             <span class="comment">% an index and the new name.</span>
0186             <span class="comment">%</span>
0187             <span class="comment">% background.setBackgroundName(1, 'new_name');</span>
0188             <span class="keyword">if</span> ~ischar(name)
0189                 throw(invalidType(sprintf(<span class="string">'%s must be a character array'</span>, name)));
0190             <span class="keyword">end</span>
0191             obj.backgrounds.setValue({index, <span class="string">'name'</span>, name});
0192         <span class="keyword">end</span>
0193 
0194         <a name="_sub8" href="#_subfunctions" class="code">function displayBackgroundsObject(obj)</a>
0195             <span class="comment">% Displays the background parameters and background table.</span>
0196             fprintf(<span class="string">'    Backgrounds: ----------------------------------------------------------------------------------------------- \n\n'</span>);
0197             fprintf(<span class="string">'    (a) Background Parameters: \n'</span>);
0198             obj.backPars.displayParametersTable;
0199             
0200             fprintf(<span class="string">'    (b) Backgrounds:  \n'</span>)
0201             obj.backgrounds.displayTypesTable;
0202             <span class="comment">%fprintf('\n    ----------------------------------------------------------------------------------- \n\n');</span>
0203         <span class="keyword">end</span>
0204         
0205         <a name="_sub9" href="#_subfunctions" class="code">function backStruct = toStruct(obj)</a>
0206             <span class="comment">% Converts the class parameters into a structure array</span>
0207             backParamsStruct = obj.backPars.toStruct();
0208             
0209             backStruct.backParNames = backParamsStruct.paramNames;
0210             backStruct.backParConstr = backParamsStruct.paramConstr;
0211             backStruct.backParVals = backParamsStruct.params;
0212             backStruct.backParFitYesNo = backParamsStruct.fitYesNo;
0213             backStruct.nBackPars = backParamsStruct.nParams;
0214             backStruct.backsPriors = backParamsStruct.priors;
0215             
0216             backgroundNames = obj.backgrounds.typesTable{:,1};
0217             backgroundTypes = obj.backgrounds.typesTable{:,2};
0218             backgroundValues = table2cell(obj.backgrounds.typesTable(:,3:7));
0219             
0220             backStruct.backgroundNames = backgroundNames;
0221             backStruct.backgroundTypes = backgroundTypes;
0222             backStruct.backgroundValues = backgroundValues;
0223         <span class="keyword">end</span>
0224     <span class="keyword">end</span>
0225 
0226     methods (Access = protected)
0227         <a name="_sub10" href="#_subfunctions" class="code">function thisPar = validateParam(obj, par)</a>
0228             <span class="comment">% Checks that given parameter index or name is valid, then returns the</span>
0229             <span class="comment">% parameter name.</span>
0230             <span class="comment">%</span>
0231             <span class="comment">% param = obj.validateParam('param_name');</span>
0232             <span class="keyword">if</span> iscell(par)
0233                 par = par{:};
0234             <span class="keyword">end</span>
0235             parList = obj.backPars.getParamNames();
0236             <span class="keyword">if</span> isnumeric(par)
0237                 <span class="keyword">if</span> (par &lt; 1) || (par &gt; length(parList))
0238                     throw(indexOutOfRange(sprintf(<span class="string">'Background Parameter %d is out of range'</span>, par)));
0239                 <span class="keyword">else</span>
0240                     thisPar = parList(par);
0241                 <span class="keyword">end</span>
0242             <span class="keyword">elseif</span> ischar(par)
0243                 <span class="keyword">if</span> ~strcmpi(par,parList)
0244                     throw(nameNotRecognised(sprintf(<span class="string">'Unrecognised parameter name %s'</span>, par)));
0245                 <span class="keyword">else</span>
0246                     thisPar = par;
0247                 <span class="keyword">end</span>
0248             <span class="keyword">end</span>
0249         <span class="keyword">end</span>
0250     <span class="keyword">end</span>
0251 <span class="keyword">end</span>
</pre></div>

<hr><address>Generated on Fri 10-Mar-2023 11:17:15 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of customFileClass</title>
  <meta name="keywords" content="customFileClass">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html API -->
<!-- menu.html projectClass -->

<h1>customFileClass
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="customFileClass.html" class="code" title="">customFileClass</a>	</li>
<li><a href="tableUtilities.html" class="code" title="">tableUtilities</a>	</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="customFileClass.html" class="code" title="">customFileClass</a>	</li>
<li><a href="projectClass.html" class="code" title="">projectClass</a>	</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = customFileClass(varargin)</a></li>
<li><a href="#_sub2" class="code">function delete(obj)</a></li>
<li><a href="#_sub3" class="code">function obj = addCustomFile(obj, varargin)</a></li>
<li><a href="#_sub4" class="code">function obj = setCustomFile(obj, row, varargin)</a></li>
<li><a href="#_sub5" class="code">function displayTable(obj)</a></li>
<li><a href="#_sub6" class="code">function fileStruct = toStruct(obj)</a></li>
<li><a href="#_sub7" class="code">function obj = setCustomLanguage(obj, row, language)</a></li>
<li><a href="#_sub8" class="code">function obj = setCustomName(obj, whichCustom, name)</a></li>
<li><a href="#_sub9" class="code">function obj = setFileName(obj,whichCustom,name)</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="customFileClass.html" class="code" title="">customFileClass</a> &lt; <a href="tableUtilities.html" class="code" title="">tableUtilities</a>
0002     
0003     <span class="comment">% A container class for holding custom files for either</span>
0004     <span class="comment">% models, backgrounds or resolutions.</span>
0005    properties (SetAccess = private, Hidden = true)
0006         wrappers = {}
0007    <span class="keyword">end</span>
0008 
0009     properties(Access = private, Constant, Hidden)
0010         invalidLanguageMessage = sprintf(<span class="string">'Language must be a supportedLanguages enum or one of the following strings (%s)'</span>, <span class="keyword">...</span>
0011                                          strjoin(supportedLanguages.values(), <span class="string">', '</span>))    
0012     <span class="keyword">end</span>
0013     
0014     methods
0015         
0016         <a name="_sub0" href="#_subfunctions" class="code">function obj = customFileClass(varargin)</a>
0017             <span class="comment">% Construct a custom file class containing either an empty</span>
0018             <span class="comment">% table or one with a single row.</span>
0019             <span class="comment">% No input is required for an empty table, otherwise the</span>
0020             <span class="comment">% parameters for the first row should be provided.</span>
0021             <span class="comment">%</span>
0022             <span class="comment">% customFiles = customFileClass()</span>
0023             sz = [0 4];
0024             varTypes = {<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>};
0025             varNames = {<span class="string">'Name'</span>,<span class="string">'Filename'</span>,<span class="string">'Language'</span>,<span class="string">'Path'</span>};
0026             obj.varTable = table(<span class="string">'Size'</span>,sz,<span class="string">'VariableTypes'</span>,varTypes,<span class="string">'VariableNames'</span>,varNames);
0027 
0028             <span class="keyword">if</span> ~isempty(varargin)
0029                 obj.addCustomFile(varargin{:});
0030             <span class="keyword">end</span>          
0031         <span class="keyword">end</span>
0032 
0033         <a name="_sub1" href="#_subfunctions" class="code">function delete(obj)</a>
0034             <span class="comment">% Destroys the wrappers</span>
0035             <span class="keyword">for</span> i=1:length(obj.wrappers) 
0036                 <a href="#_sub2" class="code" title="subfunction delete(obj)">delete</a>(obj.wrappers{i});
0037             <span class="keyword">end</span>
0038             obj.wrappers = {};
0039         <span class="keyword">end</span>
0040 
0041         <a name="_sub2" href="#_subfunctions" class="code">function obj = addCustomFile(obj, varargin)</a>
0042             <span class="comment">% Add an entry to the file table.</span>
0043             <span class="comment">% A custom file entry can be added with no parameters, just the</span>
0044             <span class="comment">% name of the custom file entry, the name of the entry</span>
0045             <span class="comment">% alongside a filename, or can be fully defined by specifying</span>
0046             <span class="comment">% the name of the custom file entry, filename, language, and</span>
0047             <span class="comment">% file path. For MATLAB, the provided path must be in the</span>
0048             <span class="comment">% matlab path</span>
0049             <span class="comment">%</span>
0050             <span class="comment">% customFiles.addCustomFile()</span>
0051             <span class="comment">% customFiles.addCustomFile('New Row')</span>
0052             <span class="comment">% customFiles.addCustomFile('New Row', 'file.m')</span>
0053             <span class="comment">% customFiles.addCustomFile('New Row', 'file.py', 'python', 'C:/stuff')</span>
0054             <span class="keyword">if</span> isempty(varargin)
0055                 
0056                 <span class="comment">% Nothing supplied - add empty data row</span>
0057                 nameVal = obj.autoNameCounter();
0058                 newName = sprintf(<span class="string">'New custom file %d'</span>, nameVal);
0059                 
0060                 newRow = {newName, <span class="string">''</span>, supportedLanguages.Matlab.value, <span class="string">''</span>};
0061 
0062             <span class="keyword">else</span>
0063                 
0064                 inputs = varargin;
0065 
0066                 <span class="comment">% Check length of added data</span>
0067                 <span class="keyword">switch</span> length(inputs)
0068                     
0069                     <span class="keyword">case</span> 1
0070 
0071                         <span class="comment">% One input supplied - assume just name provided</span>
0072                         newName = inputs{1};
0073                         <span class="keyword">if</span> ~isText(newName)
0074                             throw(exceptions.invalidType(<span class="string">'Single input is expected to be a custom object name'</span>));
0075                         <span class="keyword">end</span>
0076                         
0077                         newRow = {newName, <span class="string">''</span>, supportedLanguages.Matlab.value, <span class="string">''</span>};
0078                         
0079                     <span class="keyword">case</span> 2
0080 
0081                         <span class="comment">% Two inputs suppled - assume both name and</span>
0082                         <span class="comment">% filename supplied;</span>
0083                         newName = char(inputs{1});
0084                         newFile = char(inputs{2});
0085 
0086                         newRow = {newName, newFile, supportedLanguages.Matlab.value, <span class="string">''</span>};
0087                         
0088                     <span class="keyword">case</span> 4
0089 
0090                         <span class="comment">% Four inputs = assume all inputs supplied</span>
0091                         newName = char(inputs{1});
0092                         newFile = char(inputs{2});
0093                         newLang = char(inputs{3});
0094                         newPath = char(inputs{4});
0095                         
0096                         newRow = {newName, newFile, newLang, newPath};
0097                         
0098                     <span class="keyword">otherwise</span>
0099 
0100                         <span class="comment">% Other length of inputs is not recognised</span>
0101                         throw(exceptions.invalidNumberOfInputs(<span class="string">'Unrecognised input into addCustomFile'</span>));
0102                         
0103                 <span class="keyword">end</span>
0104             <span class="keyword">end</span>
0105 
0106             <span class="comment">% Check language is valid, then add the new entry</span>
0107             newRow{3} = validateOption(newRow{3}, <span class="string">'supportedLanguages'</span>, obj.invalidLanguageMessage).value;
0108             obj.addRow(newRow{:});            
0109         <span class="keyword">end</span>
0110         
0111         <a name="_sub3" href="#_subfunctions" class="code">function obj = setCustomFile(obj, row, varargin)</a>
0112             <span class="comment">% Change the value of a given parameter in the file table.</span>
0113             <span class="comment">% The expected inputs are the row of the file entry of</span>
0114             <span class="comment">% interest (given either by name of index), and key-value pairs</span>
0115             <span class="comment">% of the parameter(s) to change. The values of the keys are:</span>
0116             <span class="comment">% &quot;Name&quot;, &quot;Filename&quot;, &quot;Language&quot;, and &quot;Path&quot;.</span>
0117             <span class="comment">% NOTE changing the path using this routine is not implemented</span>
0118             <span class="comment">%</span>
0119             <span class="comment">% customFiles.setcustomFile(1, 'Name', 'New Name',...</span>
0120             <span class="comment">%                           'Language', 'Octave')</span>
0121             customNames = obj.getNames;
0122             
0123             <span class="comment">% Always need three or more inputs to set data value</span>
0124             <span class="keyword">if</span> length(varargin) &lt; 2 || mod(length(varargin), 2) ~= 0
0125                 throw(exceptions.invalidNumberOfInputs(<span class="string">'The input to ''setCustomFile'' should be a file entry and a set of name-value pairs'</span>));
0126             <span class="keyword">end</span>
0127                 
0128             <span class="comment">% First input needs to be a data number or name</span>
0129             <span class="keyword">if</span> isnumeric(row)
0130                 <span class="keyword">if</span> (row &gt; obj.rowCount) || (row &lt; 1)
0131                     throw(exceptions.indexOutOfRange(sprintf(<span class="string">'The index %d is not within the range 1 - %d'</span>, row, obj.rowCount)));
0132                 <span class="keyword">end</span>
0133             <span class="keyword">elseif</span> isText(row)
0134                 row = obj.findRowIndex(row, customNames, sprintf(<span class="string">'Custom file object name %s not recognised'</span>, row));
0135             <span class="keyword">end</span>
0136             
0137             <span class="comment">% Parse the name value pairs to see what is being set and make</span>
0138             <span class="comment">% sure the data is of the correct size and type.</span>
0139 
0140             <span class="comment">% Make an 'inputParser' object...</span>
0141             p = inputParser;
0142 
0143             addParameter(p,<span class="string">'name'</span>,<span class="string">''</span>, @(x) isText(x))
0144             addParameter(p,<span class="string">'filename'</span>,<span class="string">''</span>, @(x) isText(x))
0145             addParameter(p,<span class="string">'language'</span>,<span class="string">''</span>, @(x) isText(x) || isenum(x))
0146             addParameter(p,<span class="string">'path'</span>,<span class="string">''</span>, @(x) isText(x)) 
0147             parse(p, varargin{:});
0148                 
0149             results = p.Results;
0150             
0151             <span class="comment">% Any fields in results that are not empty are being set,</span>
0152             <span class="comment">% so call the relevant set method for these (which will carry</span>
0153             <span class="comment">% out some additional checks)</span>
0154             <span class="keyword">if</span> ~isempty(results.filename)
0155                 obj.setFileName(row,results.filename);
0156             <span class="keyword">end</span>
0157             
0158             <span class="keyword">if</span> ~isempty(results.language)
0159                 results.language = validateOption(results.language, <span class="string">'supportedLanguages'</span>, obj.invalidLanguageMessage).value;
0160                 obj.setCustomLanguage(row, results.language);
0161             <span class="keyword">end</span>
0162             
0163             <span class="keyword">if</span> ~isempty(results.path)
0164                 <span class="comment">% NOT IMPLEMENTED</span>
0165                 obj.setCustomPath(row,results.path);
0166             <span class="keyword">end</span>
0167             
0168             <span class="keyword">if</span> ~isempty(results.name)
0169                 obj.setCustomName(row,results.name);
0170             <span class="keyword">end</span>            
0171 
0172         <span class="keyword">end</span>
0173 
0174         <a name="_sub4" href="#_subfunctions" class="code">function displayTable(obj)</a>
0175             <span class="comment">% Display the file table.</span>
0176             <span class="comment">%</span>
0177             <span class="comment">% customFiles.displayCustomFileObject()</span>
0178             tab = obj.varTable;
0179             
0180             sz = [1,4];
0181             displayVarTypes = {<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>}; 
0182             displayVarNames = {<span class="string">'Name'</span>,<span class="string">'Filename'</span>,<span class="string">'Language'</span>,<span class="string">'Path'</span>};
0183             <a href="#_sub5" class="code" title="subfunction displayTable(obj)">displayTable</a> = table(<span class="string">'Size'</span>,sz,<span class="string">'VariableTypes'</span>,displayVarTypes,<span class="string">'VariableNames'</span>,displayVarNames);
0184             
0185             tableSize = size(tab);
0186             
0187             <span class="keyword">if</span> tableSize(1) == 0
0188                 <a href="#_sub5" class="code" title="subfunction displayTable(obj)">displayTable</a>(1,:) = {<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>};
0189             <span class="keyword">else</span>
0190                 
0191                 <span class="keyword">for</span> i = 1:tableSize(1)
0192                     thisRow = tab(i,:);
0193                     
0194                     nameString = thisRow{1,1};
0195                     
0196                     thisCustomFile = thisRow{1,2}{:};
0197                     <span class="keyword">if</span> isempty(thisCustomFile)
0198                         fileNameString = <span class="string">'No File'</span>;
0199                     <span class="keyword">else</span>
0200                         fileNameString = char(thisCustomFile);
0201                     <span class="keyword">end</span>
0202                     
0203                     thisFileLanguage = thisRow{1,3}{:};
0204                     <span class="keyword">if</span> isempty(thisFileLanguage)
0205                         fileLanguageString = <span class="string">'-'</span>;
0206                     <span class="keyword">else</span>
0207                         fileLanguageString = thisFileLanguage;
0208                     <span class="keyword">end</span>
0209                     
0210                     thisFilePath = thisRow{1,4}{:};
0211                     <span class="keyword">if</span> isempty(thisFilePath)
0212                         thisFilePath = <span class="string">'pwd'</span>;
0213                     <span class="keyword">else</span>
0214                         thisFilePath = char(thisFilePath);
0215                         <span class="keyword">if</span> length(thisFilePath) &gt; 10
0216                             thisFilePath = [<span class="string">'...'</span> thisFilePath(end-10:end)];
0217                         <span class="keyword">end</span>
0218                     <span class="keyword">end</span>
0219                     newDisplayRow = {nameString, fileNameString, fileLanguageString, thisFilePath};
0220                     <a href="#_sub5" class="code" title="subfunction displayTable(obj)">displayTable</a>(i,:) = newDisplayRow;
0221                     
0222                 <span class="keyword">end</span>
0223             <span class="keyword">end</span>
0224 
0225             disp(<a href="#_sub5" class="code" title="subfunction displayTable(obj)">displayTable</a>);
0226         <span class="keyword">end</span>
0227         
0228         <a name="_sub5" href="#_subfunctions" class="code">function fileStruct = toStruct(obj)</a>
0229             <span class="comment">% Convert the custom files class to a struct</span>
0230             <span class="comment">%</span>
0231             <span class="comment">% customFiles.toStruct()</span>
0232             fileStruct.files = {};
0233             numberOfFiles = obj.rowCount;      
0234             <span class="keyword">if</span> numberOfFiles &gt; 0
0235                 filesList = cell(numberOfFiles, 1);
0236                 <span class="keyword">for</span> i = 1:numberOfFiles
0237                     thisRow = obj.varTable{i,:};
0238                     thisFile = thisRow{2};
0239                     thisType = thisRow{3};
0240                     thisPath = thisRow{4};                    
0241                     [~, functionName, ~] = fileparts(thisFile);
0242                     libpath = fullfile(thisPath, thisFile);
0243                     wrapper = [];
0244                     <span class="keyword">if</span> i &lt;= length(obj.wrappers)
0245                         wrapper = obj.wrappers{i};                        
0246                     <span class="keyword">end</span>
0247                     <span class="keyword">if</span> isempty(wrapper) || ~strcmp(wrapper.libPath, libpath) || ~strcmp(wrapper.functionName, functionName)
0248                         <span class="keyword">if</span> strcmpi(thisType, supportedLanguages.Python.value)
0249                             wrapper = pythonWrapper(libpath, functionName);
0250                             thisFile = wrapper.getHandle();
0251                         <span class="keyword">elseif</span> strcmpi(thisType, supportedLanguages.Cpp.value)
0252                             wrapper = dyLibWrapper(libpath, functionName);
0253                             thisFile = wrapper.getHandle();
0254                         <span class="keyword">end</span>
0255                         obj.wrappers{i} = wrapper;
0256                     <span class="keyword">else</span>
0257                         thisFile = wrapper.getHandle();
0258                     <span class="keyword">end</span>
0259                     [~, handle, ~] = fileparts(thisFile);
0260                     filesList{i} = handle;
0261                 <span class="keyword">end</span>
0262                 fileStruct.files = filesList;
0263             <span class="keyword">end</span>
0264         <span class="keyword">end</span>
0265 
0266     <span class="keyword">end</span>
0267 
0268     methods(Access = protected)
0269         <a name="_sub6" href="#_subfunctions" class="code">function obj = setCustomLanguage(obj, row, language)</a>
0270            <span class="comment">% Check whether a specified language is supported, and set the</span>
0271            <span class="comment">% file entry if so.</span>
0272            obj.varTable{row, 3} = {validateOption(language, <span class="string">'supportedLanguages'</span>, obj.invalidLanguageMessage).value};
0273         <span class="keyword">end</span> 
0274         
0275         <a name="_sub7" href="#_subfunctions" class="code">function obj = setCustomName(obj, whichCustom, name) </a>
0276             <span class="comment">% Check a potential new name is already</span>
0277             <span class="comment">% specified, and set it if not</span>
0278 
0279             <span class="comment">% Name must not be an existing name</span>
0280             existingNames = obj.varTable{:,1};
0281             <span class="keyword">if</span> any(strcmpi(name,existingNames))
0282                 throw(exceptions.duplicateName(<span class="string">'Duplicate custom file names are not allowed'</span>));
0283             <span class="keyword">end</span>
0284             
0285             <span class="comment">% Set the relevant name</span>
0286             obj.varTable{whichCustom,1} = {name};
0287         <span class="keyword">end</span>
0288         
0289         <a name="_sub8" href="#_subfunctions" class="code">function obj = setFileName(obj,whichCustom,name)</a>
0290             <span class="comment">% Set a new filename</span>
0291             obj.varTable{whichCustom,2} = {name};  
0292         <span class="keyword">end</span>
0293 
0294     <span class="keyword">end</span>
0295     
0296 <span class="keyword">end</span>
0297     
</pre></div>

<hr><address>Generated on Fri 01-Dec-2023 17:22:03 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>

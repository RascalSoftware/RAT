<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of customFileClass</title>
  <meta name="keywords" content="customFileClass">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html API -->
<!-- menu.html projectClass -->

<h1>customFileClass
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="customFileClass.html" class="code" title="">customFileClass</a>	</li>
<li><a href="tableUtilities.html" class="code" title="">tableUtilities</a>	</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="customFileClass.html" class="code" title="">customFileClass</a>	</li>
<li><a href="projectClass.html" class="code" title="">projectClass</a>	</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = customFileClass(varargin)</a></li>
<li><a href="#_sub2" class="code">function delete(obj)</a></li>
<li><a href="#_sub3" class="code">function obj = addCustomFile(obj, varargin)</a></li>
<li><a href="#_sub4" class="code">function obj = setCustomFile(obj, row, varargin)</a></li>
<li><a href="#_sub5" class="code">function displayTable(obj)</a></li>
<li><a href="#_sub6" class="code">functionNameString =</a></li>
<li><a href="#_sub7" class="code">functionNameString = thisFunctionName;</a></li>
<li><a href="#_sub8" class="code">function fileStruct = toStruct(obj)</a></li>
<li><a href="#_sub9" class="code">functionName = thisRow{3};</a></li>
<li><a href="#_sub10" class="code">function obj = setCustomName(obj, whichCustom, name)</a></li>
<li><a href="#_sub11" class="code">function path = validatePath(path)</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="customFileClass.html" class="code" title="">customFileClass</a> &lt; <a href="tableUtilities.html" class="code" title="">tableUtilities</a>
0002     
0003     <span class="comment">% A container class for holding custom files for either</span>
0004     <span class="comment">% models, backgrounds or resolutions.</span>
0005    properties (SetAccess = private, Hidden = true)
0006         wrappers = {}
0007    <span class="keyword">end</span>
0008 
0009     properties(Access = private, Constant, Hidden)
0010         invalidLanguageMessage = sprintf(<span class="string">'Language must be a supportedLanguages enum or one of the following strings (%s)'</span>, <span class="keyword">...</span>
0011                                          strjoin(supportedLanguages.values(), <span class="string">', '</span>))    
0012     <span class="keyword">end</span>
0013     
0014     methods
0015         
0016         <a name="_sub0" href="#_subfunctions" class="code">function obj = customFileClass(varargin)</a>
0017             <span class="comment">% Construct a custom file class containing either an empty</span>
0018             <span class="comment">% table or one with a single row.</span>
0019             <span class="comment">% No input is required for an empty table, otherwise the</span>
0020             <span class="comment">% parameters for the first row should be provided.</span>
0021             <span class="comment">%</span>
0022             <span class="comment">% customFiles = customFileClass()</span>
0023             sz = [0 5];
0024             varTypes = {<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>};
0025             varNames = {<span class="string">'Name'</span>,<span class="string">'Filename'</span>,<span class="string">'Function Name'</span>,<span class="string">'Language'</span>,<span class="string">'Path'</span>};
0026             obj.varTable = table(<span class="string">'Size'</span>,sz,<span class="string">'VariableTypes'</span>,varTypes,<span class="string">'VariableNames'</span>,varNames);
0027 
0028             <span class="keyword">if</span> ~isempty(varargin)
0029                 obj.addCustomFile(varargin{:});
0030             <span class="keyword">end</span>          
0031         <span class="keyword">end</span>
0032 
0033         <a name="_sub1" href="#_subfunctions" class="code">function delete(obj)</a>
0034             <span class="comment">% Destroys the wrappers</span>
0035             <span class="keyword">for</span> i=1:length(obj.wrappers) 
0036                 <a href="#_sub2" class="code" title="subfunction delete(obj)">delete</a>(obj.wrappers{i});
0037             <span class="keyword">end</span>
0038             obj.wrappers = {};
0039         <span class="keyword">end</span>
0040 
0041         <a name="_sub2" href="#_subfunctions" class="code">function obj = addCustomFile(obj, varargin)</a>
0042             <span class="comment">% Add an entry to the file table.</span>
0043             <span class="comment">% A custom file entry can be added with no parameters, just the</span>
0044             <span class="comment">% name of the custom file entry, the name of the entry</span>
0045             <span class="comment">% alongside a filename, or can be fully defined by specifying</span>
0046             <span class="comment">% the name of the custom file entry, filename, language, and</span>
0047             <span class="comment">% file path. For MATLAB, the provided path must be in the</span>
0048             <span class="comment">% matlab path</span>
0049             <span class="comment">%</span>
0050             <span class="comment">% customFiles.addCustomFile()</span>
0051             <span class="comment">% customFiles.addCustomFile('New Row')</span>
0052             <span class="comment">% customFiles.addCustomFile('New Row', 'file.m')</span>
0053             <span class="comment">% customFiles.addCustomFile('New Row', 'file.m', 'matlab')</span>
0054             <span class="comment">% customFiles.addCustomFile('New Row', 'file.py', 'python', 'C:/stuff')</span>
0055             <span class="comment">% customFiles.addCustomFile('New Row', 'file.py', 'python', 'C:/stuff', 'py_function')</span>
0056             newFile = <span class="string">''</span>;
0057             newLang = supportedLanguages.Matlab.value;
0058             newPath = <span class="string">''</span>;
0059             newFunc = <span class="string">''</span>;
0060             <span class="keyword">if</span> isempty(varargin)
0061                 <span class="comment">% Nothing supplied - add empty data row</span>
0062                 nameVal = obj.autoNameCounter();
0063                 newName = sprintf(<span class="string">'New custom file %d'</span>, nameVal);
0064             <span class="keyword">else</span>
0065                 inputs = varargin;
0066                 newName = inputs{1};
0067                 
0068                 <span class="keyword">if</span> ~isText(newName)
0069                     throw(exceptions.invalidType(<span class="string">'First value must be unique name identifer (text)'</span>));
0070                 <span class="keyword">end</span>
0071                 <span class="comment">% Check length of added data</span>
0072                 <span class="keyword">switch</span> length(inputs)
0073                     <span class="keyword">case</span> 1   
0074                     <span class="keyword">case</span> 2
0075                     
0076                         <span class="comment">% Two inputs suppled - assume both name and filename supplied;</span>
0077                         newName = inputs{1};
0078                         newFile = inputs{2};
0079                     
0080                     <span class="keyword">case</span> 3
0081 
0082                         <span class="comment">% Three inputs - assume all inputs except function name and path supplied</span>
0083                         newName = inputs{1};
0084                         newFile = inputs{2};
0085                         newLang = inputs{3};
0086                         
0087                     <span class="keyword">case</span> 4
0088 
0089                         <span class="comment">% Four inputs - assume all inputs except function name supplied</span>
0090                         newName = inputs{1};
0091                         newFile = inputs{2};
0092                         newLang = inputs{3};
0093                         newPath = inputs{4};
0094 
0095                     <span class="keyword">case</span> 5
0096 
0097                         <span class="comment">% Five inputs - assume all inputs supplied</span>
0098                         newName = inputs{1};
0099                         newFile = inputs{2};
0100                         newLang = inputs{3};
0101                         newPath = inputs{4};
0102                         newFunc = inputs{5};
0103                         
0104                     <span class="keyword">otherwise</span>
0105 
0106                         <span class="comment">% Other length of inputs is not recognised</span>
0107                         throw(exceptions.invalidNumberOfInputs(<span class="string">'Unrecognised input into addCustomFile'</span>));
0108                         
0109                 <span class="keyword">end</span>
0110             <span class="keyword">end</span>
0111 
0112             <span class="keyword">if</span> ~isText(newFile)
0113                 throw(exceptions.invalidType(<span class="string">'Second argument (Filename) must be text.'</span>));
0114             <span class="keyword">end</span>
0115 
0116             <span class="keyword">if</span> ~isText(newPath)
0117                 throw(exceptions.invalidType(<span class="string">'Forth argument (Path) must be text.'</span>));
0118             <span class="keyword">end</span>
0119 
0120             <span class="keyword">if</span> ~isText(newFunc)
0121                 throw(exceptions.invalidType(<span class="string">'Fifth argument (Function name) must be text.'</span>));
0122             <span class="keyword">end</span>
0123 
0124             <span class="keyword">if</span> isempty(newFunc)
0125                 [~, newFunc, ~] = fileparts(newFile);
0126             <span class="keyword">end</span>
0127             <span class="comment">% Check language is valid, then add the new entry</span>
0128             newLang = validateOption(newLang, <span class="string">'supportedLanguages'</span>, obj.invalidLanguageMessage).value;
0129             obj.addRow(newName, newFile, newFunc, newLang, obj.validatePath(newPath));            
0130         <span class="keyword">end</span>
0131         
0132         <a name="_sub3" href="#_subfunctions" class="code">function obj = setCustomFile(obj, row, varargin)</a>
0133             <span class="comment">% Change the value of a given parameter in the file table.</span>
0134             <span class="comment">% The expected inputs are the row of the file entry of</span>
0135             <span class="comment">% interest (given either by name of index), and key-value pairs</span>
0136             <span class="comment">% of the parameter(s) to change. The values of the keys are:</span>
0137             <span class="comment">% &quot;Name&quot;, &quot;Filename&quot;, &quot;Language&quot;, and &quot;Path&quot;.</span>
0138             <span class="comment">% NOTE changing the path using this routine is not implemented</span>
0139             <span class="comment">%</span>
0140             <span class="comment">% customFiles.setcustomFile(1, 'Name', 'New Name',...</span>
0141             <span class="comment">%                           'Language', 'Octave')</span>
0142             customNames = obj.getNames;
0143             
0144             <span class="comment">% Always need three or more inputs to set data value</span>
0145             <span class="keyword">if</span> length(varargin) &lt; 2 || mod(length(varargin), 2) ~= 0
0146                 throw(exceptions.invalidNumberOfInputs(<span class="string">'The input to ''setCustomFile'' should be a file entry and a set of name-value pairs'</span>));
0147             <span class="keyword">end</span>
0148                 
0149             <span class="comment">% First input needs to be a data number or name</span>
0150             <span class="keyword">if</span> isnumeric(row)
0151                 <span class="keyword">if</span> (row &gt; obj.rowCount) || (row &lt; 1)
0152                     throw(exceptions.indexOutOfRange(sprintf(<span class="string">'The index %d is not within the range 1 - %d'</span>, row, obj.rowCount)));
0153                 <span class="keyword">end</span>
0154             <span class="keyword">elseif</span> isText(row)
0155                 row = obj.findRowIndex(row, customNames, sprintf(<span class="string">'Custom file object name %s not recognised'</span>, row));
0156             <span class="keyword">end</span>
0157             
0158             <span class="comment">% Parse the name value pairs to see what is being set and make</span>
0159             <span class="comment">% sure the data is of the correct size and type.</span>
0160 
0161             <span class="comment">% Make an 'inputParser' object...</span>
0162             p = inputParser;
0163             addParameter(p, <span class="string">'name'</span>, obj.varTable{row, 1}{:}, @(x) isText(x))
0164             addParameter(p, <span class="string">'filename'</span>, obj.varTable{row, 2}{:}, @(x) isText(x))
0165             addParameter(p, <span class="string">'functionName'</span>, obj.varTable{row, 3}{:}, @(x) isText(x))
0166             addParameter(p, <span class="string">'language'</span>, obj.varTable{row, 4}{:}, @(x) isText(x) || isenum(x))
0167             addParameter(p, <span class="string">'path'</span>, obj.varTable{row, 5}{:}, @(x) isText(x)) 
0168             parse(p, varargin{:});
0169                 
0170             results = p.Results;
0171             
0172             obj.setCustomName(row, results.name);
0173             obj.varTable{row, 2} = {results.filename};
0174             obj.varTable{row, 3} = {results.functionName};
0175             obj.varTable{row, 4} = {validateOption(results.language, <span class="string">'supportedLanguages'</span>, obj.invalidLanguageMessage).value};
0176             obj.varTable{row, 5} = {obj.validatePath(results.path)};
0177         <span class="keyword">end</span>
0178 
0179         <a name="_sub4" href="#_subfunctions" class="code">function displayTable(obj)</a>
0180             <span class="comment">% Display the file table.</span>
0181             <span class="comment">%</span>
0182             <span class="comment">% customFiles.displayCustomFileObject()</span>
0183             tab = obj.varTable;
0184             
0185             sz = [1,5];
0186             displayVarTypes = {<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>,<span class="string">'string'</span>}; 
0187             displayVarNames = {<span class="string">'Name'</span>,<span class="string">'Filename'</span>,<span class="string">'Function Name'</span>,<span class="string">'Language'</span>,<span class="string">'Path'</span>};
0188             <a href="#_sub5" class="code" title="subfunction displayTable(obj)">displayTable</a> = table(<span class="string">'Size'</span>,sz,<span class="string">'VariableTypes'</span>,displayVarTypes,<span class="string">'VariableNames'</span>,displayVarNames);
0189             
0190             tableSize = size(tab);
0191             
0192             <span class="keyword">if</span> tableSize(1) == 0
0193                 <a href="#_sub5" class="code" title="subfunction displayTable(obj)">displayTable</a>(1,:) = {<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>};
0194             <span class="keyword">else</span>
0195                 
0196                 <span class="keyword">for</span> i = 1:tableSize(1)
0197                     thisRow = tab(i,:);
0198                     
0199                     nameString = thisRow{1,1};
0200                     
0201                     thisCustomFile = thisRow{1,2}{:};
0202                     <span class="keyword">if</span> isempty(thisCustomFile)
0203                         fileNameString = <span class="string">'No File'</span>;
0204                     <span class="keyword">else</span>
0205                         fileNameString = char(thisCustomFile);
0206                     <span class="keyword">end</span>
0207 
0208                     thisFunctionName = thisRow{1,3}{:};
0209                     <span class="keyword">if</span> isempty(thisFunctionName)
0210                         <a name="_sub5" href="#_subfunctions" class="code">functionNameString = </a><span class="string">'-'</span>;
0211                     <span class="keyword">else</span>
0212                         <a name="_sub6" href="#_subfunctions" class="code">functionNameString = thisFunctionName;</a>
0213                     <span class="keyword">end</span>
0214 
0215                     thisFileLanguage = thisRow{1,4}{:};
0216                     <span class="keyword">if</span> isempty(thisFileLanguage)
0217                         fileLanguageString = <span class="string">'-'</span>;
0218                     <span class="keyword">else</span>
0219                         fileLanguageString = thisFileLanguage;
0220                     <span class="keyword">end</span>
0221                     
0222                     thisFilePath = thisRow{1,5}{:};
0223                     <span class="keyword">if</span> isempty(thisFilePath)
0224                         thisFilePath = <span class="string">'pwd'</span>;
0225                     <span class="keyword">else</span>
0226                         thisFilePath = char(thisFilePath);
0227                         <span class="keyword">if</span> length(thisFilePath) &gt; 50
0228                             thisFilePath = [<span class="string">'...'</span> thisFilePath(end-50:end)];
0229                         <span class="keyword">end</span>
0230                     <span class="keyword">end</span>
0231                     newDisplayRow = {nameString, fileNameString, functionNameString, fileLanguageString, thisFilePath};
0232                     <a href="#_sub5" class="code" title="subfunction displayTable(obj)">displayTable</a>(i,:) = newDisplayRow;
0233                     
0234                 <span class="keyword">end</span>
0235             <span class="keyword">end</span>
0236 
0237             disp(<a href="#_sub5" class="code" title="subfunction displayTable(obj)">displayTable</a>);
0238         <span class="keyword">end</span>
0239         
0240         <a name="_sub7" href="#_subfunctions" class="code">function fileStruct = toStruct(obj)</a>
0241             <span class="comment">% Convert the custom files class to a struct</span>
0242             <span class="comment">%</span>
0243             <span class="comment">% customFiles.toStruct()</span>
0244             fileStruct.files = {};
0245             numberOfFiles = obj.rowCount;      
0246             <span class="keyword">if</span> numberOfFiles &gt; 0
0247                 filesList = cell(numberOfFiles, 1);
0248                 <span class="keyword">for</span> i = 1:numberOfFiles
0249                     thisRow = obj.varTable{i,:};
0250                     thisFile = thisRow{2};
0251                     <a name="_sub8" href="#_subfunctions" class="code">functionName = thisRow{3};</a>
0252                     thisType = thisRow{4};
0253                     thisPath = thisRow{5};
0254                     <span class="keyword">if</span> isempty(thisPath)
0255                         thisPath = pwd;
0256                     <span class="keyword">end</span>
0257             
0258                     libpath = fullfile(what(thisPath).path, thisFile);
0259                     <span class="keyword">if</span> strcmpi(thisType, supportedLanguages.Matlab.value)
0260                         foundPath = which(functionName);
0261                         <span class="keyword">if</span> isempty(foundPath)
0262                             msg = <span class="string">'The Matlab custom file (%s) is not on the search path. Add the file to path and check using &quot;which(%s)&quot;.'</span>;
0263                             throw(exceptions.invalidPath(sprintf(msg, strrep(libpath, <span class="string">'\'</span>, <span class="string">'/'</span>), functionName)));
0264                         <span class="keyword">elseif</span> ~isempty(thisPath) &amp;&amp; ~strcmp(foundPath, libpath)                        
0265                             msg = <span class="string">'The Matlab custom file (%s) on the search path does not match the given path (%s).'</span>;
0266                             throw(exceptions.invalidPath(sprintf(msg, strrep(foundPath, <span class="string">'\'</span>, <span class="string">'/'</span>), strrep(libpath, <span class="string">'\'</span>, <span class="string">'/'</span>))));
0267                         <span class="keyword">end</span>
0268                     <span class="keyword">else</span>
0269                         <span class="keyword">if</span> ~exist(libpath, <span class="string">'file'</span>)
0270                             msg = <span class="string">'The custom file (%s) cannot be found. Check that the path and filename is correct (%s).'</span>;
0271                             throw(exceptions.invalidPath(sprintf(msg, thisFile, strrep(libpath, <span class="string">'\'</span>, <span class="string">'/'</span>))));
0272                         <span class="keyword">end</span>
0273                     <span class="keyword">end</span>
0274                     wrapper = [];
0275                     <span class="keyword">if</span> i &lt;= length(obj.wrappers)
0276                         wrapper = obj.wrappers{i};                        
0277                     <span class="keyword">end</span>
0278                     <span class="keyword">if</span> isempty(wrapper) || ~strcmp(wrapper.libPath, libpath) || ~strcmp(wrapper.functionName, functionName)
0279                         <span class="keyword">if</span> strcmpi(thisType, supportedLanguages.Python.value)
0280                             wrapper = pythonWrapper(libpath, functionName);
0281                             thisFile = wrapper.getHandle();
0282                         <span class="keyword">elseif</span> strcmpi(thisType, supportedLanguages.Cpp.value)
0283                             wrapper = dyLibWrapper(libpath, functionName);
0284                             thisFile = wrapper.getHandle();
0285                         <span class="keyword">end</span>
0286                         obj.wrappers{i} = wrapper;
0287                     <span class="keyword">else</span>
0288                         thisFile = wrapper.getHandle();
0289                     <span class="keyword">end</span>
0290                     [~, handle, ~] = fileparts(thisFile);
0291                     filesList{i} = handle;
0292                 <span class="keyword">end</span>
0293                 fileStruct.files = filesList;
0294             <span class="keyword">end</span>
0295         <span class="keyword">end</span>
0296 
0297     <span class="keyword">end</span>
0298 
0299     methods(Access = protected)
0300         <a name="_sub9" href="#_subfunctions" class="code">function obj = setCustomName(obj, whichCustom, name) </a>
0301             <span class="comment">% Check a potential new name is already</span>
0302             <span class="comment">% specified, and set it if not</span>
0303 
0304             <span class="comment">% Name must not be an existing name</span>
0305             existingNames = obj.varTable{:,1};
0306             existingNames(whichCustom) = [];
0307             <span class="keyword">if</span> any(strcmpi(name,existingNames))
0308                 throw(exceptions.duplicateName(<span class="string">'Duplicate custom file names are not allowed'</span>));
0309             <span class="keyword">end</span>
0310             
0311             <span class="comment">% Set the relevant name</span>
0312             obj.varTable{whichCustom,1} = {name};
0313         <span class="keyword">end</span>
0314     <span class="keyword">end</span>
0315 
0316     methods(Static)
0317         <a name="_sub10" href="#_subfunctions" class="code">function path = validatePath(path)</a>
0318             <span class="comment">% Validate a new path exists</span>
0319             <span class="keyword">if</span> ~isempty(path) &amp;&amp; ~exist(path, <span class="string">'dir'</span>)
0320                 throw(exceptions.invalidPath(sprintf(<span class="string">'The given path (%s) is not a valid directory'</span>, path)));
0321             <span class="keyword">end</span>
0322         <span class="keyword">end</span>
0323     <span class="keyword">end</span>
0324     
0325 <span class="keyword">end</span>
0326     
</pre></div>

<hr><address>Generated on Wed 05-Jun-2024 09:06:47 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>

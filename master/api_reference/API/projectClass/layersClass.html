<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of layersClass</title>
  <meta name="keywords" content="layersClass">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html API -->
<!-- menu.html projectClass -->

<h1>layersClass
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="layersClass.html" class="code" title="">layersClass</a>	</li>
<li><a href="tableUtilities.html" class="code" title="">tableUtilities</a>	</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../API/project.html" class="code" title="function obj = project(options)">project</a>	Creates a project object.</li>
<li><a href="layersClass.html" class="code" title="">layersClass</a>	</li>
<li><a href="projectClass.html" class="code" title="">projectClass</a>	</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = layersClass(SLDValues)</a></li>
<li><a href="#_sub2" class="code">function count = get.varCount(obj)</a></li>
<li><a href="#_sub3" class="code">function obj = addLayer(obj, paramNames, varargin)</a></li>
<li><a href="#_sub4" class="code">function obj = setLayerValue(obj, row, col, inputValue, paramNames)</a></li>
<li><a href="#_sub5" class="code">function outStruct = toStruct(obj, paramNames, modelType)</a></li>
<li><a href="#_sub6" class="code">function param = findParameter(inputVal, paramNames)</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="layersClass.html" class="code" title="">layersClass</a> &lt; <a href="tableUtilities.html" class="code" title="">tableUtilities</a>
0002     
0003     <span class="comment">% This is the class definition for the layers block.</span>
0004 
0005     properties(Access = private, Constant, Hidden)
0006         invalidTypeMessage = sprintf(<span class="string">'Hydration type must be a HydrationTypes enum or one of the following strings (%s)'</span>, <span class="keyword">...</span>
0007                                      strjoin(hydrationTypes.values(), <span class="string">', '</span>))
0008     <span class="keyword">end</span>
0009     
0010     properties (Dependent, SetAccess = private)
0011         varCount
0012     <span class="keyword">end</span>
0013     
0014     methods
0015         
0016         <a name="_sub0" href="#_subfunctions" class="code">function obj = layersClass(SLDValues)</a>
0017             <span class="comment">% Construct a layers class including an empty layers table</span>
0018             <span class="comment">% The optional input is a cell array of the required SLD</span>
0019             <span class="comment">% parameters.</span>
0020             <span class="comment">%</span>
0021             <span class="comment">% layers = layersClass();</span>
0022             arguments
0023                 SLDValues {mustBeText} = <span class="string">'SLD'</span>
0024             <span class="keyword">end</span>
0025 
0026             varNames = [{<span class="string">'Name'</span>, <span class="string">'Thickness'</span>}, SLDValues, {<span class="string">'Roughness'</span>,<span class="string">'Hydration'</span>,<span class="string">'Hydrate with'</span>}];
0027 
0028             sz = [0 length(varNames)];
0029             varTypes = repmat({<span class="string">'string'</span>}, 1, length(varNames));
0030             obj.varTable = table(<span class="string">'Size'</span>,sz,<span class="string">'VariableTypes'</span>,varTypes,<span class="string">'VariableNames'</span>,varNames);
0031         <span class="keyword">end</span>
0032 
0033         <a name="_sub1" href="#_subfunctions" class="code">function count = get.varCount(obj)</a>
0034             count = length(obj.varTable.Properties.VariableNames);
0035         <span class="keyword">end</span>
0036 
0037         <a name="_sub2" href="#_subfunctions" class="code">function obj = addLayer(obj, paramNames, varargin)</a>
0038             <span class="comment">% Add a layer to the layers table</span>
0039             <span class="comment">% The expected input is a string array of parameter names</span>
0040             <span class="comment">% defined in the project's parameter class and a variable</span>
0041             <span class="comment">% number of layer parameters. The layer can be specified with</span>
0042             <span class="comment">% no parameters, just a layer name (char), or a fully defined</span>
0043             <span class="comment">% layer, which consists of either all except two parameters</span>
0044             <span class="comment">% (no hydration) or all parameters.</span>
0045             <span class="comment">% Parameters can be specified either by name or by index.</span>
0046             <span class="comment">%</span>
0047             <span class="comment">% layers.addLayer(parameters.varTable{:, 1});</span>
0048             <span class="comment">% layers.addLayer(parameters.varTable{:, 1}, 'New layer');</span>
0049             <span class="comment">% layers.addLayer(parameters.varTable{:, 1},...</span>
0050             <span class="comment">%                 'Another layer', 1, 2, 3);</span>
0051             layerDetails = varargin;
0052 
0053             <span class="keyword">if</span> isempty(layerDetails)
0054                 <span class="comment">% Add an empty layer</span>
0055                 layerNum = obj.autoNameCounter;
0056                 layerName = sprintf(<span class="string">'Layer %d'</span>,layerNum);
0057                 newRow = [{layerName}, repmat({<span class="string">''</span>}, 1, obj.varCount - 2), {hydrationTypes.BulkOut.value}];
0058                 
0059             <span class="keyword">elseif</span> length(layerDetails) == 1 &amp;&amp; isText(layerDetails{1})
0060                 <span class="comment">% Add an empty named layer</span>
0061                 newRow = [layerDetails(1), repmat({<span class="string">''</span>}, 1, obj.varCount - 2), {hydrationTypes.BulkOut.value}];
0062             
0063             <span class="keyword">else</span>
0064                 <span class="comment">% Add a layer that is fully defined</span>
0065                 <span class="keyword">if</span> length(layerDetails) == (obj.varCount - 2)
0066                     <span class="comment">% No hydration</span>
0067                     layerDetails = [layerDetails, {NaN, hydrationTypes.BulkOut.value}];
0068                 <span class="keyword">elseif</span> length(layerDetails) ~= obj.varCount
0069                     throw(invalidNumberOfInputs(sprintf(<span class="string">'Incorrect number of parameters for layer definition. Either 0, 1, %d, or %d inputs are required.'</span>, obj.varCount - 2, obj.varCount)));
0070                 <span class="keyword">end</span>
0071                 
0072                 name = layerDetails{1};
0073                 hydration = validateOption(layerDetails{end}, <span class="string">'hydrationTypes'</span>, obj.invalidTypeMessage).value;
0074                 
0075                 <span class="comment">% Check that the parameter names given are real</span>
0076                 <span class="comment">% parameters or numbers</span>
0077                 newRow = {name};
0078                 
0079                 <span class="comment">% Must be a parameter name or number . . .</span>
0080                 <span class="keyword">for</span> i = 2:(obj.varCount - 2)
0081                     newRow{i} = obj.findParameter(layerDetails{i}, paramNames);
0082                 <span class="keyword">end</span>
0083 
0084                 <span class="comment">%  . . . (apart from the penultimate column which can also be NaN)</span>
0085                 <span class="keyword">if</span> isnan(layerDetails{obj.varCount - 1})
0086                     newRow{obj.varCount - 1} = NaN;
0087                 <span class="keyword">else</span>
0088                     newRow{obj.varCount - 1} = obj.findParameter(layerDetails{obj.varCount - 1}, paramNames);
0089                 <span class="keyword">end</span>
0090                 
0091                 newRow = [newRow hydration];
0092 
0093             <span class="keyword">end</span>
0094 
0095             obj.addRow(newRow{:});
0096 
0097         <span class="keyword">end</span>
0098         
0099         <a name="_sub3" href="#_subfunctions" class="code">function obj = setLayerValue(obj, row, col, inputValue, paramNames)</a>
0100             <span class="comment">% Change the value of a given layer parameter in the table</span>
0101             <span class="comment">% (excluding the layer name). The row and column of the</span>
0102             <span class="comment">% parameter can both be specified by either name or index.</span>
0103             <span class="comment">% The expected input is a row parameter (name or index), a</span>
0104             <span class="comment">% column parameter (name or index), the new value to be set at</span>
0105             <span class="comment">% that row and column, and a string array of parameter names</span>
0106             <span class="comment">% defined in the project's parameter class.</span>
0107             <span class="comment">%</span>
0108             <span class="comment">% layers.setLayerValue(1, 1, 'origin', parameters.varTable{:, 1});</span>
0109             layerNames = obj.varTable{:,1};
0110             colNames = obj.varTable.Properties.VariableNames;
0111             
0112             <span class="comment">% Find the row index if we have a layer name</span>
0113             <span class="keyword">if</span> isText(row)
0114                 row = obj.findRowIndex(row, layerNames, <span class="string">'Unrecognised layer name'</span>);
0115             <span class="keyword">elseif</span> isnumeric(row)
0116                 <span class="keyword">if</span> (row &lt; 1) || (row &gt; obj.rowCount)
0117                     throw(indexOutOfRange(sprintf(<span class="string">'The row index %d is not within the range 1 - %d'</span>, row, obj.rowCount)));
0118                 <span class="keyword">end</span>
0119             <span class="keyword">else</span>
0120                 throw(invalidType(<span class="string">'Unrecognised layer type'</span>));
0121             <span class="keyword">end</span>
0122             
0123             <span class="comment">% Find the column index if we have a column name</span>
0124             <span class="keyword">if</span> isText(col)
0125                 col = obj.findRowIndex(col, colNames, <span class="string">'Unrecognised column name'</span>);
0126             <span class="keyword">elseif</span> isnumeric(col)
0127                 <span class="keyword">if</span> (col &lt; 1) || (col &gt; length(colNames))
0128                     throw(indexOutOfRange(sprintf(<span class="string">'The column index %d is not within the range 1 - %d'</span>, col, length(colNames))));
0129                 <span class="keyword">end</span>
0130             <span class="keyword">else</span>
0131                 throw(invalidType(<span class="string">'Unrecognised layer table column type'</span>));
0132             <span class="keyword">end</span>
0133 
0134             <span class="keyword">if</span> ~isnumeric(col) || col &lt; 2  || col &gt; length(colNames)
0135                 throw(indexOutOfRange(sprintf(<span class="string">'Column index should be a number between 2 and %d'</span>, length(colNames))));
0136             <span class="keyword">end</span>
0137 
0138             <span class="keyword">if</span> col == length(colNames)
0139                 val = validateOption(inputValue, <span class="string">'hydrationTypes'</span>, obj.invalidTypeMessage).value;
0140             <span class="keyword">else</span>
0141                 val = obj.findParameter(inputValue, paramNames);
0142             <span class="keyword">end</span>
0143                 
0144             obj.varTable(row,col) = {val};
0145             
0146         <span class="keyword">end</span>
0147         
0148         <a name="_sub4" href="#_subfunctions" class="code">function outStruct = toStruct(obj, paramNames, modelType)</a>
0149             <span class="comment">% Convert the layers class to a struct.</span>
0150             <span class="comment">%</span>
0151             <span class="comment">% layers.toStruct()</span>
0152             <span class="comment">%outStruct = table2cell(obj.varTable);</span>
0153             layersCell = obj.varTable{:,:};
0154 
0155             outStruct.numberOfLayers = size(layersCell, 1);
0156             outStruct.layersNames = layersCell(:,1);
0157             
0158             <span class="comment">% parse the layers details</span>
0159             layersValues = layersCell(:,2:end);
0160             
0161             <span class="keyword">switch</span> modelType
0162 
0163                 <span class="keyword">case</span> modelTypes.StandardLayers.value
0164                     numberOfLayers = outStruct.numberOfLayers;
0165                     
0166                     <span class="keyword">if</span> numberOfLayers &gt; 0
0167                         <span class="comment">% Standard layers with layers present</span>
0168                         layersDetails = cell([1, outStruct.numberOfLayers]);
0169 
0170                         <span class="keyword">for</span> i = 1:outStruct.numberOfLayers
0171 
0172                             thisLayer = layersValues(i,:);
0173                             numCols = length(thisLayer);
0174                             paramIndices = zeros(1,numCols-2);
0175                             <span class="keyword">for</span> j = 1:numCols-2
0176                                 paramIndices(j) = find(strcmpi(thisLayer{j},paramNames));
0177                             <span class="keyword">end</span>
0178 
0179                             <span class="keyword">if</span> ismissing(thisLayer(numCols-1))
0180                                 hydr = NaN;
0181                             <span class="keyword">else</span>
0182                                 hydr = find(strcmpi(thisLayer{numCols-1},paramNames));
0183                             <span class="keyword">end</span>
0184 
0185                             <span class="keyword">if</span> strcmpi(thisLayer{numCols}, hydrationTypes.BulkIn.value)
0186                                 hydrWhat = 1;
0187                             <span class="keyword">else</span>
0188                                 hydrWhat = 2;
0189                             <span class="keyword">end</span>
0190                             layersDetails{i} = [paramIndices hydr hydrWhat];
0191                             
0192                         <span class="keyword">end</span>
0193                         outStruct.layersDetails = layersDetails(:);
0194                     <span class="keyword">else</span>
0195                         <span class="comment">% No layers present - still need to set</span>
0196                         <span class="comment">% layersDetails</span>
0197                         outStruct.layersDetails = {};
0198                     <span class="keyword">end</span>
0199                 <span class="keyword">otherwise</span>
0200                     <span class="comment">% Not standard layers experiment type</span>
0201                     outStruct.layersDetails = {};
0202             <span class="keyword">end</span>
0203 
0204         <span class="keyword">end</span>
0205 
0206     <span class="keyword">end</span>
0207         
0208     methods(Static)
0209 
0210         <a name="_sub5" href="#_subfunctions" class="code">function param = findParameter(inputVal, paramNames)</a>
0211             <span class="comment">% Find whether or not a proposed layer parameter is included</span>
0212             <span class="comment">% in a list of parameters, or obtain a parameter by index.</span>
0213             <span class="comment">% The expected inputs are the potential layer parameter value</span>
0214             <span class="comment">% (either name or index) and a list of parameter names.</span>
0215 
0216             <span class="keyword">if</span> isText(inputVal)
0217                 <span class="keyword">if</span> ~any(strcmpi(inputVal, paramNames))
0218                     throw(nameNotRecognised(sprintf(<span class="string">'Parameter %s not recognized'</span>, inputVal)));
0219                 <span class="keyword">end</span>
0220                 param = inputVal;
0221 
0222             <span class="keyword">elseif</span> isnumeric(inputVal)
0223                 paramIndex = floor(inputVal);
0224                 <span class="keyword">if</span> paramIndex &lt; 1 || paramIndex &gt; length(paramNames)
0225                     throw(indexOutOfRange(sprintf(<span class="string">'Parameter ''%d'' is out of range 1 - %d'</span>, paramIndex, length(paramNames))));
0226                 <span class="keyword">end</span>
0227                 param = paramNames{paramIndex};
0228 
0229             <span class="keyword">else</span>
0230                 throw(invalidType(sprintf(<span class="string">'Parameter %s is not in a recognizable format'</span>, inputVal)));
0231                 
0232             <span class="keyword">end</span>
0233         <span class="keyword">end</span>
0234 
0235     <span class="keyword">end</span>
0236 <span class="keyword">end</span>
0237 
0238 
0239 
0240 
</pre></div>

<hr><address>Generated on Tue 20-Jun-2023 16:21:19 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of projectClass</title>
  <meta name="keywords" content="projectClass">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html API -->
<!-- menu.html projectClass -->

<h1>projectClass
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../API/mergeStructs.html" class="code" title="function outStruct = mergeStructs(varargin)">mergeStructs</a>	</li>
<li><a href="backgroundsClass.html" class="code" title="">backgroundsClass</a>	</li>
<li><a href="contrastsClass.html" class="code" title="">contrastsClass</a>	</li>
<li><a href="customFileClass.html" class="code" title="">customFileClass</a>	</li>
<li><a href="dataClass.html" class="code" title="">dataClass</a>	</li>
<li><a href="domainsClass.html" class="code" title="">domainsClass</a>	</li>
<li><a href="layersClass.html" class="code" title="">layersClass</a>	</li>
<li><a href="parametersClass.html" class="code" title="">parametersClass</a>	</li>
<li><a href="projectClass.html" class="code" title="">projectClass</a>	</li>
<li><a href="resolutionsClass.html" class="code" title="">resolutionsClass</a>	</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../API/createProject.html" class="code" title="function obj = createProject(options)">createProject</a>	Creates a project object.</li>
<li><a href="domainsClass.html" class="code" title="">domainsClass</a>	</li>
<li><a href="projectClass.html" class="code" title="">projectClass</a>	</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = projectClass(experimentName, calculationType, modelType, geometry, absorption)</a></li>
<li><a href="#_sub2" class="code">function delete(obj)</a></li>
<li><a href="#_sub3" class="code">function domainsObj = toDomainsClass(obj)</a></li>
<li><a href="#_sub4" class="code">function obj = setUsePriors(obj, showFlag)</a></li>
<li><a href="#_sub5" class="code">function obj = setGeometry(obj, geometry)</a></li>
<li><a href="#_sub6" class="code">function obj = setModelType(obj, modelType)</a></li>
<li><a href="#_sub7" class="code">function names = getAllAllowedNames(obj)</a></li>
<li><a href="#_sub8" class="code">function obj = addParameterGroup(obj, paramGroup)</a></li>
<li><a href="#_sub9" class="code">function obj = addParameter(obj, varargin)</a></li>
<li><a href="#_sub10" class="code">function obj = removeParameter(obj, row)</a></li>
<li><a href="#_sub11" class="code">function obj = setParameter(obj, row, varargin)</a></li>
<li><a href="#_sub12" class="code">function obj = setParameterValue(obj, row, value)</a></li>
<li><a href="#_sub13" class="code">function obj = setParameterLimits(obj, row, min, max)</a></li>
<li><a href="#_sub14" class="code">function obj = setParameterName(obj, row, name)</a></li>
<li><a href="#_sub15" class="code">function obj = setParameterFit(obj, row, fitFlag)</a></li>
<li><a href="#_sub16" class="code">function obj = setParameterPrior(obj, row, varargin)</a></li>
<li><a href="#_sub17" class="code">function obj = addLayerGroup(obj, layerGroup)</a></li>
<li><a href="#_sub18" class="code">function obj = addLayer(obj, varargin)</a></li>
<li><a href="#_sub19" class="code">function obj = removeLayer(obj, layer)</a></li>
<li><a href="#_sub20" class="code">function obj = setLayerValue(obj, row, col, value)</a></li>
<li><a href="#_sub21" class="code">function obj = addBackgroundParam(obj, varargin)</a></li>
<li><a href="#_sub22" class="code">function obj = removeBackgroundParam(obj, varargin)</a></li>
<li><a href="#_sub23" class="code">function obj = setBackgroundParam(obj, varargin)</a></li>
<li><a href="#_sub24" class="code">function obj = setBackgroundParamValue(obj, row, value)</a></li>
<li><a href="#_sub25" class="code">function obj = setBackgroundParamLimits(obj, row, min, max)</a></li>
<li><a href="#_sub26" class="code">function obj = setBackgroundParamName(obj, row, name)</a></li>
<li><a href="#_sub27" class="code">function obj = addBackground(obj, varargin)</a></li>
<li><a href="#_sub28" class="code">function obj = removeBackground(obj, row)</a></li>
<li><a href="#_sub29" class="code">function obj = setBackground(obj, row, varargin)</a></li>
<li><a href="#_sub30" class="code">function obj = setBackgroundName(obj, row, name)</a></li>
<li><a href="#_sub31" class="code">function obj = addResolutionParam(obj, varargin)</a></li>
<li><a href="#_sub32" class="code">function obj = removeResolutionParam(obj, varargin)</a></li>
<li><a href="#_sub33" class="code">function obj = setResolutionParam(obj, varargin)</a></li>
<li><a href="#_sub34" class="code">function obj = setResolutionParamValue(obj, row, value)</a></li>
<li><a href="#_sub35" class="code">function obj = setResolutionParamLimits(obj, row, min, max)</a></li>
<li><a href="#_sub36" class="code">function obj = setResolutionParamName(obj, row, name)</a></li>
<li><a href="#_sub37" class="code">function obj = addResolution(obj, varargin)</a></li>
<li><a href="#_sub38" class="code">function obj = removeResolution(obj, row)</a></li>
<li><a href="#_sub39" class="code">function obj = setResolution(obj, row, varargin)</a></li>
<li><a href="#_sub40" class="code">function obj = setResolutionName(obj, row, name)</a></li>
<li><a href="#_sub41" class="code">function obj = addData(obj, varargin)</a></li>
<li><a href="#_sub42" class="code">function obj = removeData(obj, row)</a></li>
<li><a href="#_sub43" class="code">function obj = setData(obj, varargin)</a></li>
<li><a href="#_sub44" class="code">function obj = addBulkOut(obj, varargin)</a></li>
<li><a href="#_sub45" class="code">function obj = removeBulkOut(obj, varargin)</a></li>
<li><a href="#_sub46" class="code">function obj = setBulkOut(obj, varargin)</a></li>
<li><a href="#_sub47" class="code">function obj = addBulkIn(obj, varargin)</a></li>
<li><a href="#_sub48" class="code">function obj = removeBulkIn(obj, varargin)</a></li>
<li><a href="#_sub49" class="code">function obj = setBulkIn(obj, varargin)</a></li>
<li><a href="#_sub50" class="code">function obj = addScalefactor(obj, varargin)</a></li>
<li><a href="#_sub51" class="code">function obj = removeScalefactor(obj, varargin)</a></li>
<li><a href="#_sub52" class="code">function obj = setScalefactor(obj, varargin)</a></li>
<li><a href="#_sub53" class="code">function obj = addCustomFile(obj, varargin)</a></li>
<li><a href="#_sub54" class="code">function obj = removeCustomFile(obj, row)</a></li>
<li><a href="#_sub55" class="code">function obj = setCustomFile(obj, row, varargin)</a></li>
<li><a href="#_sub56" class="code">function obj = addContrast(obj, varargin)</a></li>
<li><a href="#_sub57" class="code">function obj = removeContrast(obj, row)</a></li>
<li><a href="#_sub58" class="code">function obj = setContrast(obj, row, varargin)</a></li>
<li><a href="#_sub59" class="code">function obj = setContrastModel(obj, row, model)</a></li>
<li><a href="#_sub60" class="code">function outStruct = toStruct(obj)</a></li>
<li><a href="#_sub61" class="code">function writeScript(obj, options)</a></li>
<li><a href="#_sub62" class="code">function group = getPropertyGroup1(obj)</a></li>
<li><a href="#_sub63" class="code">function displayScalarObject(obj)</a></li>
<li><a href="#_sub64" class="code">function modifyLayersTable(obj,~,~)</a></li>
<li><a href="#_sub65" class="code">function domainsObj = domainsClass(obj)</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="projectClass.html" class="code" title="">projectClass</a> &lt; handle &amp; matlab.mixin.CustomDisplay
0002     
0003     <span class="comment">% Class definition for Standard Layers with or without absorption.</span>
0004     <span class="comment">% Layers defined in terms of thickness, roughness, real SLD and</span>
0005     <span class="comment">% hydration.</span>
0006     <span class="comment">%</span>
0007     <span class="comment">% Sub objects used are:</span>
0008     <span class="comment">% parametersClass      - parameter definition with priors</span>
0009     <span class="comment">% layersClass          - layers defined as (d,rho_real,rough,hydration)</span>
0010     <span class="comment">% backgroundsClass     -</span>
0011     <span class="comment">% resolutionsClass     -</span>
0012     <span class="comment">% dataClass            -</span>
0013     <span class="comment">% contrastsClass       -</span>
0014     <span class="comment">% customFileClass      -</span>
0015     
0016     properties
0017         experimentName
0018         geometry
0019         parameters          <span class="comment">% parametersClass object</span>
0020         layers              <span class="comment">% layersClass object</span>
0021         bulkIn              <span class="comment">% parametersClass object</span>
0022         bulkOut             <span class="comment">% parametersClass object</span>
0023         background          <span class="comment">% backgroundsClass object</span>
0024         scalefactors        <span class="comment">% parametersClass object</span>
0025         resolution          <span class="comment">% resolutionClass object</span>
0026         contrasts           <span class="comment">% contrastsClass object</span>
0027         data                <span class="comment">% dataClass object</span>
0028         customFile          <span class="comment">% Custom file object</span>
0029 
0030         modelType = modelTypes.StandardLayers.value
0031         usePriors = false
0032     <span class="keyword">end</span>
0033 
0034     properties (SetObservable, AbortSet)
0035         absorption {mustBeA(absorption,<span class="string">'logical'</span>)} = false
0036     <span class="keyword">end</span>
0037 
0038     properties (SetAccess = immutable)
0039         calculationType
0040         protectedParameters
0041     <span class="keyword">end</span>
0042 
0043     properties (SetAccess = immutable, Hidden)
0044         qzshifts = <a href="parametersClass.html" class="code" title="">parametersClass</a>(<span class="string">'Qz shift 1'</span>,-1e-4,0,1e-4,false,priorTypes.Uniform,0,Inf)
0045     <span class="keyword">end</span>
0046 
0047     properties(Access = protected, Constant, Hidden)
0048         classes = struct(name = [&quot;parameters&quot;, &quot;bulkIn&quot;, &quot;bulkOut&quot;, &quot;scalefactors&quot;, &quot;backgroundParams&quot;, &quot;resolutionParams&quot;, &quot;domainRatio&quot;, &quot;layers&quot;, &quot;customFile&quot;, &quot;backgrounds&quot;, &quot;resolutions&quot;, &quot;data&quot;, &quot;contrast&quot;], <span class="keyword">...</span>
0049                          addRoutine = [&quot;<a href="#_sub9" class="code" title="subfunction obj = addParameter(obj, varargin)">addParameter</a>&quot;, &quot;<a href="#_sub47" class="code" title="subfunction obj = addBulkIn(obj, varargin)">addBulkIn</a>&quot;, &quot;<a href="#_sub44" class="code" title="subfunction obj = addBulkOut(obj, varargin)">addBulkOut</a>&quot;, &quot;<a href="#_sub50" class="code" title="subfunction obj = addScalefactor(obj, varargin)">addScalefactor</a>&quot;, &quot;<a href="#_sub21" class="code" title="subfunction obj = addBackgroundParam(obj, varargin)">addBackgroundParam</a>&quot;, &quot;<a href="#_sub31" class="code" title="subfunction obj = addResolutionParam(obj, varargin)">addResolutionParam</a>&quot;, &quot;addDomainRatio&quot;, &quot;<a href="#_sub18" class="code" title="subfunction obj = addLayer(obj, varargin)">addLayer</a>&quot;, &quot;<a href="#_sub53" class="code" title="subfunction obj = addCustomFile(obj, varargin)">addCustomFile</a>&quot;, &quot;<a href="#_sub27" class="code" title="subfunction obj = addBackground(obj, varargin)">addBackground</a>&quot;, &quot;<a href="#_sub37" class="code" title="subfunction obj = addResolution(obj, varargin)">addResolution</a>&quot;, &quot;<a href="#_sub41" class="code" title="subfunction obj = addData(obj, varargin)">addData</a>&quot;, &quot;<a href="#_sub56" class="code" title="subfunction obj = addContrast(obj, varargin)">addContrast</a>&quot;], <span class="keyword">...</span>
0050                          removeRoutine = [&quot;<a href="#_sub10" class="code" title="subfunction obj = removeParameter(obj, row)">removeParameter</a>&quot;, &quot;<a href="#_sub48" class="code" title="subfunction obj = removeBulkIn(obj, varargin)">removeBulkIn</a>&quot;, &quot;<a href="#_sub45" class="code" title="subfunction obj = removeBulkOut(obj, varargin)">removeBulkOut</a>&quot;, &quot;<a href="#_sub51" class="code" title="subfunction obj = removeScalefactor(obj, varargin)">removeScalefactor</a>&quot;, &quot;<a href="#_sub22" class="code" title="subfunction obj = removeBackgroundParam(obj, varargin)">removeBackgroundParam</a>&quot;, &quot;<a href="#_sub32" class="code" title="subfunction obj = removeResolutionParam(obj, varargin)">removeResolutionParam</a>&quot;, &quot;removeDomainRatio&quot;, &quot;<a href="#_sub19" class="code" title="subfunction obj = removeLayer(obj, layer)">removeLayer</a>&quot;, &quot;<a href="#_sub54" class="code" title="subfunction obj = removeCustomFile(obj, row)">removeCustomFile</a>&quot;, &quot;<a href="#_sub28" class="code" title="subfunction obj = removeBackground(obj, row)">removeBackground</a>&quot;, &quot;<a href="#_sub38" class="code" title="subfunction obj = removeResolution(obj, row)">removeResolution</a>&quot;, &quot;<a href="#_sub42" class="code" title="subfunction obj = removeData(obj, row)">removeData</a>&quot;, &quot;<a href="#_sub57" class="code" title="subfunction obj = removeContrast(obj, row)">removeContrast</a>&quot;])
0051     <span class="keyword">end</span>
0052 
0053     methods
0054 
0055         <a name="_sub0" href="#_subfunctions" class="code">function obj = projectClass(experimentName, calculationType, modelType, geometry, absorption)</a>
0056             <span class="comment">% Creates a Project object. The input arguments are the</span>
0057             <span class="comment">% experiment name which is a char array; the calculation type,</span>
0058             <span class="comment">% which is a calculationTypes enum; the model type,</span>
0059             <span class="comment">% which is a modelTypes enum; the geometry, which is a</span>
0060             <span class="comment">% geometryOptions enum; and a logical to state whether or not</span>
0061             <span class="comment">% absorption terms are included in the refractive index.</span>
0062             <span class="comment">% All of the arguments are optional.</span>
0063             <span class="comment">%</span>
0064             <span class="comment">% project = projectClass('New experiment');</span>
0065             arguments
0066                 experimentName {mustBeTextScalar} = <span class="string">''</span>
0067                 calculationType = calculationTypes.NonPolarised
0068                 modelType = modelTypes.StandardLayers
0069                 geometry = geometryOptions.AirSubstrate
0070                 absorption {mustBeA(absorption,<span class="string">'logical'</span>)} = false
0071             <span class="keyword">end</span>
0072 
0073             <span class="comment">% Validate input options</span>
0074             invalidTypeMessage = sprintf(<span class="string">'calculationType must be a calculationTypes enum or one of the following strings (%s)'</span>, <span class="keyword">...</span>
0075                                  strjoin(calculationTypes.values(), <span class="string">', '</span>));
0076 
0077             obj.calculationType = validateOption(calculationType, <span class="string">'calculationTypes'</span>, invalidTypeMessage).value;
0078 
0079             invalidModelMessage = sprintf(<span class="string">'modelType must be a modelTypes enum or one of the following strings (%s)'</span>, <span class="keyword">...</span>
0080                                          strjoin(modelTypes.values(), <span class="string">', '</span>));
0081 
0082             obj.modelType = validateOption(modelType, <span class="string">'modelTypes'</span>, invalidModelMessage).value;
0083 
0084             invalidGeometryMessage = sprintf(<span class="string">'geometry must be a geometryOptions enum or one of the following strings (%s)'</span>, <span class="keyword">...</span>
0085                                      strjoin(geometryOptions.values(), <span class="string">', '</span>));
0086 
0087             obj.geometry = validateOption(geometry, <span class="string">'geometryOptions'</span>, invalidGeometryMessage).value;
0088 
0089             obj.experimentName = experimentName;
0090 
0091             <span class="comment">% Initialise the Parameters Table</span>
0092             obj.parameters = <a href="parametersClass.html" class="code" title="">parametersClass</a>(<span class="string">'Substrate Roughness'</span>,1,3,5,true,priorTypes.Uniform,0,Inf);
0093 
0094             <span class="keyword">if</span> isequal(calculationType, calculationTypes.OilWater.value)
0095                 obj.addParameter(<span class="string">'Oil Thickness'</span>);
0096                 obj.addParameter(<span class="string">'Oil Roughness'</span>);
0097             <span class="keyword">end</span>
0098             
0099             obj.protectedParameters = cellstr(obj.parameters.getNames');
0100 
0101             <span class="comment">% Initialise the layers table. Then set the value of</span>
0102             <span class="comment">% absorption, listen for any changes, and modify the layers</span>
0103             <span class="comment">% table accordingly</span>
0104             <span class="keyword">if</span> strcmpi(obj.modelType, modelTypes.StandardLayers.value)
0105                 obj.layers = <a href="layersClass.html" class="code" title="">layersClass</a>();
0106             <span class="keyword">end</span>
0107             addlistener(obj, <span class="string">'absorption'</span>, <span class="string">'PostSet'</span>, @obj.modifyLayersTable);
0108             obj.absorption = absorption;
0109             
0110             <span class="comment">% Initialise bulkIn table</span>
0111             obj.bulkIn = <a href="parametersClass.html" class="code" title="">parametersClass</a>(<span class="string">'SLD Air'</span>,0,0,0,false,priorTypes.Uniform,0,Inf);
0112             
0113             <span class="comment">% Initialise bulkOut table</span>
0114             obj.bulkOut = <a href="parametersClass.html" class="code" title="">parametersClass</a>(<span class="string">'SLD D2O'</span>,6.2e-6,6.35e-6,6.35e-6,false,priorTypes.Uniform,0,Inf);
0115             
0116             <span class="comment">% Initialise scalefactors table</span>
0117             obj.scalefactors = <a href="parametersClass.html" class="code" title="">parametersClass</a>(<span class="string">'Scalefactor 1'</span>,0.02,0.23,0.25,false,priorTypes.Uniform,0,Inf);
0118             
0119             <span class="comment">% Initialise backgrounds object</span>
0120             backgroundParams = <a href="parametersClass.html" class="code" title="">parametersClass</a>(<span class="string">'Background Param 1'</span>,1e-7,1e-6,1e-5,false,priorTypes.Uniform,0,Inf);
0121             backgrounds = {<span class="string">'Background 1'</span>,allowedTypes.Constant.value,<span class="string">'Background Param 1'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>};
0122             obj.background = <a href="backgroundsClass.html" class="code" title="">backgroundsClass</a>(backgroundParams, backgrounds);
0123             
0124             <span class="comment">% Initialise resolution object</span>
0125             resolutionParams = <a href="parametersClass.html" class="code" title="">parametersClass</a>(<span class="string">'Resolution par 1'</span>,0.01,0.03,0.05,false,priorTypes.Uniform,0,Inf);
0126             resolutions = {<span class="string">'Resolution 1'</span>,allowedTypes.Constant.value,<span class="string">'Resolution par 1'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>};
0127             obj.resolution = <a href="resolutionsClass.html" class="code" title="">resolutionsClass</a>(resolutionParams, resolutions);
0128             
0129             <span class="comment">% Initialise data object</span>
0130             obj.data = <a href="dataClass.html" class="code" title="">dataClass</a>(<span class="string">'Simulation'</span>, [], [], []);
0131 
0132             <span class="comment">% Initialise custom file object</span>
0133             obj.customFile = <a href="customFileClass.html" class="code" title="">customFileClass</a>();
0134 
0135             <span class="comment">% Initialise contrasts object</span>
0136             obj.contrasts = <a href="contrastsClass.html" class="code" title="">contrastsClass</a>();               
0137         <span class="keyword">end</span>
0138 
0139         <a name="_sub1" href="#_subfunctions" class="code">function delete(obj)</a>
0140             <span class="comment">% Destroys the wrappers</span>
0141             <a href="#_sub2" class="code" title="subfunction delete(obj)">delete</a>(obj.customFile);
0142         <span class="keyword">end</span>
0143 
0144         <a name="_sub2" href="#_subfunctions" class="code">function domainsObj = toDomainsClass(obj)</a>
0145             <span class="comment">% Alias of the converter routine from projectClass to</span>
0146             <span class="comment">% domainsClass.</span>
0147             <span class="comment">% This routine takes the currently defined project and</span>
0148             <span class="comment">% converts it to a domains calculation, preserving all</span>
0149             <span class="comment">% currently defined properties.</span>
0150             <span class="comment">%</span>
0151             <span class="comment">% domainsProject = project.toDomainsClass();</span>
0152             domainsObj = obj.domainsClass();
0153         <span class="keyword">end</span>
0154 
0155         <a name="_sub3" href="#_subfunctions" class="code">function obj = setUsePriors(obj, showFlag)</a>
0156             <span class="comment">% Sets the use priors flag. The showFlag should be a boolean/logical.</span>
0157             <span class="comment">%</span>
0158             <span class="comment">% project.setUsePriors(true);</span>
0159             <span class="keyword">if</span> ~islogical(showFlag)
0160                 throw(exceptions.invalidType(<span class="string">'usePriors must be logical ''true'' or ''false'''</span>));
0161             <span class="keyword">end</span>
0162             obj.usePriors = showFlag;
0163             
0164             <span class="comment">% Also need to set the flag in sub-objects</span>
0165             <span class="comment">% where relevant..</span>
0166             <span class="comment">% (1) Parameters</span>
0167             <span class="comment">% replace with showFlag</span>
0168             obj.parameters.showPriors = showFlag;
0169             
0170             <span class="comment">% (2) Bulk In</span>
0171             obj.bulkIn.showPriors = showFlag;
0172             
0173             <span class="comment">% (3) Bulk out</span>
0174             obj.bulkOut.showPriors = showFlag;
0175             
0176             <span class="comment">% (4) Scalefactors</span>
0177             obj.scalefactors.showPriors = showFlag;
0178             
0179             <span class="comment">% (5) Backgrounds (parameters table)</span>
0180             obj.background.backgroundParams.showPriors = showFlag;
0181             
0182             <span class="comment">% (6) Resolutions (parameters table)</span>
0183             obj.resolution.resolutionParams.showPriors = showFlag;
0184             
0185         <span class="keyword">end</span>
0186         
0187         <a name="_sub4" href="#_subfunctions" class="code">function obj = setGeometry(obj, geometry)</a>
0188             <span class="comment">% Sets the experiment geometry. The geometry should be a string,</span>
0189             <span class="comment">% either &quot;Air/Substrate&quot; or &quot;Substrate/Liquid&quot; is permitted.</span>
0190             <span class="comment">%</span>
0191             <span class="comment">% project.setGeometry('Substrate/liquid');</span>
0192             invalidTypeMessage = sprintf(<span class="string">'Geometry must be a geometryOptions enum or one of the following strings (%s)'</span>, <span class="keyword">...</span>
0193                                          strjoin(geometryOptions.values(), <span class="string">', '</span>));
0194             obj.geometry = validateOption(geometry, <span class="string">'geometryOptions'</span>, invalidTypeMessage).value;
0195         <span class="keyword">end</span>
0196 
0197         <a name="_sub5" href="#_subfunctions" class="code">function obj = setModelType(obj, modelType)</a>
0198             <span class="comment">% Sets the experiment type. The type should be a string,</span>
0199             <span class="comment">% either &quot;standard layers&quot;, &quot;custom layers&quot;, or &quot;custom xy&quot; is</span>
0200             <span class="comment">% permitted.</span>
0201             <span class="comment">%</span>
0202             <span class="comment">% project.setModelType('Custom Layers');</span>
0203             oldModel = obj.modelType;
0204             invalidTypeMessage = sprintf(<span class="string">'Experiment type must be a modelTypes enum or one of the following strings (%s)'</span>, <span class="keyword">...</span>
0205                                          strjoin(modelTypes.values(), <span class="string">', '</span>));
0206             obj.modelType = validateOption(modelType, <span class="string">'modelTypes'</span>, invalidTypeMessage).value;
0207 
0208             <span class="comment">% Need to adjust layers and contrasts for new model type</span>
0209             <span class="keyword">if</span> ~strcmpi(obj.modelType, oldModel)
0210                 <span class="keyword">for</span> i=1:obj.contrasts.numberOfContrasts
0211                     obj.contrasts.contrasts{i}.model = <span class="string">''</span>;
0212                 <span class="keyword">end</span>
0213             <span class="keyword">end</span>
0214 
0215             <span class="keyword">if</span> strcmpi(obj.modelType, modelTypes.StandardLayers.value)
0216                 <span class="keyword">if</span> ~isa(obj.layers, <span class="string">'layersClass'</span>)
0217                     obj.layers = <a href="layersClass.html" class="code" title="">layersClass</a>();
0218                 <span class="keyword">end</span>
0219             <span class="keyword">else</span>
0220                 obj.layers = [];
0221             <span class="keyword">end</span>
0222         <span class="keyword">end</span>
0223 
0224         <a name="_sub6" href="#_subfunctions" class="code">function names = getAllAllowedNames(obj)     </a>
0225             <span class="comment">% Returns a cell array of all currently</span>
0226             <span class="comment">% set parameter names for the project.</span>
0227             names.paramNames = obj.parameters.getNames();
0228             names.backgroundNames = obj.background.getNames();
0229             names.backgroundParamNames = obj.background.backgroundParams.getNames();
0230             names.bulkInNames = obj.bulkIn.getNames();
0231             names.bulkOutNames = obj.bulkOut.getNames();
0232             names.resolutionNames = obj.resolution.getNames();
0233             names.resolutionParamNames = obj.resolution.resolutionParams.getNames();
0234             names.dataNames = obj.data.getNames();
0235             names.scalefactorNames = obj.scalefactors.getNames();
0236             names.qzShiftNames = obj.qzshifts.getNames();
0237             names.customFileNames = obj.customFile.getNames();
0238             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
0239                 names.layerNames = obj.layers.getNames();
0240             <span class="keyword">end</span>
0241         <span class="keyword">end</span>
0242         
0243         <span class="comment">% ---------------------------------</span>
0244         <span class="comment">% Editing Parameters Block</span>
0245         
0246         <a name="_sub7" href="#_subfunctions" class="code">function obj = addParameterGroup(obj, paramGroup)</a>
0247             <span class="comment">% Adds a group of parameters to the parameters object.</span>
0248             <span class="comment">% Expects a cell array of parameter cell arrays.</span>
0249             <span class="comment">%</span>
0250             <span class="comment">% project.addParameterGroup({{'Tails Thickness'}, {'Heads Thickness'}});</span>
0251             <span class="keyword">for</span> i = 1:length(paramGroup)
0252                 <span class="keyword">if</span> iscell(paramGroup{i})
0253                     obj = <a href="#_sub9" class="code" title="subfunction obj = addParameter(obj, varargin)">addParameter</a>(obj, paramGroup{i});
0254                 <span class="keyword">else</span>
0255                     throw(exceptions.invalidType(<span class="string">'Expecting a cell array of parameters in ''addParameterGroup'''</span>));
0256                 <span class="keyword">end</span>
0257             <span class="keyword">end</span>
0258         <span class="keyword">end</span>
0259         
0260         
0261         <a name="_sub8" href="#_subfunctions" class="code">function obj = addParameter(obj, varargin)</a>
0262             <span class="comment">% Adds an individual parameter to the parameters object.</span>
0263             <span class="comment">% Check how many parameters we are adding and make sure all</span>
0264             <span class="comment">% the inputs are cells. A parameter consists of a name, min,</span>
0265             <span class="comment">% value, max, fit flag, prior type', mu, and sigma. The input</span>
0266             <span class="comment">% is optional but if provided should contain 1, 2, 4, 5, or 8</span>
0267             <span class="comment">% values of the parameter to added.</span>
0268             <span class="comment">%</span>
0269             <span class="comment">% project.addParameter('Tails Roughness');</span>
0270             <span class="keyword">if</span> isempty(varargin)
0271                 obj.parameters.addParameter();
0272             <span class="keyword">else</span>
0273                 <span class="keyword">if</span> length(varargin) == 1 &amp;&amp; iscell(varargin{:})
0274                     params = varargin{:};
0275                 <span class="keyword">else</span>
0276                     params = varargin;
0277                 <span class="keyword">end</span>
0278                 obj.parameters.addParameter(params{:});
0279             <span class="keyword">end</span> 
0280         <span class="keyword">end</span>
0281                 
0282         <a name="_sub9" href="#_subfunctions" class="code">function obj = removeParameter(obj, row)</a>
0283             <span class="comment">% Removes a parameter from the parameters object. The</span>
0284             <span class="comment">% parameter will also be removed from the layers array</span>
0285             <span class="comment">% if it is in use. Expects series of indices or names of</span>
0286             <span class="comment">% parameters to remove</span>
0287             <span class="comment">%</span>
0288             <span class="comment">% project.removeParameter(2);</span>
0289             <span class="keyword">if</span> isa(row, <span class="string">'double'</span>)
0290                 row = num2cell(sort(row, <span class="string">'descend'</span>));
0291             <span class="keyword">elseif</span> isText(row)
0292                 row = cellstr(row);
0293             <span class="keyword">elseif</span> iscell(row)
0294             <span class="keyword">else</span>
0295                 throw(exceptions.invalidType(<span class="string">'Unrecognised Row'</span>))
0296             <span class="keyword">end</span>
0297 
0298             <span class="keyword">for</span> i = 1:length(row)
0299                 thisParam = row{i};
0300                 
0301                 <span class="comment">% Make sure we don't remove any protected parameters</span>
0302                 <span class="keyword">if</span> (isnumeric(thisParam) &amp;&amp; thisParam &lt;= length(obj.protectedParameters)) || any((strcmpi(thisParam, obj.protectedParameters)))
0303                     throw(exceptions.invalidOption(sprintf(<span class="string">'Can''t remove protected parameters'</span>)));
0304                 <span class="keyword">end</span>
0305                 
0306                 <span class="comment">% No need to check validity of the parameter</span>
0307                 <span class="comment">% as this is done in the parameters class</span>
0308                 obj.parameters.removeParameter(thisParam);
0309                 
0310                 <span class="comment">% Need to check if it is used in the layers</span>
0311                 <span class="comment">% array and remove it if so. Should be able</span>
0312                 <span class="comment">% to do this with array indexing, but can't quite figure</span>
0313                 <span class="comment">% that out atm, so just use a (dirty) loop over all</span>
0314                 <span class="comment">% the elements for now..</span>
0315                 <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
0316                     findParam = string(thisParam);
0317                     laysTable = obj.layers.varTable;
0318                     dims = size(laysTable);
0319                     <span class="keyword">for</span> m = 1:dims(1)
0320                         <span class="keyword">for</span> n = 1:dims(2)
0321                             tablePar = laysTable{m,n};   <span class="comment">% Should be a string</span>
0322                             <span class="keyword">if</span> isequal(findParam, tablePar)
0323                                 obj.layers.varTable(m,n) = {<span class="string">''</span>};
0324                             <span class="keyword">end</span>
0325                         <span class="keyword">end</span>
0326                     <span class="keyword">end</span>
0327                 <span class="keyword">end</span>
0328             <span class="keyword">end</span>
0329             
0330         <span class="keyword">end</span>
0331         
0332         <a name="_sub10" href="#_subfunctions" class="code">function obj = setParameter(obj, row, varargin)</a>
0333             <span class="comment">% General purpose set parameter method. Expects</span>
0334             <span class="comment">% index or name of parameter and keyword/value pairs to set</span>
0335             <span class="comment">%</span>
0336             <span class="comment">% project.setParameter(2, 'value', 50);</span>
0337             obj.parameters.setParameter(row, varargin{:});
0338         <span class="keyword">end</span>
0339         
0340         
0341         <a name="_sub11" href="#_subfunctions" class="code">function obj = setParameterValue(obj, row, value)</a>
0342             <span class="comment">% Sets the value of a given parameter. Expects</span>
0343             <span class="comment">% index or name of parameter and new value to set</span>
0344             <span class="comment">%</span>
0345             <span class="comment">% project.setParameterValue(2, 50);</span>
0346             obj.parameters.setValue(row, value);
0347         <span class="keyword">end</span>
0348         
0349         <a name="_sub12" href="#_subfunctions" class="code">function obj = setParameterLimits(obj, row, min, max)</a>
0350             <span class="comment">% Sets the limits of an existing parameter.</span>
0351             <span class="comment">% Expects index or name of parameter and new min</span>
0352             <span class="comment">% and max of the parameter's value</span>
0353             <span class="comment">%</span>
0354             <span class="comment">% project.setParameterLimits(2, 0, 100);</span>
0355             obj.parameters.setLimits(row, min, max);
0356         <span class="keyword">end</span>
0357         
0358         <a name="_sub13" href="#_subfunctions" class="code">function obj = setParameterName(obj, row, name)</a>
0359             <span class="comment">% Sets the name of an existing parameter</span>
0360             <span class="comment">% Expects index or name of parameter and the</span>
0361             <span class="comment">% new name</span>
0362             <span class="comment">%</span>
0363             <span class="comment">% project.setParameterName(2, 'new name');</span>
0364             <span class="keyword">if</span> (isnumeric(row) &amp;&amp; row &lt;= length(obj.protectedParameters)) || any((strcmpi(row, obj.protectedParameters)))
0365                 throw(exceptions.invalidOption(<span class="string">'Can''t rename protected parameters'</span>));
0366             <span class="keyword">end</span>
0367             obj.parameters.setName(row, name);
0368         <span class="keyword">end</span>
0369         
0370         <a name="_sub14" href="#_subfunctions" class="code">function obj = setParameterFit(obj, row, fitFlag)</a>
0371             <span class="comment">% Sets the 'fit' to off or on for parameter.</span>
0372             <span class="comment">% Expects index or name of parameter and</span>
0373             <span class="comment">% new fit flag</span>
0374             <span class="comment">%</span>
0375             <span class="comment">% project.setParameterFit(2, true);</span>
0376             obj.parameters.setFit(row, fitFlag);
0377         <span class="keyword">end</span>
0378         
0379         <a name="_sub15" href="#_subfunctions" class="code">function obj = setParameterPrior(obj, row, varargin)</a>
0380             <span class="comment">% Sets the prior type of the parameter.</span>
0381             <span class="comment">% Expects index or name of parameter and</span>
0382             <span class="comment">% new prior type('uniform','gaussian','jeffreys')</span>
0383             <span class="comment">%</span>
0384             <span class="comment">% project.setParameterPrior(2, 'uniform');</span>
0385             obj.parameters.setPrior(row, varargin{:});  
0386         <span class="keyword">end</span>
0387         
0388         <span class="comment">% -----------------------------------------------------</span>
0389         
0390         <span class="comment">% Editing of layers block</span>
0391         <a name="_sub16" href="#_subfunctions" class="code">function obj = addLayerGroup(obj, layerGroup)</a>
0392             <span class="comment">% Adds a group of layers to the layers object. Expects</span>
0393             <span class="comment">% a cell array of layer cell arrays</span>
0394             <span class="comment">%</span>
0395             <span class="comment">% project.addLayerGroup({{'Layer 1'}, {'Layer 2'}});</span>
0396             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
0397                 <span class="keyword">for</span> i = 1:length(layerGroup)
0398                     <span class="keyword">if</span> iscell(layerGroup{i})
0399                         obj = <a href="#_sub18" class="code" title="subfunction obj = addLayer(obj, varargin)">addLayer</a>(obj, layerGroup{i});
0400                     <span class="keyword">else</span>
0401                         throw(exceptions.invalidType(<span class="string">'Expecting a cell array of parameters in ''addLayerGroup'''</span>));
0402                     <span class="keyword">end</span>
0403                 <span class="keyword">end</span>
0404             <span class="keyword">else</span>
0405                 throw(exceptions.invalidProperty(sprintf(<span class="string">'Layer are not defined for the model type: %s'</span>, obj.modelType)));
0406             <span class="keyword">end</span>
0407         <span class="keyword">end</span>
0408         
0409         <a name="_sub17" href="#_subfunctions" class="code">function obj = addLayer(obj, varargin)</a>
0410             <span class="comment">% Adds a single layer to the layers object. Expects layer</span>
0411             <span class="comment">% details which are name, thickness, SLD, roughness,</span>
0412             <span class="comment">% hydration, and hydrate with, or provide with no details,</span>
0413             <span class="comment">% or just a name, to create an empty layer.</span>
0414             <span class="comment">%</span>
0415             <span class="comment">% project.addLayer('New Layer');</span>
0416             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
0417                 <span class="comment">% If the input is wrapped in a cell (so varargin is a cell of a cell)</span>
0418                 <span class="comment">% need to unwrap one layer of it, otherwise keep varargin as it is</span>
0419                 <span class="keyword">if</span> length(varargin) == 1 &amp;&amp; iscell(varargin{:})
0420                     thisLayer = varargin{:};
0421                 <span class="keyword">else</span>
0422                     thisLayer = varargin;
0423                 <span class="keyword">end</span>
0424                 obj.layers.addLayer(obj.parameters.varTable{:,1}, thisLayer{:});
0425             <span class="keyword">else</span>
0426                 throw(exceptions.invalidProperty(sprintf(<span class="string">'Layer are not defined for the model type: %s'</span>, obj.modelType)));
0427             <span class="keyword">end</span>
0428         <span class="keyword">end</span>
0429 
0430         <a name="_sub18" href="#_subfunctions" class="code">function obj = removeLayer(obj, layer)</a>
0431             <span class="comment">% Removes layer(s) from the layers object. Expects</span>
0432             <span class="comment">% index of layer(s) to remove.</span>
0433             <span class="comment">%</span>
0434             <span class="comment">% project.removeLayer(1);</span>
0435             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
0436                 obj.layers.removeRow(layer);
0437             <span class="keyword">else</span>
0438                 throw(exceptions.invalidProperty(sprintf(<span class="string">'Layer are not defined for the model type: %s'</span>, obj.modelType)));
0439             <span class="keyword">end</span>
0440         <span class="keyword">end</span>
0441 
0442         <a name="_sub19" href="#_subfunctions" class="code">function obj = setLayerValue(obj, row, col, value)</a>
0443             <span class="comment">% Sets a value of a given layer. Expects the row/name and</span>
0444             <span class="comment">% column of layer value to set, then the name/index of the</span>
0445             <span class="comment">% parameter to set the value to.</span>
0446             <span class="comment">%</span>
0447             <span class="comment">% project.setLayerValue(1, 2, 'Tails Thickness');</span>
0448             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
0449                 obj.layers.setLayerValue(row, col, value, obj.parameters.varTable{:,1});
0450             <span class="keyword">else</span>
0451                 throw(exceptions.invalidProperty(sprintf(<span class="string">'Layer are not defined for the model type: %s'</span>, obj.modelType)));
0452             <span class="keyword">end</span>
0453         <span class="keyword">end</span>
0454         
0455         <span class="comment">% ---------------------------------------------------------------</span>
0456         
0457         <span class="comment">% Editing of Backgrounds block</span>
0458         
0459         
0460         <span class="comment">%(1) Background Parameters</span>
0461         <a name="_sub20" href="#_subfunctions" class="code">function obj = addBackgroundParam(obj, varargin)</a>
0462             <span class="comment">% Adds a new background parameter. A parameter consists</span>
0463             <span class="comment">% of a name, min, value, max, fit flag, prior type', mu,</span>
0464             <span class="comment">% and sigma</span>
0465             <span class="comment">%</span>
0466             <span class="comment">% project.addBackgroundParam('Backs Value D2O', 1e-8, 2.8e-6, 1e-5);</span>
0467             obj.background.backgroundParams.addParameter(varargin{:});
0468         <span class="keyword">end</span>
0469 
0470         <a name="_sub21" href="#_subfunctions" class="code">function obj = removeBackgroundParam(obj, varargin)</a>
0471             <span class="comment">% Removes a given background parameter.</span>
0472             <span class="comment">% Expects index or name of parameter to remove</span>
0473             <span class="comment">%</span>
0474             <span class="comment">% project.removeBackgroundParam(2);</span>
0475             obj.background.backgroundParams.removeParameter(varargin{:});
0476         <span class="keyword">end</span>
0477 
0478         <a name="_sub22" href="#_subfunctions" class="code">function obj = setBackgroundParam(obj, varargin)</a>
0479             <span class="comment">% Sets the value of an existing background parameter. Expects</span>
0480             <span class="comment">% index or name of parameter and keyword/value pairs to set</span>
0481             <span class="comment">%</span>
0482             <span class="comment">% project.setBackgroundParam(1, 'name', 'Backs Value H2O');</span>
0483             obj.background.backgroundParams.setParameter(varargin{:});
0484         <span class="keyword">end</span>
0485 
0486         <a name="_sub23" href="#_subfunctions" class="code">function obj = setBackgroundParamValue(obj, row, value)</a>
0487             <span class="comment">% Sets the value of existing background</span>
0488             <span class="comment">% parameter. Expects index or name of parameter</span>
0489             <span class="comment">% and new value to set</span>
0490             <span class="comment">%</span>
0491             <span class="comment">% project.setBackgroundParamValue(1, 5.5e-6);</span>
0492             obj.background.backgroundParams.setValue(row, value);
0493         <span class="keyword">end</span>
0494         
0495         <a name="_sub24" href="#_subfunctions" class="code">function obj = setBackgroundParamLimits(obj, row, min, max)</a>
0496             <span class="comment">% Sets the constraints of existing background</span>
0497             <span class="comment">% parameter. Expects index or name of parameter</span>
0498             <span class="comment">% and new min and max of the parameter's value</span>
0499             <span class="comment">%</span>
0500             <span class="comment">% project.setBackgroundParamLimits(1, 0, 1);</span>
0501             obj.background.backgroundParams.setLimits(row, min, max);
0502         <span class="keyword">end</span>
0503         
0504         <a name="_sub25" href="#_subfunctions" class="code">function obj = setBackgroundParamName(obj, row, name)</a>
0505             <span class="comment">% Sets the name of an existing background</span>
0506             <span class="comment">% parameter. Expects index or name of parameter</span>
0507             <span class="comment">% and the new name</span>
0508             <span class="comment">%</span>
0509             <span class="comment">% project.setBackgroundParamName(2, 'new name');</span>
0510             obj.background.backgroundParams.setName(row, name);
0511         <span class="keyword">end</span>
0512         
0513         <span class="comment">% (2) Backgrounds</span>
0514         <a name="_sub26" href="#_subfunctions" class="code">function obj = addBackground(obj, varargin)</a>
0515             <span class="comment">% Adds a background to the project. Expects a</span>
0516             <span class="comment">% cell array with background name and type and</span>
0517             <span class="comment">% up to 4 parameters</span>
0518             <span class="comment">%</span>
0519             <span class="comment">% project.addBackground('name', 'constant', 'par');</span>
0520             obj.background.addBackground(varargin{:});
0521         <span class="keyword">end</span>
0522         
0523         <a name="_sub27" href="#_subfunctions" class="code">function obj = removeBackground(obj, row)</a>
0524             <span class="comment">% Removes background from the project. Expects</span>
0525             <span class="comment">% index or array of indices of background(s) of background(s)</span>
0526             <span class="comment">% to remove</span>
0527             <span class="comment">%</span>
0528             <span class="comment">% project.removeBackground(1);</span>
0529             obj.background.removeBackground(row);
0530         <span class="keyword">end</span>
0531         
0532         <a name="_sub28" href="#_subfunctions" class="code">function obj = setBackground(obj, row, varargin)</a>
0533             <span class="comment">% Sets the value of an existing background. Expects</span>
0534             <span class="comment">% index or name of background and keyword/value pairs to set</span>
0535             <span class="comment">%</span>
0536             <span class="comment">% project.setBackground(1, 'name', 'Background ACMW');</span>
0537             obj.background.setBackground(row, varargin{:});
0538         <span class="keyword">end</span>
0539         
0540         <a name="_sub29" href="#_subfunctions" class="code">function obj = setBackgroundName(obj, row, name)</a>
0541             <span class="comment">% Sets the name of an existing Background.</span>
0542             <span class="comment">% Expects index or name of background and the new name</span>
0543             <span class="comment">%</span>
0544             <span class="comment">% project.setBackgroundName(2, 'new name');</span>
0545             obj.background.setBackgroundName(row, name);
0546         <span class="keyword">end</span>
0547         
0548         <span class="comment">% -------------------------------------------------------------</span>
0549         <span class="comment">%   Editing of Resolutions block</span>
0550         
0551         <span class="comment">% Resol Pars</span>
0552         <a name="_sub30" href="#_subfunctions" class="code">function obj = addResolutionParam(obj, varargin)</a>
0553             <span class="comment">% Adds a new resolution parameter. A parameter consists</span>
0554             <span class="comment">% of a name, min, value, max, fit flag, prior type', mu,</span>
0555             <span class="comment">% and sigma</span>
0556             <span class="comment">%</span>
0557             <span class="comment">% project.addResolutionParam('Resolution Param 1', 1e-8, 2.8e-6, 1e-5);</span>
0558             obj.resolution.resolutionParams.addParameter(varargin{:});
0559         <span class="keyword">end</span>
0560         
0561         <a name="_sub31" href="#_subfunctions" class="code">function obj = removeResolutionParam(obj, varargin)</a>
0562             <span class="comment">% Removes a given resolution parameter.</span>
0563             <span class="comment">% Expects index or name of parameter to remove</span>
0564             <span class="comment">%</span>
0565             <span class="comment">% project.removeResolutionParam(2);</span>
0566             obj.resolution.resolutionParams.removeParameter(varargin{:});
0567         <span class="keyword">end</span>
0568 
0569         <a name="_sub32" href="#_subfunctions" class="code">function obj = setResolutionParam(obj, varargin)</a>
0570             <span class="comment">% Sets the value of an existing resolution parameter. Expects</span>
0571             <span class="comment">% index or name of parameter and keyword/value pairs to set</span>
0572             <span class="comment">%</span>
0573             <span class="comment">% project.setResolutionParam(1, 'name', 'Resolution Param');</span>
0574             obj.resolution.resolutionParams.setParameter(varargin{:});
0575         <span class="keyword">end</span>
0576 
0577         <a name="_sub33" href="#_subfunctions" class="code">function obj = setResolutionParamValue(obj, row, value)</a>
0578             <span class="comment">% Sets the value of existing resolution</span>
0579             <span class="comment">% parameter. Expects index or name of parameter</span>
0580             <span class="comment">% and new value to set</span>
0581             <span class="comment">%</span>
0582             <span class="comment">% project.setResolutionParamValue(1, 5.5e-6);</span>
0583             obj.resolution.resolutionParams.setValue(row, value);
0584         <span class="keyword">end</span>
0585 
0586         <a name="_sub34" href="#_subfunctions" class="code">function obj = setResolutionParamLimits(obj, row, min, max)</a>
0587             <span class="comment">% Sets the constraints of existing resolution</span>
0588             <span class="comment">% parameter. Expects index or name of parameter</span>
0589             <span class="comment">% and new min and max of the parameter's value</span>
0590             <span class="comment">%</span>
0591             <span class="comment">% project.setResolutionParamLimits(1, 0, 1);</span>
0592             obj.resolution.resolutionParams.setLimits(row, min, max);
0593         <span class="keyword">end</span>
0594         
0595         <a name="_sub35" href="#_subfunctions" class="code">function obj = setResolutionParamName(obj, row, name)</a>
0596             <span class="comment">% Sets the name of an existing resolution</span>
0597             <span class="comment">% parameter. Expects index or name of parameter</span>
0598             <span class="comment">% and the new name</span>
0599             <span class="comment">%</span>
0600             <span class="comment">% project.setResolutionParamName(2, 'new name');</span>
0601             obj.resolution.resolutionParams.setName(row, name);
0602         <span class="keyword">end</span>
0603 
0604         <span class="comment">% Resolutions</span>
0605         <a name="_sub36" href="#_subfunctions" class="code">function obj = addResolution(obj, varargin)</a>
0606             <span class="comment">% Adds a resolution to the project. Expects a</span>
0607             <span class="comment">% cell array with resolution name and type and</span>
0608             <span class="comment">% up to 4 parameters</span>
0609             <span class="comment">%</span>
0610             <span class="comment">% project.addResolution('name','constant','par');</span>
0611             obj.resolution.addResolution(varargin{:});
0612         <span class="keyword">end</span>
0613         
0614         <a name="_sub37" href="#_subfunctions" class="code">function obj = removeResolution(obj, row)</a>
0615             <span class="comment">% Removes resolution from the project. Expects</span>
0616             <span class="comment">% index of resolution to remove</span>
0617             <span class="comment">%</span>
0618             <span class="comment">% project.removeResolution(1);</span>
0619             obj.resolution.removeResolution(row);
0620         <span class="keyword">end</span>
0621         
0622         <a name="_sub38" href="#_subfunctions" class="code">function obj = setResolution(obj, row, varargin)</a>
0623             <span class="comment">% Sets the value of an existing resolution. Expects</span>
0624             <span class="comment">% index or name of resolution and keyword/value pairs to set</span>
0625             <span class="comment">%</span>
0626             <span class="comment">% project.setResolution(1, 'name', 'Resolution ACMW');</span>
0627             obj.resolution.setResolution(row, varargin{:});
0628         <span class="keyword">end</span>
0629         
0630         <a name="_sub39" href="#_subfunctions" class="code">function obj = setResolutionName(obj, row, name)</a>
0631             <span class="comment">% Sets the name of an existing resolution.</span>
0632             <span class="comment">% Expects index or name of resolution and the new name</span>
0633             <span class="comment">%</span>
0634             <span class="comment">% project.setResolutionName(2, 'new name');</span>
0635             obj.resolution.setResolutionName(row, name);
0636         <span class="keyword">end</span>
0637         
0638         <span class="comment">% ------------------------------------------------------------</span>
0639         <span class="comment">%   Editing of Data block</span>
0640         
0641         <a name="_sub40" href="#_subfunctions" class="code">function obj = addData(obj, varargin)</a>
0642             <span class="comment">% Adds a new data parameter. Expects the name</span>
0643             <span class="comment">% of data and the data array</span>
0644             <span class="comment">%</span>
0645             <span class="comment">% project.addData('Sim 2', data);</span>
0646             obj.data.addData(varargin{:});
0647         <span class="keyword">end</span>
0648         
0649         <a name="_sub41" href="#_subfunctions" class="code">function obj = removeData(obj, row)</a>
0650             <span class="comment">% Removes a dataset. Expects the index or array of</span>
0651             <span class="comment">% indices of dataset(s) to remove.</span>
0652             <span class="comment">%</span>
0653             <span class="comment">% project.removeData(2);</span>
0654             obj.data.removeRow(row);
0655         <span class="keyword">end</span>
0656         
0657         <a name="_sub42" href="#_subfunctions" class="code">function obj = setData(obj, varargin)</a>
0658             <span class="comment">% Edits an existing data parameter. Expects the</span>
0659             <span class="comment">% index of data to edit and key-value pairs</span>
0660             <span class="comment">%</span>
0661             <span class="comment">% project.setData(1, 'name', 'Sim 1', 'data', zeros(4, 3));</span>
0662             nameChanged = obj.data.setData(varargin{:});
0663             
0664             <span class="keyword">if</span> ~isempty(nameChanged)
0665                 obj.contrasts.updateDataName(nameChanged);
0666             <span class="keyword">end</span>
0667         <span class="keyword">end</span>
0668         
0669         
0670         <span class="comment">% ---------------------------------------------------------------</span>
0671         <span class="comment">%   Editing of Bulk out block</span>
0672         
0673         <a name="_sub43" href="#_subfunctions" class="code">function obj = addBulkOut(obj, varargin)</a>
0674             <span class="comment">% Adds a new bulk-out parameter. Expects the name</span>
0675             <span class="comment">% of bulk-out, min, value, max, and if fit is off or on</span>
0676             <span class="comment">%</span>
0677             <span class="comment">% project.addBulkOut('SLD ACMW', -1e-6, 0.0, 1e-6, true);</span>
0678             obj.bulkOut.addParameter(varargin{:});
0679         <span class="keyword">end</span>
0680         
0681         <a name="_sub44" href="#_subfunctions" class="code">function obj = removeBulkOut(obj, varargin)</a>
0682             <span class="comment">% Removes specified bulk-out parameter. Expects the name/index</span>
0683             <span class="comment">% of bulk-out to remove</span>
0684             <span class="comment">%</span>
0685             <span class="comment">% project.removeBulkOut(2);</span>
0686             obj.bulkOut.removeParameter(varargin{:});
0687         <span class="keyword">end</span>
0688         
0689         <a name="_sub45" href="#_subfunctions" class="code">function obj = setBulkOut(obj, varargin)</a>
0690             <span class="comment">% Edits an existing bulk-out parameter. Expects the</span>
0691             <span class="comment">% index of bulk-out to edit and key-value pairs</span>
0692             <span class="comment">%</span>
0693             <span class="comment">% project.setBulkOut(1, 'name', 'SLD H2O', 'min', 2.07e-6);</span>
0694             obj.bulkOut.setParameter(varargin{:});
0695         <span class="keyword">end</span>
0696         
0697         
0698         <span class="comment">% ------------------------------------------------------------------</span>
0699         <span class="comment">% Editing of bulk in block</span>
0700         
0701         <a name="_sub46" href="#_subfunctions" class="code">function obj = addBulkIn(obj, varargin)</a>
0702             <span class="comment">% Adds a new bulk-in parameter. Expects the name</span>
0703             <span class="comment">% of bulk-in, min, value, max, and if fit is off or on</span>
0704             <span class="comment">%</span>
0705             <span class="comment">% project.addBulkIn('Silicon', -1e-6, 0.0, 1e-6, true);</span>
0706             obj.bulkIn.addParameter(varargin{:});
0707         <span class="keyword">end</span>
0708         
0709         <a name="_sub47" href="#_subfunctions" class="code">function obj = removeBulkIn(obj, varargin)</a>
0710             <span class="comment">% Removes specified bulk-in parameter. Expects the name/index</span>
0711             <span class="comment">% of bulk-in to remove</span>
0712             <span class="comment">%</span>
0713             <span class="comment">% project.removeBulkIn(2);</span>
0714             obj.bulkIn.removeParameter(varargin{:});
0715         <span class="keyword">end</span>
0716         
0717         <a name="_sub48" href="#_subfunctions" class="code">function obj = setBulkIn(obj, varargin)</a>
0718             <span class="comment">% Edits an existing bulk-in parameter. Expects the</span>
0719             <span class="comment">% index of bulk-in to edit and key-value pairs</span>
0720             <span class="comment">%</span>
0721             <span class="comment">% project.setBulkIn(1, 'name', 'Silicon', 'max', 2.07e-6);</span>
0722             obj.bulkIn.setParameter(varargin{:});
0723         <span class="keyword">end</span>
0724         
0725         <span class="comment">% -------------------------------------------------------------------</span>
0726         <span class="comment">% Editing of scalefactors block</span>
0727         
0728         <a name="_sub49" href="#_subfunctions" class="code">function obj = addScalefactor(obj, varargin)</a>
0729             <span class="comment">% Adds a new scale factor parameter. Expects the name</span>
0730             <span class="comment">% of scale factor, min, value, max, and if fit is off or on</span>
0731             <span class="comment">%</span>
0732             <span class="comment">% project.addScalefactor('Scalefactor 2', 0.1, 0.19, 1.0, true);</span>
0733             obj.scalefactors.addParameter(varargin{:});
0734         <span class="keyword">end</span>
0735         
0736         <a name="_sub50" href="#_subfunctions" class="code">function obj = removeScalefactor(obj, varargin)</a>
0737             <span class="comment">% Removes specified scale factor parameter. Expects the name/index</span>
0738             <span class="comment">% of scale factor to remove</span>
0739             <span class="comment">%</span>
0740             <span class="comment">% project.removeScalefactor(2);</span>
0741            obj.scalefactors.removeParameter(varargin{:}); 
0742         <span class="keyword">end</span>
0743         
0744         <a name="_sub51" href="#_subfunctions" class="code">function obj = setScalefactor(obj, varargin)</a>
0745             <span class="comment">% Edits an existing scale factor parameter. Expects the</span>
0746             <span class="comment">% index of scale factor to edit and key-value pairs</span>
0747             <span class="comment">%</span>
0748             <span class="comment">% project.setScalefactor(1, 'name','Scalefactor 1', 'value', 0.23251);</span>
0749             obj.scalefactors.setParameter(varargin{:});
0750         <span class="keyword">end</span>
0751         
0752        
0753         <span class="comment">% -----------------------------------------------------------------</span>
0754         <span class="comment">% Editing of custom models block</span>
0755         
0756         <a name="_sub52" href="#_subfunctions" class="code">function obj = addCustomFile(obj, varargin)            </a>
0757             <span class="comment">% Adds a new custom file parameter. Expects a parameter name, filename,</span>
0758             <span class="comment">% language (matlab, octave, or cpp), and working directory</span>
0759             <span class="comment">%</span>
0760             <span class="comment">% project.addCustomFile('model 1', 'custom.m', 'matlab', pwd);</span>
0761             obj.customFile.addCustomFile(varargin{:});
0762         <span class="keyword">end</span>
0763 
0764         <a name="_sub53" href="#_subfunctions" class="code">function obj = removeCustomFile(obj, row)</a>
0765             <span class="comment">% Removes custom file entry(ies) from the custom files object.</span>
0766             <span class="comment">% Expects index of entry(ies) to remove.</span>
0767             <span class="comment">%</span>
0768             <span class="comment">% project.removeCustomFile(1);</span>
0769             obj.customFile.removeRow(row);
0770         <span class="keyword">end</span>
0771 
0772         <a name="_sub54" href="#_subfunctions" class="code">function obj = setCustomFile(obj, row, varargin)</a>
0773             <span class="comment">% Edits an existing custom file parameter. Expects the</span>
0774             <span class="comment">% index of custom file to edit and key-value pairs</span>
0775             <span class="comment">%</span>
0776             <span class="comment">% project.setCustomFile(2, 'filename', 'custom.cpp');</span>
0777             obj.customFile.setCustomFile(row, varargin{:});
0778         <span class="keyword">end</span>
0779         
0780         
0781         <span class="comment">% ----------------------------------------------------------------</span>
0782         <span class="comment">%</span>
0783         <span class="comment">%   Editing of Contrasts Block</span>
0784         
0785         <a name="_sub55" href="#_subfunctions" class="code">function obj = addContrast(obj, varargin)</a>
0786             <span class="comment">% Adds a new contrast parameter. Expects a parameter name, and with</span>
0787             <span class="comment">% key-value pairs with one or more of the following &quot;data&quot;,</span>
0788             <span class="comment">% &quot;background&quot;, &quot;bulk in&quot;, &quot;bulk out&quot;, &quot;scalefactor&quot;,</span>
0789             <span class="comment">% &quot;resolution&quot;, &quot;resample&quot;, &quot;model&quot;</span>
0790             <span class="comment">%</span>
0791             <span class="comment">% project.addContrast('contrast 1', 'bulkIn', 'Silicon');</span>
0792             allowedNames = obj.getAllAllowedNames();
0793             obj.contrasts.addContrast(allowedNames, varargin{:});   
0794         <span class="keyword">end</span>
0795 
0796         <a name="_sub56" href="#_subfunctions" class="code">function obj = removeContrast(obj, row)</a>
0797             <span class="comment">% Removes a specified contrast parameter. Expects</span>
0798             <span class="comment">% index or name of resolution to remove</span>
0799             <span class="comment">%</span>
0800             <span class="comment">% project.removeContrast(1);</span>
0801             obj.contrasts.removeContrast(row);
0802         <span class="keyword">end</span>
0803 
0804         <a name="_sub57" href="#_subfunctions" class="code">function obj = setContrast(obj, row, varargin)   </a>
0805             <span class="comment">% Allow setting of all parameters in terms of name value pairs.</span>
0806             <span class="comment">% First input must be contrast number or name, subsequent</span>
0807             <span class="comment">% inputs are name / value pairs for the parts involved</span>
0808             <span class="comment">%</span>
0809             <span class="comment">% project.setContrast(1, 'name', 'contrast')</span>
0810                         
0811             <span class="comment">% Get the list of allowed values depending on what is</span>
0812             <span class="comment">% set for the other contrasts.</span>
0813             allowedValues = obj.getAllAllowedNames;
0814             
0815             <span class="comment">% Call the setContrast method</span>
0816             obj.contrasts.setContrast(row, allowedValues, varargin{:});
0817         <span class="keyword">end</span>
0818         
0819         <a name="_sub58" href="#_subfunctions" class="code">function obj = setContrastModel(obj, row, model)</a>
0820             <span class="comment">% Edits the model of an existing contrast parameter. Expects</span>
0821             <span class="comment">% the index of contrast parameter and cell array of layer names</span>
0822             <span class="comment">%</span>
0823             <span class="comment">% project.setContrastModel(1, {'layer 1'})</span>
0824                         
0825             <span class="comment">% Make a different allowed list depending on whether</span>
0826             <span class="comment">% it is custom or layers</span>
0827             <span class="keyword">if</span> strcmpi(obj.modelType, modelTypes.StandardLayers.value)
0828                 <span class="comment">% Standard Layers</span>
0829                 allowedValues = obj.layers.getNames();
0830             <span class="keyword">else</span>
0831                 <span class="comment">% Custom models</span>
0832                 allowedValues = obj.customFile.getNames();
0833             <span class="keyword">end</span>
0834             
0835             <span class="comment">% Call the setContrastModel method</span>
0836             obj.contrasts.setContrastModel(row, obj.modelType, allowedValues, model);
0837         <span class="keyword">end</span>
0838 
0839         <span class="comment">% ----------------------------------------------------------------</span>
0840 
0841         <a name="_sub59" href="#_subfunctions" class="code">function outStruct = toStruct(obj)    </a>
0842             <span class="comment">% Converts the class parameters into a struct array for input</span>
0843             <span class="comment">% into the RAT toolbox</span>
0844             
0845             <span class="comment">% Set which type of experiment this is</span>
0846             generalStruct.experimentName = obj.experimentName;
0847             generalStruct.TF = obj.calculationType;
0848             
0849             <span class="comment">% Add the 'general' fields</span>
0850             generalStruct.modelType = lower(obj.modelType);  
0851             generalStruct.geometry = obj.geometry;
0852 
0853             <span class="comment">% Set useImaginary flag</span>
0854             generalStruct.useImaginary = obj.absorption;
0855             
0856             <span class="comment">% Parameters</span>
0857             params = obj.parameters.toStruct();
0858             paramStruct = cell2struct(struct2cell(params),{<span class="string">'paramNames'</span>,<span class="keyword">...</span>
0859                 <span class="string">'paramLimits'</span>,<span class="string">'paramValues'</span>,<span class="string">'fitParam'</span>,<span class="string">'paramPriors'</span>});
0860             
0861             <span class="comment">% Backgrounds</span>
0862             backgroundStruct = obj.background.toStruct();
0863             
0864             <span class="comment">% Resolutions</span>
0865             resolutionStruct = obj.resolution.toStruct();
0866             
0867             <span class="comment">% Bulk in</span>
0868             bulkInStruct = obj.bulkIn.toStruct();
0869             bulkInStruct = cell2struct(struct2cell(bulkInStruct),{<span class="string">'bulkInNames'</span>,<span class="keyword">...</span>
0870                 <span class="string">'bulkInLimits'</span>,<span class="string">'bulkInValues'</span>,<span class="string">'fitBulkIn'</span>,<span class="string">'bulkInPriors'</span>});
0871             
0872             <span class="comment">% Bulk out</span>
0873             bulkOutStruct = obj.bulkOut.toStruct();
0874             bulkOutStruct = cell2struct(struct2cell(bulkOutStruct),{<span class="string">'bulkOutNames'</span>,<span class="keyword">...</span>
0875                 <span class="string">'bulkOutLimits'</span>,<span class="string">'bulkOutValues'</span>,<span class="string">'fitBulkOut'</span>,<span class="string">'bulkOutPriors'</span>});
0876             
0877             <span class="comment">% Scalefactors</span>
0878             scalefactorStruct = obj.scalefactors.toStruct();
0879             scalefactorStruct = cell2struct(struct2cell(scalefactorStruct),{<span class="string">'scalefactorNames'</span>,<span class="keyword">...</span>
0880                 <span class="string">'scalefactorLimits'</span>,<span class="string">'scalefactorValues'</span>,<span class="string">'fitScalefactor'</span>,<span class="string">'scalefactorPriors'</span>});
0881             
0882             <span class="comment">% Qzshifts</span>
0883             qzshiftStruct = obj.qzshifts.toStruct();
0884             qzshiftStruct = cell2struct(struct2cell(qzshiftStruct),{<span class="string">'qzshiftNames'</span>,<span class="keyword">...</span>
0885                 <span class="string">'qzshiftLimits'</span>,<span class="string">'qzshiftValues'</span>,<span class="string">'fitQzshift'</span>,<span class="string">'qzshiftPriors'</span>});
0886             
0887             <span class="comment">% Layers</span>
0888             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
0889                 layersStruct = obj.layers.toStruct(paramStruct.paramNames);
0890             <span class="keyword">else</span>
0891                 layersStruct.numberOfLayers = 0;
0892                 layersStruct.layerNames = strings(0,1);
0893                 layersStruct.layerDetails = {};
0894             <span class="keyword">end</span>
0895 
0896             <span class="comment">% Custom files</span>
0897             customFileStruct = obj.customFile.toStruct();
0898             
0899             <span class="comment">% Contrasts</span>
0900             allNames = obj.getAllAllowedNames;
0901             dataTable = obj.data.varTable;
0902             
0903             contrastStruct = obj.contrasts.toStruct(allNames, generalStruct.modelType, dataTable);
0904 
0905             <span class="comment">% Merge all the outputs into one large structure</span>
0906             outStruct = <a href="../../API/mergeStructs.html" class="code" title="function outStruct = mergeStructs(varargin)">mergeStructs</a>(generalStruct, <span class="keyword">...</span>
0907                                      paramStruct, <span class="keyword">...</span>
0908                                      backgroundStruct, <span class="keyword">...</span>
0909                                      resolutionStruct, <span class="keyword">...</span>
0910                                      bulkInStruct, <span class="keyword">...</span>
0911                                      bulkOutStruct, <span class="keyword">...</span>
0912                                      scalefactorStruct, <span class="keyword">...</span>
0913                                      qzshiftStruct, <span class="keyword">...</span>
0914                                      layersStruct, <span class="keyword">...</span>
0915                                      customFileStruct, <span class="keyword">...</span>
0916                                      contrastStruct);
0917             
0918         <span class="keyword">end</span>
0919 
0920         <a name="_sub60" href="#_subfunctions" class="code">function writeScript(obj, options)</a>
0921             <span class="comment">% Writes a MATLAB script that can be run to reproduce this</span>
0922             <span class="comment">% projectClass object.</span>
0923             <span class="comment">%</span>
0924             <span class="comment">% project.writeScript(script = &quot;newScript.m&quot;);</span>
0925             arguments
0926                 obj
0927                 options.objName {mustBeTextScalar} = <span class="string">'project'</span>
0928                 options.script {mustBeTextScalar} = <span class="string">'projectScript.m'</span>
0929             <span class="keyword">end</span>
0930 
0931             <span class="comment">% Need to ensure correct format for script name</span>
0932             [filePath, fileName, extension] = fileparts(options.script);
0933             
0934             <span class="comment">% The empty string fails &quot;isempty&quot;, so need to test for it</span>
0935             <span class="comment">% explicitly</span>
0936             <span class="keyword">if</span> strcmp(extension, &quot;&quot;)
0937                 <span class="comment">% Add the correct extension</span>
0938                 fileName = sprintf(<span class="string">'%s.m'</span>, fileName);
0939                 options.script = fullfile(filePath, fileName);
0940             <span class="keyword">elseif</span> ~strcmp(extension, &quot;.m&quot;)
0941                 <span class="comment">% Raise error if incorrect format is used</span>
0942                 throw(exceptions.invalidValue(sprintf(<span class="string">'The filename chosen for the script has the &quot;%s&quot; extension, rather than a MATLAB &quot;.m&quot; extension'</span>, extension)));
0943             <span class="keyword">end</span>
0944 
0945             fileID = fopen(options.script, <span class="string">'w'</span>);
0946             fprintf(fileID, &quot;<span class="comment">%s\n\n&quot;, '% THIS FILE IS GENERATED FROM RAT VIA THE &quot;WRITESCRIPT&quot; ROUTINE. IT IS NOT PART OF THE RAT CODE.');</span>
0947 
0948             <span class="comment">% Start by getting input arguments</span>
0949             projectSpec = &quot;<span class="comment">%s = createProject(name='%s', calcType='%s', model='%s', geometry='%s', absorption=%s);\n\n&quot;;</span>
0950             fprintf(fileID, projectSpec, options.objName, obj.experimentName, obj.calculationType,  obj.modelType, obj.geometry,  string(obj.absorption));
0951             <span class="keyword">if</span> obj.usePriors
0952                 fprintf(fileID, &quot;<span class="comment">%s.setUsePriors(true);\n\n&quot;, options.objName);</span>
0953             <span class="keyword">end</span>
0954 
0955             <span class="comment">% Add all parameters, with different actions for protected</span>
0956             <span class="comment">% parameters</span>
0957             paramGroup = cell(sum(~strcmpi(obj.parameters.varTable{:, 1}, obj.protectedParameters)), 1);
0958             groupIndex = 1;
0959             <span class="keyword">for</span> i=1:height(obj.parameters.varTable)
0960                 <span class="comment">% Set protected parameters</span>
0961                 <span class="keyword">if</span> any(strcmpi(obj.parameters.varTable{i, 1}, obj.protectedParameters))
0962                     fprintf(fileID, options.objName + &quot;.setParameterValue(<span class="comment">%d, %.15g);\n&quot;, i, obj.parameters.varTable{i, 3});</span>
0963                     fprintf(fileID, options.objName + &quot;.setParameterLimits(<span class="comment">%d, %.15g, %.15g);\n&quot;, i, obj.parameters.varTable{i, 2}, obj.parameters.varTable{i, 4});</span>
0964                     fprintf(fileID, options.objName + &quot;.setParameterFit(<span class="comment">%d, %s);\n&quot;, i, string(obj.parameters.varTable{i, 5}));</span>
0965                     fprintf(fileID, options.objName + &quot;.setParameterPrior(<span class="comment">%d, '%s', %.15g, %.15g);\n&quot;, i, obj.parameters.varTable{i, 6}, obj.parameters.varTable{i, 7}, obj.parameters.varTable{i, 8});</span>
0966                 <span class="comment">% Add non-protected parameters to a parameter group</span>
0967                 <span class="keyword">else</span>
0968                     paramRow = table2cell(obj.parameters.varTable(i, :))';
0969                     paramRow{5} = string(paramRow{5});
0970                     paramGroup{groupIndex} = paramRow;
0971                     groupIndex = groupIndex + 1;
0972                 <span class="keyword">end</span>
0973             <span class="keyword">end</span>
0974 
0975             fprintf(fileID, &quot;\n&quot;);
0976 
0977             <span class="comment">% Write the parameter group to the script</span>
0978             <span class="keyword">if</span> size(paramGroup, 1) &gt; 0
0979                 fprintf(fileID, &quot;paramGroup = {\n&quot;);
0980                 <span class="keyword">for</span> i = 1:size(paramGroup, 1)
0981                     paramSpec = blanks(14) + &quot;{<span class="string">'%s'</span>, <span class="comment">%.15g, %.15g, %.15g, %s, '%s', %.15g, %.15g};\n&quot;;</span>
0982                     fprintf(fileID, paramSpec, paramGroup{i}{:});
0983                 <span class="keyword">end</span>
0984                 fprintf(fileID, blanks(14) + &quot;<span class="comment">%s\n\n&quot;, &quot;};&quot;);</span>
0985                 fprintf(fileID, options.objName + &quot;.addParameterGroup(paramGroup);\n&quot;);
0986             <span class="keyword">end</span>
0987 
0988             fprintf(fileID, &quot;\n&quot;);
0989 
0990             <span class="comment">% Add all parameters based on a parametersClass</span>
0991             paramClasses = [&quot;bulkIn&quot;, &quot;bulkOut&quot;, &quot;scalefactors&quot;, &quot;background&quot;, &quot;resolution&quot;];
0992             paramSubclasses = [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;backgroundParams&quot;, &quot;resolutionParams&quot;];
0993 
0994             <span class="keyword">if</span> isprop(obj, <span class="string">'domainRatio'</span>)
0995                 paramClasses(end + 1) = &quot;domainRatio&quot;;
0996                 paramSubclasses(end + 1) = &quot;&quot;;
0997             <span class="keyword">end</span>
0998 
0999             <span class="keyword">for</span> i=1:length(paramClasses)
1000 
1001                 <span class="keyword">if</span> isprop(obj.(paramClasses(i)), <span class="string">'varTable'</span>)
1002 
1003                     removeRoutine = obj.classes.removeRoutine(obj.classes.name == paramClasses(i));
1004                     addRoutine = obj.classes.addRoutine(obj.classes.name == paramClasses(i));
1005                     numParams = height(obj.(paramClasses(i)).varTable);
1006                     paramTable = table2cell(obj.(paramClasses(i)).varTable)';
1007 
1008                 <span class="keyword">elseif</span> isprop(obj.(paramClasses(i)).(paramSubclasses(i)), <span class="string">'varTable'</span>)
1009 
1010                     removeRoutine = obj.classes.removeRoutine(obj.classes.name == paramSubclasses(i));
1011                     addRoutine = obj.classes.addRoutine(obj.classes.name == paramSubclasses(i));
1012                     numParams = height(obj.(paramClasses(i)).(paramSubclasses(i)).varTable);
1013                     paramTable = table2cell(obj.(paramClasses(i)).(paramSubclasses(i)).varTable)';
1014 
1015                 <span class="keyword">end</span>
1016 
1017                 <span class="comment">% Remove default parameter</span>
1018                 fprintf(fileID, options.objName + &quot;.&quot; + removeRoutine + &quot;(1);\n&quot;);
1019                 <span class="comment">% Convert logical parameter</span>
1020                 <span class="keyword">for</span> j=1:numParams
1021                     paramTable{5, j} = string(paramTable{5, j});
1022                 <span class="keyword">end</span>
1023                 <span class="comment">% Add the parameters that have been defined</span>
1024                 paramSpec = options.objName + &quot;.&quot; + addRoutine + &quot;(<span class="string">'%s'</span>, <span class="comment">%.15g, %.15g, %.15g, %s, '%s', %.15g, %.15g);\n&quot;;</span>
1025                 fprintf(fileID, paramSpec, paramTable{:});
1026                 fprintf(fileID, &quot;\n&quot;);
1027 
1028             <span class="keyword">end</span>
1029 
1030             <span class="comment">% Now deal with classes where all of the fields are strings</span>
1031 
1032             <span class="comment">% First, custom files</span>
1033             addRoutine = obj.classes.addRoutine(obj.classes.name == &quot;customFile&quot;);
1034             numCols = width(obj.customFile.varTable);
1035             stringTable = table2array(obj.customFile.varTable)';
1036             stringTable = stringTable([1 2 4 5 3],:);  <span class="comment">% Needs to switch columns to match argument order</span>
1037             
1038             <span class="comment">% Add parameters if any have been defined</span>
1039             <span class="keyword">if</span> ~isempty(stringTable)
1040                 stringSpec = options.objName + &quot;.&quot; + addRoutine + &quot;(&quot; + join(repmat(&quot;<span class="string">'%s'</span>&quot;, 1, numCols), &quot;, &quot;) + &quot;);\n&quot;;
1041                 fprintf(fileID, stringSpec, stringTable);
1042                 fprintf(fileID, &quot;\n&quot;);
1043             <span class="keyword">end</span>
1044 
1045             <span class="comment">% Now deal with background and resolutions, which have</span>
1046             <span class="comment">% subclasses</span>
1047             stringClasses = [&quot;background&quot;, &quot;resolution&quot;];
1048             stringSubclasses = [&quot;backgrounds&quot;, &quot;resolutions&quot;];
1049 
1050             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
1051                 stringClasses = [&quot;layers&quot;, stringClasses];
1052                 stringSubclasses = [&quot;&quot;, stringSubclasses];
1053             <span class="keyword">end</span>
1054 
1055             fprintf(fileID, options.objName + &quot;.removeBackground(1);\n&quot;);
1056             fprintf(fileID, options.objName + &quot;.removeResolution(1);\n&quot;);
1057             fprintf(fileID, &quot;\n&quot;);
1058 
1059             <span class="keyword">for</span> i=1:length(stringClasses)
1060                 stringTable = table();
1061 
1062                 <span class="keyword">if</span> isprop(obj.(stringClasses(i)), <span class="string">'varTable'</span>)
1063 
1064                     addRoutine = obj.classes.addRoutine(obj.classes.name == stringClasses(i));
1065                     numCols = width(obj.(stringClasses(i)).varTable);
1066                     stringTable = table2array(obj.(stringClasses(i)).varTable)';
1067 
1068                 <span class="keyword">elseif</span> isprop(obj.(stringClasses(i)).(stringSubclasses(i)), <span class="string">'varTable'</span>)
1069 
1070                     addRoutine = obj.classes.addRoutine(obj.classes.name == stringSubclasses(i));
1071                     numCols = width(obj.(stringClasses(i)).(stringSubclasses(i)).varTable);
1072                     stringTable = table2array(obj.(stringClasses(i)).(stringSubclasses(i)).varTable)';
1073 
1074                 <span class="keyword">end</span>
1075 
1076                 <span class="comment">% Add parameters if any have been defined</span>
1077                 <span class="keyword">if</span> ~isempty(stringTable)
1078                     stringSpec = options.objName + &quot;.&quot; + addRoutine + &quot;(&quot; + join(repmat(&quot;<span class="string">'%s'</span>&quot;, 1, numCols), &quot;, &quot;) + &quot;);\n&quot;;
1079                     fprintf(fileID, stringSpec, stringTable);
1080                     fprintf(fileID, &quot;\n&quot;);
1081                 <span class="keyword">end</span>
1082 
1083             <span class="keyword">end</span>
1084 
1085             <span class="comment">% Data class requires writing and reading the data</span>
1086             fprintf(fileID, options.objName + &quot;.removeData(1);\n&quot;);
1087 
1088             <span class="keyword">for</span> i=1:obj.data.rowCount
1089 
1090                 <span class="comment">% Write and read data if it exists, else add an empty,</span>
1091                 <span class="comment">% named row</span>
1092                 <span class="keyword">if</span> isempty(obj.data.varTable{i, 2}{:})
1093                     fprintf(fileID, options.objName + &quot;.addData(<span class="string">'%s'</span>);\n&quot;, obj.data.varTable{i, 1});
1094                 <span class="keyword">else</span>
1095                     writematrix(obj.data.varTable{i, 2}{:}, &quot;data_&quot; + string(i) + &quot;.dat&quot;);
1096                     fprintf(fileID, &quot;data_<span class="comment">%d = readmatrix('%s');\n&quot;, i, &quot;data_&quot; + string(i) + &quot;.dat&quot;);</span>
1097                     fprintf(fileID, options.objName + &quot;.addData(<span class="string">'%s'</span>, data_<span class="comment">%d);\n&quot;, obj.data.varTable{i, 1}, i);</span>
1098                 <span class="keyword">end</span>
1099 
1100                 <span class="comment">% Also need to set dataRange and simRange explicitly as they</span>
1101                 <span class="comment">% are optional</span>
1102                 <span class="keyword">if</span> ~isempty(obj.data.varTable{i, 3}{:})
1103                     fprintf(fileID, options.objName + &quot;.setData(<span class="comment">%d, 'dataRange', [%.15g %.15g]);\n&quot;, i, obj.data.varTable{i, 3}{:});</span>
1104                 <span class="keyword">end</span>
1105                 <span class="keyword">if</span> ~isempty(obj.data.varTable{i, 4}{:})
1106                     fprintf(fileID, options.objName + &quot;.setData(<span class="comment">%d, 'simRange', [%.15g %.15g]);\n&quot;, i, obj.data.varTable{i, 4}{:});</span>
1107                 <span class="keyword">end</span>
1108 
1109                 fprintf(fileID, &quot;\n&quot;);
1110 
1111             <span class="keyword">end</span>
1112 
1113             <span class="comment">% Contrasts are a cell array rather than a table</span>
1114             <span class="comment">% Need to handle resample and model fields separately</span>
1115             <span class="keyword">for</span> i=1:obj.contrasts.numberOfContrasts
1116 
1117                 reducedStruct = rmfield(obj.contrasts.contrasts{i}, {<span class="string">'resample'</span>, <span class="string">'model'</span>});
1118                 contrastParams = string(namedargs2cell(reducedStruct));
1119                 contrastSpec = options.objName + &quot;.addContrast(&quot; + join(repmat(&quot;<span class="string">'%s'</span>&quot;, 1, length(contrastParams)), &quot;, &quot;) + &quot;);\n&quot;;
1120                 fprintf(fileID, contrastSpec, contrastParams);
1121                 fprintf(fileID, options.objName + &quot;.setContrast(<span class="comment">%d, 'resample', %s);\n&quot;, i, string(obj.contrasts.contrasts{i}.resample));</span>
1122                 <span class="keyword">if</span> ~isempty(obj.contrasts.contrasts{i}.model)
1123                     fprintf(fileID, options.objName + &quot;.setContrastModel(<span class="comment">%d, {&quot; + join(repmat(&quot;'%s'&quot;, 1, length(obj.contrasts.contrasts{i}.model))) +&quot;});\n&quot;, i, obj.contrasts.contrasts{i}.model{:});</span>
1124                 <span class="keyword">end</span>
1125                 fprintf(fileID, &quot;\n&quot;);
1126 
1127             <span class="keyword">end</span>
1128 
1129             <span class="keyword">if</span> isprop(obj, <span class="string">'domainContrasts'</span>) &amp;&amp; isa(obj.domainContrasts, <span class="string">'domainContrastsClass'</span>)
1130                 <span class="keyword">for</span> i=1:obj.domainContrasts.numberOfContrasts
1131                     
1132                     reducedStruct = rmfield(obj.domainContrasts.contrasts{i}, {<span class="string">'model'</span>});
1133                     contrastParams = string(namedargs2cell(reducedStruct));
1134                     contrastSpec = options.objName + &quot;.addDomainContrast(&quot; + join(repmat(&quot;<span class="string">'%s'</span>&quot;, 1, length(contrastParams)), &quot;, &quot;) + &quot;);\n&quot;;
1135                     fprintf(fileID, contrastSpec, contrastParams);
1136                     <span class="keyword">if</span> ~isempty(obj.domainContrasts.contrasts{i}.model)
1137                         fprintf(fileID, options.objName + &quot;.setDomainContrastModel(<span class="comment">%d, {&quot; + join(repmat(&quot;'%s'&quot;, 1, length(obj.domainContrasts.contrasts{i}.model))) +&quot;});\n&quot;, i, obj.domainContrasts.contrasts{i}.model{:});</span>
1138                     <span class="keyword">end</span>
1139                     fprintf(fileID, &quot;\n&quot;);
1140                     
1141                 <span class="keyword">end</span>
1142             <span class="keyword">end</span>
1143             
1144             fclose(fileID);
1145 
1146         <span class="keyword">end</span>
1147         
1148     <span class="keyword">end</span>     <span class="comment">% end public methods</span>
1149     
1150     <span class="comment">% ------------------------------------------------------------------</span>
1151     
1152     methods (Access = protected)
1153         <span class="comment">% Display methods</span>
1154         <a name="_sub61" href="#_subfunctions" class="code">function group = getPropertyGroup1(obj)</a>
1155             <span class="comment">% Initial Parameters at the start of the class</span>
1156             masterPropList = struct(<span class="string">'modelType'</span>,{obj.modelType},<span class="keyword">...</span>
1157                 <span class="string">'experimentName'</span>,{obj.experimentName},<span class="keyword">...</span>
1158                 <span class="string">'geometry'</span>, obj.geometry);
1159             
1160             <span class="keyword">if</span> isscalar(obj)
1161                 group = matlab.mixin.util.PropertyGroup(masterPropList);
1162             <span class="keyword">else</span>
1163                 group = <a href="#_sub62" class="code" title="subfunction group = getPropertyGroup1(obj)">getPropertyGroup1</a>@matlab.mixin.CustomDisplay(obj);
1164             <span class="keyword">end</span>
1165         <span class="keyword">end</span>
1166         
1167         <a name="_sub62" href="#_subfunctions" class="code">function displayScalarObject(obj)</a>
1168             <span class="comment">% Display the whole class. Call the display methods for</span>
1169             <span class="comment">% the sub-classes where appropriate</span>
1170             
1171             <span class="comment">% There are two versions, depending on whether the model</span>
1172             <span class="comment">% is standard layers or custom, the difference being</span>
1173             <span class="comment">% the display of the layers table and domain contrasts.</span>
1174             
1175             <span class="comment">% Display initial properties</span>
1176             startProps = <a href="#_sub62" class="code" title="subfunction group = getPropertyGroup1(obj)">getPropertyGroup1</a>(obj);
1177             matlab.mixin.CustomDisplay.displayPropertyGroups(obj,startProps);
1178             
1179             <span class="comment">% Display the parameters table</span>
1180             fprintf(<span class="string">'\n    Parameters: ---------------------------------------------------------------------------------------------- \n\n'</span>);
1181             obj.parameters.displayTable;
1182                         
1183             <span class="comment">% Display the Bulk In table</span>
1184             fprintf(<span class="string">'\n    Bulk In: -------------------------------------------------------------------------------------------------- \n\n'</span>);
1185             obj.bulkIn.displayTable;
1186             
1187             <span class="comment">% Display the Bulk Out table</span>
1188             fprintf(<span class="string">'\n    Bulk Out: ------------------------------------------------------------------------------------------------- \n\n'</span>);
1189             obj.bulkOut.displayTable;
1190             
1191             <span class="comment">% Display the Scalefactors table</span>
1192             fprintf(<span class="string">'\n    Scalefactors: ------------------------------------------------------------------------------------------------- \n\n'</span>);
1193             obj.scalefactors.displayTable;
1194 
1195             <span class="comment">% Display the domain ratio if defined</span>
1196             <span class="keyword">if</span> isprop(obj, <span class="string">'domainRatio'</span>) &amp;&amp; isa(obj.domainRatio, <span class="string">'parametersClass'</span>)
1197                 fprintf(<span class="string">'\n   Domain Ratios: ----------------------------------------------------------------------------------------------- \n\n'</span>);
1198                 obj.domainRatio.displayTable;
1199             <span class="keyword">end</span>
1200 
1201             <span class="comment">% Display the backgrounds object</span>
1202             fprintf(<span class="string">'\n    Backgrounds: ----------------------------------------------------------------------------------------------- \n\n'</span>);
1203             obj.background.displayBackgroundsObject;
1204             
1205             <span class="comment">% Display the resolutions object</span>
1206             fprintf(<span class="string">'\n    Resolutions: --------------------------------------------------------------------------------------------- \n\n'</span>);
1207             obj.resolution.displayResolutionsObject;
1208 
1209             <span class="comment">% Display the layers table if not a custom model</span>
1210             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
1211                 fprintf(<span class="string">'\n    Layers: -------------------------------------------------------------------------------------------------- \n\n'</span>);
1212                 obj.layers.displayTable;
1213             <span class="keyword">end</span>
1214 
1215             <span class="comment">% Display custom files object</span>
1216             fprintf(<span class="string">'\n    Custom Files: ------------------------------------------------------------------------------------------------------ \n\n'</span>);
1217             obj.customFile.displayTable;
1218             
1219             <span class="comment">% Display the data object</span>
1220             fprintf(<span class="string">'\n    Data: ------------------------------------------------------------------------------------------------------ \n\n'</span>);
1221             obj.data.displayTable;
1222             
1223             <span class="comment">% Display the domainContrasts object if defined</span>
1224             <span class="keyword">if</span> isprop(obj, <span class="string">'domainContrasts'</span>) &amp;&amp; isa(obj.domainContrasts, <span class="string">'domainContrastsClass'</span>)
1225                 fprintf(<span class="string">'\n   Domains Contrasts: ----------------------------------------------------------------------------------------------- \n\n'</span>);
1226                 obj.domainContrasts.displayContrastsObject; 
1227             <span class="keyword">end</span>
1228             
1229             <span class="comment">% Display the contrasts object</span>
1230             fprintf(<span class="string">'\n   Contrasts: ----------------------------------------------------------------------------------------------- \n\n'</span>);
1231             obj.contrasts.displayContrastsObject;
1232             
1233         <span class="keyword">end</span>
1234         
1235     <span class="keyword">end</span>
1236 
1237     methods (Access = protected, Hidden)
1238 
1239         <a name="_sub63" href="#_subfunctions" class="code">function modifyLayersTable(obj,~,~)</a>
1240             <span class="comment">% Add or remove a column from the layers table whenever the</span>
1241             <span class="comment">% &quot;absorption&quot; property is modified.</span>
1242             <span class="keyword">if</span> isa(obj.layers, <span class="string">'layersClass'</span>)
1243                 <span class="keyword">if</span> obj.absorption
1244                     newCol = repmat(&quot;&quot;, height(obj.layers.varTable), 1);
1245                     obj.layers.varTable = addvars(obj.layers.varTable, newCol, <span class="string">'After'</span>, <span class="string">'SLD'</span>, <span class="string">'NewVariableNames'</span>, <span class="string">'SLD Imaginary'</span>);
1246                     obj.layers.varTable = renamevars(obj.layers.varTable, <span class="string">'SLD'</span>, <span class="string">'SLD Real'</span>);
1247                 <span class="keyword">else</span>
1248                     obj.layers.varTable = removevars(obj.layers.varTable, <span class="string">'SLD Imaginary'</span>);
1249                     obj.layers.varTable = renamevars(obj.layers.varTable, <span class="string">'SLD Real'</span>, <span class="string">'SLD'</span>);
1250                 <span class="keyword">end</span>
1251             <span class="keyword">end</span>
1252         <span class="keyword">end</span>
1253 
1254     <span class="keyword">end</span>
1255 
1256     methods (Hidden)
1257 
1258         <a name="_sub64" href="#_subfunctions" class="code">function domainsObj = domainsClass(obj)</a>
1259             <span class="comment">% Converter routine from projectClass to domainsClass.</span>
1260             <span class="comment">% This routine takes the currently defined project and</span>
1261             <span class="comment">% converts it to a domains calculation, preserving all</span>
1262             <span class="comment">% currently defined properties.</span>
1263             <span class="comment">%</span>
1264             <span class="comment">% domainsProject = project.domainsClass();</span>
1265             domainsObj = <a href="domainsClass.html" class="code" title="">domainsClass</a>(obj.experimentName, calculationTypes.Domains, obj.modelType, obj.geometry, obj.absorption);
1266             domainsObj = copyProperties(obj, domainsObj);
1267 
1268             <span class="comment">% Need to treat contrasts separately due to changes in the</span>
1269             <span class="comment">% class for domains calculations</span>
1270             domainsObj.contrasts = copyProperties(obj.contrasts, <a href="contrastsClass.html" class="code" title="">contrastsClass</a>(domains=true, oilWater=obj.contrasts.oilWaterCalc));
1271             <span class="keyword">for</span> i=1:domainsObj.contrasts.numberOfContrasts
1272                 domainsObj.contrasts.contrasts{i}.domainRatio = <span class="string">''</span>;
1273             <span class="keyword">end</span>
1274         <span class="keyword">end</span>
1275 
1276     <span class="keyword">end</span>
1277 
1278 <span class="keyword">end</span>
</pre></div>

<hr><address>Generated on Wed 05-Jun-2024 09:06:47 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>

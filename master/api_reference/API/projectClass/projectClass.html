<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of projectClass</title>
  <meta name="keywords" content="projectClass">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html API -->
<!-- menu.html projectClass -->

<h1>projectClass
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="backgroundsClass.html" class="code" title="">backgroundsClass</a>	</li>
<li><a href="contrastsClass.html" class="code" title="">contrastsClass</a>	</li>
<li><a href="customFileClass.html" class="code" title="">customFileClass</a>	</li>
<li><a href="dataClass.html" class="code" title="">dataClass</a>	</li>
<li><a href="layersClass_realSLD.html" class="code" title="">layersClass_realSLD</a>	</li>
<li><a href="mergeStructs.html" class="code" title="function outStruct = mergeStructs(varargin)">mergeStructs</a>	</li>
<li><a href="parametersClass.html" class="code" title="">parametersClass</a>	</li>
<li><a href="projectClass.html" class="code" title="">projectClass</a>	</li>
<li><a href="resolutionsClass.html" class="code" title="">resolutionsClass</a>	</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="projectClass.html" class="code" title="">projectClass</a>	</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = projectClass(varargin)</a></li>
<li><a href="#_sub2" class="code">function obj = setUsePriors(obj, showFlag)</a></li>
<li><a href="#_sub3" class="code">function obj = setGeometry(obj,val)</a></li>
<li><a href="#_sub4" class="code">function obj = setModelType(obj,val)</a></li>
<li><a href="#_sub5" class="code">function names = getAllAllowedNames(obj)</a></li>
<li><a href="#_sub6" class="code">function obj = addParamGroup(obj,varargin)</a></li>
<li><a href="#_sub7" class="code">function obj = addParam(obj,varargin)</a></li>
<li><a href="#_sub8" class="code">function obj = removeParam(obj,varargin)</a></li>
<li><a href="#_sub9" class="code">function obj = setParameter(obj,varargin)</a></li>
<li><a href="#_sub10" class="code">function obj = setParamValue(obj,varargin)</a></li>
<li><a href="#_sub11" class="code">function obj = setParamConstr(obj,varargin)</a></li>
<li><a href="#_sub12" class="code">function obj = setParamName(obj,varargin)</a></li>
<li><a href="#_sub13" class="code">function obj = setParamFit(obj,varargin)</a></li>
<li><a href="#_sub14" class="code">function obj = setParamPrior(obj,varargin)</a></li>
<li><a href="#_sub15" class="code">function obj = addLayerGroup(obj,varargin)</a></li>
<li><a href="#_sub16" class="code">function obj = addLayer(obj,varargin)</a></li>
<li><a href="#_sub17" class="code">function obj = setLayerValue(obj,varargin)</a></li>
<li><a href="#_sub18" class="code">function obj = addBacksPar(obj, varargin)</a></li>
<li><a href="#_sub19" class="code">function obj = removeBacksPar(obj, varargin)</a></li>
<li><a href="#_sub20" class="code">function obj = setBacksParValue(obj,varargin)</a></li>
<li><a href="#_sub21" class="code">function obj = setBacksParConstr(obj,varargin)</a></li>
<li><a href="#_sub22" class="code">function obj = setBacksParName(obj,varargin)</a></li>
<li><a href="#_sub23" class="code">function obj = addBackground(obj,varargin)</a></li>
<li><a href="#_sub24" class="code">function obj = removeBackground(obj,varargin)</a></li>
<li><a href="#_sub25" class="code">function obj = setBackgroundValue(obj,varargin)</a></li>
<li><a href="#_sub26" class="code">function obj = setBackgroundName(obj,varargin)</a></li>
<li><a href="#_sub27" class="code">function obj = setBacksPar(obj,varargin);</a></li>
<li><a href="#_sub28" class="code">function obj = setResolParValue(obj,varargin)</a></li>
<li><a href="#_sub29" class="code">function obj = addResolPar(obj, varargin)</a></li>
<li><a href="#_sub30" class="code">function obj = setResolPar(obj,varargin)</a></li>
<li><a href="#_sub31" class="code">function obj = removeResolPar(obj,varargin)</a></li>
<li><a href="#_sub32" class="code">function obj = addResolution(obj,varargin)</a></li>
<li><a href="#_sub33" class="code">function obj = removeResolution(obj,varargin)</a></li>
<li><a href="#_sub34" class="code">function obj = addData(obj, varargin)</a></li>
<li><a href="#_sub35" class="code">function obj = removeData(obj,varargin)</a></li>
<li><a href="#_sub36" class="code">function obj = setData(obj, varargin)</a></li>
<li><a href="#_sub37" class="code">function obj = addBulkOut(obj,varargin)</a></li>
<li><a href="#_sub38" class="code">function obj = removeBulkOut(obj,varargin)</a></li>
<li><a href="#_sub39" class="code">function obj = setBulkOut(obj,varargin)</a></li>
<li><a href="#_sub40" class="code">function obj = addBulkIn(obj,varargin)</a></li>
<li><a href="#_sub41" class="code">function obj = removeBulkIn(obj,varargin)</a></li>
<li><a href="#_sub42" class="code">function obj = setBulkIn(obj,varargin)</a></li>
<li><a href="#_sub43" class="code">function obj = addScalefactor(obj,varargin)</a></li>
<li><a href="#_sub44" class="code">function obj = removeScalefactor(obj,varargin)</a></li>
<li><a href="#_sub45" class="code">function obj = setScalefactor(obj,varargin)</a></li>
<li><a href="#_sub46" class="code">function obj = addQzshift(obj,varargin)</a></li>
<li><a href="#_sub47" class="code">function obj = addCustomFile(obj, varargin)</a></li>
<li><a href="#_sub48" class="code">function obj = setCustomFile(obj,varargin)</a></li>
<li><a href="#_sub49" class="code">function obj = addContrast(obj,varargin)</a></li>
<li><a href="#_sub50" class="code">function obj = removeContrast(obj,varargin)</a></li>
<li><a href="#_sub51" class="code">function obj = setContrast(obj,varargin)</a></li>
<li><a href="#_sub52" class="code">function obj = setContrastModel(obj,varargin)</a></li>
<li><a href="#_sub53" class="code">function outStruct = toStruct(obj)</a></li>
<li><a href="#_sub54" class="code">function paramNum = findPar(obj, paramName)</a></li>
<li><a href="#_sub55" class="code">function group = getPropertyGroup1(obj)</a></li>
<li><a href="#_sub56" class="code">function displayScalarObject(obj)</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="projectClass.html" class="code" title="">projectClass</a> &lt; handle &amp; matlab.mixin.CustomDisplay
0002     
0003     <span class="comment">% Class definition for Standard Layers with no absorption.</span>
0004     <span class="comment">% Layers defined in terms of thickness, roughness, real SLD and</span>
0005     <span class="comment">% hydration.</span>
0006     <span class="comment">%</span>
0007     <span class="comment">% Sub objects used are:</span>
0008     <span class="comment">% parametersClass       - parameter definition with priors</span>
0009     <span class="comment">% layersClass_realSLD   - layers defined as (d,rho_real,rough,hydration)</span>
0010     <span class="comment">% backgroundsClass      -</span>
0011     <span class="comment">% resolutionsClass      -</span>
0012     <span class="comment">% dataClass             -</span>
0013     <span class="comment">% contrastsClass        -</span>
0014     <span class="comment">% customFileClass       -</span>
0015     
0016     properties
0017         experimentName
0018         Geometry
0019         parameters          <span class="comment">% parametersClass object</span>
0020         layers              <span class="comment">% layersClass_realSLD object</span>
0021         bulkIn              <span class="comment">% parametersClass object</span>
0022         bulkOut             <span class="comment">% parametersClass object</span>
0023         background          <span class="comment">% backgroundsClass object</span>
0024         scalefactors        <span class="comment">% parametersClass object</span>
0025         qzshifts            <span class="comment">% parametersClass object</span>
0026         resolution          <span class="comment">% resolutionClass object</span>
0027         contrasts           <span class="comment">% contrastsClass object</span>
0028         data                <span class="comment">% dataClass object</span>
0029         customFile          <span class="comment">% Custom file object</span>
0030         
0031         UsePriors = false
0032 
0033         ModelType = <span class="string">'standard layers'</span>
0034     <span class="keyword">end</span>
0035     
0036     properties (Access = private)
0037         
0038         experimentType = <span class="string">'Non polarized no absorption'</span>;
0039         
0040     <span class="keyword">end</span>
0041     
0042     methods
0043 
0044         <a name="_sub0" href="#_subfunctions" class="code">function obj = projectClass(varargin)</a>
0045             <span class="comment">% Creates a Project object. The only argument is the</span>
0046             <span class="comment">% experiment name which is a char array</span>
0047             <span class="comment">%</span>
0048             <span class="comment">% problem = projectClass('New experiment');</span>
0049             <span class="keyword">if</span> isempty(varargin)
0050                 name = <span class="string">''</span>;
0051             <span class="keyword">elseif</span> ~ischar(varargin{1})
0052                 error(<span class="string">'Input must be char'</span>);
0053             <span class="keyword">else</span>
0054                 name = varargin{1};
0055             <span class="keyword">end</span>
0056 
0057             obj.experimentName = name;
0058             obj.Geometry = <span class="string">'air/substrate'</span>;
0059             
0060             <span class="comment">% Initialise the Parameters Table</span>
0061             obj.parameters = <a href="parametersClass.html" class="code" title="">parametersClass</a>({<span class="string">'Substrate Roughness'</span>,1, 3, 5,true,<span class="string">'uniform'</span>,0,Inf});
0062             
0063             <span class="comment">% Initialise the layers table</span>
0064             obj.layers = <a href="layersClass_realSLD.html" class="code" title="">layersClass_realSLD</a>();
0065             
0066             <span class="comment">% Initialise bulkIn table</span>
0067             obj.bulkIn = <a href="parametersClass.html" class="code" title="">parametersClass</a>({<span class="string">'SLD Air'</span>,0,0,0,false,<span class="string">'uniform'</span>,0,Inf});
0068             
0069             <span class="comment">% Initialise bulkOut table</span>
0070             obj.bulkOut = <a href="parametersClass.html" class="code" title="">parametersClass</a>({<span class="string">'SLD D2O'</span>,6.2e-6,6.35e-6,6.35e-6,false,<span class="string">'uniform'</span>,0,Inf});
0071             
0072             <span class="comment">% Initialise scalefactors table</span>
0073             obj.scalefactors = <a href="parametersClass.html" class="code" title="">parametersClass</a>({<span class="string">'Scalefactor 1'</span>,0.02,0.23,0.25,false,<span class="string">'uniform'</span>,0,Inf});
0074             
0075             <span class="comment">% Initialise qzshifts table</span>
0076             obj.qzshifts = <a href="parametersClass.html" class="code" title="">parametersClass</a>({<span class="string">'Qz shift 1'</span>,-1e-4,0,1e-4,false,<span class="string">'uniform'</span>,0,Inf});
0077             
0078             <span class="comment">% Initialise backs object</span>
0079             backPars = {<span class="string">'Backs par 1'</span>,1e-7,1e-6,1e-5,false,<span class="string">'uniform'</span>,0,Inf};
0080             backgrounds = {<span class="string">'Background 1'</span>,<span class="string">'constant'</span>,<span class="string">'Backs Par 1'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>};
0081             obj.background = <a href="backgroundsClass.html" class="code" title="">backgroundsClass</a>(backPars,backgrounds);
0082             
0083             <span class="comment">% Initialise resolution object</span>
0084             resolPars = {<span class="string">'Resolution par 1'</span>,0.01,0.03,0.05,false,<span class="string">'uniform'</span>,0,Inf};
0085             resolutions = {<span class="string">'Resolution 1'</span>,<span class="string">'gaussian'</span>,<span class="string">'Resolution par 1'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>};
0086             obj.resolution = <a href="resolutionsClass.html" class="code" title="">resolutionsClass</a>(resolPars,resolutions);
0087             
0088             <span class="comment">% Initialise data object</span>
0089             obj.data = <a href="dataClass.html" class="code" title="">dataClass</a>({<span class="string">'Simulation'</span>,{[]},{[]}, {[]}});
0090             
0091             <span class="comment">% Initialise Contrasts object.</span>
0092             obj.contrasts = <a href="contrastsClass.html" class="code" title="">contrastsClass</a>();
0093             
0094             <span class="comment">% Initialise custom file object</span>
0095             obj.customFile = <a href="customFileClass.html" class="code" title="">customFileClass</a>();
0096             
0097         <span class="keyword">end</span>
0098         
0099         
0100         <a name="_sub1" href="#_subfunctions" class="code">function obj = setUsePriors(obj, showFlag)</a>
0101             <span class="comment">% Sets the use priors flag. The showFlag should be a boolean/logical.</span>
0102             <span class="comment">%</span>
0103             <span class="comment">% problem.setUsePriors(true);</span>
0104             <span class="keyword">if</span> ~islogical(showFlag)
0105                 error(<span class="string">'usePriors must be logical ''true'' or ''false'''</span>);
0106             <span class="keyword">end</span>
0107             obj.UsePriors = showFlag;
0108             
0109             <span class="comment">% Also need to set the flag in sub-objects</span>
0110             <span class="comment">% where relevant..</span>
0111             <span class="comment">% (1) Parameters</span>
0112             <span class="comment">% replace with showFlag</span>
0113             obj.parameters.showPriors = showFlag;
0114             
0115             <span class="comment">% (2) Bulk In</span>
0116             obj.bulkIn.showPriors = showFlag;
0117             
0118             <span class="comment">% (3) Bulk out</span>
0119             obj.bulkOut.showPriors = showFlag;
0120             
0121             <span class="comment">% (4) Scalefactors</span>
0122             obj.scalefactors.showPriors = showFlag;
0123             
0124             <span class="comment">% (5) Qz shifts</span>
0125             obj.qzshifts.showPriors = showFlag;
0126             
0127             <span class="comment">% (6) Backgrounds (parameters table)</span>
0128             obj.background.backPars.showPriors = showFlag;
0129             
0130             <span class="comment">% (7) Resolutions (parameters table)</span>
0131             obj.resolution.resolPars.showPriors = showFlag;
0132             
0133         <span class="keyword">end</span>
0134         
0135         <a name="_sub2" href="#_subfunctions" class="code">function obj = setGeometry(obj,val)</a>
0136             <span class="comment">% Sets the experiment geometry. The geometry should be a string,</span>
0137             <span class="comment">% either &quot;Air/Substrate&quot; or &quot;Substrate/Liquid&quot; is permitted.</span>
0138             <span class="comment">%</span>
0139             <span class="comment">% problem.setGeometry('Substrate/liquid');</span>
0140             <span class="keyword">if</span> ~ischar(val)
0141                 error(<span class="string">'Expecting char array'</span>)
0142             <span class="keyword">end</span>
0143             
0144             <span class="keyword">if</span> ~any(strcmpi(val,{<span class="string">'Air/substrate'</span>,<span class="string">'Substrate/Liquid'</span>}))
0145                 error(<span class="string">'Expecting Air/Substrate or Substrate/Liquid'</span>)
0146             <span class="keyword">end</span>
0147             
0148             <span class="keyword">if</span> strcmpi(val,<span class="string">'air/substrate'</span>)
0149                 obj.Geometry = <span class="string">'air/substrate'</span>;
0150             <span class="keyword">elseif</span> strcmpi(val,<span class="string">'substrate/liquid'</span>)
0151                 obj.Geometry = <span class="string">'substrate/liquid'</span>;
0152             <span class="keyword">end</span>
0153         <span class="keyword">end</span>
0154         
0155         <a name="_sub3" href="#_subfunctions" class="code">function obj = setModelType(obj,val)</a>
0156             <span class="comment">% Sets the experiment type. The type should be a string,</span>
0157             <span class="comment">% either &quot;standard layers&quot;, &quot;custom layers&quot;, or &quot;custom xy&quot; is permitted.</span>
0158             <span class="comment">%</span>
0159             <span class="comment">% problem.setModelType('Custom Layers');</span>
0160             
0161             <span class="keyword">if</span> ~ischar(val)
0162                 error(<span class="string">'Expecting a char array'</span>);
0163             <span class="keyword">end</span>
0164             
0165             <span class="keyword">if</span> ~any(strcmpi(val,{<span class="string">'standard layers'</span>,<span class="string">'custom layers'</span>,<span class="string">'custom xy'</span>}))
0166                 error(<span class="string">'experiment type has to be Standard Layers, Custom Layers or Custom XY'</span>);
0167             <span class="keyword">end</span>
0168             
0169             obj.ModelType = lower(val);
0170             
0171         <span class="keyword">end</span>
0172         
0173 
0174         <a name="_sub4" href="#_subfunctions" class="code">function names = getAllAllowedNames(obj)           </a>
0175             <span class="comment">% Returns a cell array of all currently</span>
0176             <span class="comment">% set parameter names for the project.</span>
0177             names.paramNames = obj.parameters.getParamNames();
0178             names.backsNames = obj.background.getBackgroundNames();
0179             names.backParNames = obj.background.getBacksParNames();
0180             names.bulkInNames = obj.bulkIn.getParamNames();
0181             names.bulkOutNames = obj.bulkOut.getParamNames();
0182             names.resolsNames = obj.resolution.getResolNames();
0183             names.resolParNames = obj.resolution.getResolParNames();
0184             names.layersNames = obj.layers.getLayersNames();
0185             names.dataNames = obj.data.getDataNames();
0186             names.scalefacNames = obj.scalefactors.getParamNames();
0187             names.qzShiftNames = obj.qzshifts.getParamNames();
0188             names.customNames = obj.customFile.getCustomNames();
0189             
0190         <span class="keyword">end</span>
0191         
0192         <span class="comment">% ---------------------------------</span>
0193         <span class="comment">% Editing Parameters Block</span>
0194         
0195         <a name="_sub5" href="#_subfunctions" class="code">function obj = addParamGroup(obj,varargin)</a>
0196             <span class="comment">% Adds a group of parameters to the parameters object. Expects a cell</span>
0197             <span class="comment">% array of parameter cell arrays.</span>
0198             <span class="comment">%</span>
0199             <span class="comment">% problem.addParamGroup({{'Tails Thickness'}; {'Heads Thickness'}});</span>
0200             
0201             input = varargin{:};
0202             <span class="keyword">if</span> ~iscell(input)
0203                 error(<span class="string">'Expecting a cell array of parameters'</span>);
0204             <span class="keyword">end</span>
0205             
0206             <span class="keyword">for</span> i = 1:length(input)
0207                 obj = <a href="#_sub7" class="code" title="subfunction obj = addParam(obj,varargin)">addParam</a>(obj,input{i});
0208             <span class="keyword">end</span>
0209         <span class="keyword">end</span>
0210         
0211         
0212         <a name="_sub6" href="#_subfunctions" class="code">function obj = addParam(obj,varargin)</a>
0213             <span class="comment">% Adds an individual parameter to the parameters object.</span>
0214             <span class="comment">% Check how many parameters we are adding and make sure all</span>
0215             <span class="comment">% the inputs are cells. A parameter consists of a name, min,</span>
0216             <span class="comment">% value, max, fit flag, prior type', mu, and sigma. The input</span>
0217             <span class="comment">% is optional but if provided should contain 1, 2, 4, 5, or 8</span>
0218             <span class="comment">% values of the parameter to added.</span>
0219             <span class="comment">%</span>
0220             <span class="comment">% problem.addParam('Tails Roughness');</span>
0221             <span class="keyword">if</span> isempty(varargin)
0222                 obj.parameters.addParam();
0223             <span class="keyword">else</span>
0224                 <span class="comment">% If the input is wrapped in a cell (so varargin is a cell of a cell)</span>
0225                 <span class="comment">% need to unwrap one layer of it, otherwise keep varargin as it is</span>
0226                 <span class="keyword">if</span> iscell(varargin{:})
0227                     thisParam = varargin{:};
0228                 <span class="keyword">else</span>
0229                     thisParam = varargin;
0230                 <span class="keyword">end</span>
0231                 obj.parameters.addParam(thisParam);
0232             <span class="keyword">end</span>
0233             
0234         <span class="keyword">end</span>
0235                 
0236         <a name="_sub7" href="#_subfunctions" class="code">function obj = removeParam(obj,varargin)</a>
0237             <span class="comment">% Removes a parameter from the parameters object. The</span>
0238             <span class="comment">% parameter will also be removed from the layers array</span>
0239             <span class="comment">% if it is in use. Expects index or name of parameter to</span>
0240             <span class="comment">% remove</span>
0241             <span class="comment">%</span>
0242             <span class="comment">% problem.removeParam(2);</span>
0243             removing = varargin;
0244             numberOfParams = length(removing);
0245             
0246             <span class="comment">% Remove the param</span>
0247             <span class="keyword">for</span> i = 1:numberOfParams
0248                 thisParam = varargin;<span class="comment">%{i};</span>
0249                 
0250                 <span class="comment">% Make sure we don't remove substrate roughness</span>
0251                 <span class="keyword">if</span> (isequal(thisParam{1},1)) || (strcmpi(thisParam{1},<span class="string">'Substrate Roughness'</span>))
0252                     error(<span class="string">'Can''t remove protected parameter Substrate Roughness'</span>);
0253                 <span class="keyword">end</span>
0254                 
0255                 <span class="keyword">if</span> iscell(thisParam)
0256                     thisParam = thisParam{:};
0257                 <span class="keyword">end</span>
0258                 
0259                 <span class="comment">% No need to check validity of the parameter</span>
0260                 <span class="comment">% as this is done in the parameters class</span>
0261                 obj.parameters.removeParam(thisParam);
0262                 
0263                 <span class="comment">% Need to check if it is used in the layers</span>
0264                 <span class="comment">% array and remove it if so. Should be able</span>
0265                 <span class="comment">% to do this with array indexing, but can't quite figure</span>
0266                 <span class="comment">% that out atm, so just use a (dirty) loop over all</span>
0267                 <span class="comment">% the elements for now..</span>
0268                 
0269                 findParam = string(thisParam);
0270                 laysTable = obj.layers.layersTable;
0271                 dims = size(laysTable);
0272                 <span class="keyword">for</span> m = 1:dims(1)
0273                     <span class="keyword">for</span> n = 1:dims(2)
0274                         tablePar = laysTable{m,n};   <span class="comment">% Should be a string</span>
0275                         <span class="keyword">if</span> isequal(findParam,tablePar)
0276                             obj.layers.layersTable(m,n) = {&quot;&quot;};
0277                         <span class="keyword">end</span>
0278                     <span class="keyword">end</span>
0279                 <span class="keyword">end</span>
0280             <span class="keyword">end</span>
0281             
0282         <span class="keyword">end</span>
0283         
0284         <a name="_sub8" href="#_subfunctions" class="code">function obj = setParameter(obj,varargin)</a>
0285             <span class="comment">% General purpose set parameter method. Expects</span>
0286             <span class="comment">% index or name of parameter and keyword/value pairs to set</span>
0287             <span class="comment">%</span>
0288             <span class="comment">% problem.setParameter(2, 'value', 50);</span>
0289             obj.parameters.setParameter(varargin);
0290         <span class="keyword">end</span>
0291         
0292         
0293         <a name="_sub9" href="#_subfunctions" class="code">function obj = setParamValue(obj,varargin)</a>
0294             <span class="comment">% Sets the value of a given parameter. Expects</span>
0295             <span class="comment">% index or name of parameter and new value to set</span>
0296             <span class="comment">%</span>
0297             <span class="comment">% problem.setParamValue(2, 50);</span>
0298             obj.parameters.setValue(varargin);
0299         <span class="keyword">end</span>
0300         
0301         <a name="_sub10" href="#_subfunctions" class="code">function obj = setParamConstr(obj,varargin)</a>
0302             <span class="comment">% Sets the constraints of an existing parameter.</span>
0303             <span class="comment">% Expects index or name of parameter and new min</span>
0304             <span class="comment">% and max of the parameter's value</span>
0305             <span class="comment">%</span>
0306             <span class="comment">% problem.setParamConstr(2, 0, 100);</span>
0307             obj.parameters.setConstr(varargin);
0308         <span class="keyword">end</span>
0309         
0310         <a name="_sub11" href="#_subfunctions" class="code">function obj = setParamName(obj,varargin)</a>
0311             <span class="comment">% Sets the name of an existing parameter</span>
0312             <span class="comment">% Expects index or name of parameter and the</span>
0313             <span class="comment">% new name</span>
0314             <span class="comment">%</span>
0315             <span class="comment">% problem.setParamName(2, 'new name');</span>
0316             inputValue = varargin;
0317             <span class="keyword">if</span> (isequal(inputValue{1},1)) || (strcmpi(inputValue{1},<span class="string">'Substrate Roughness'</span>))
0318                 error(<span class="string">'Can''t rename protected parameter Substrate Roughness'</span>);
0319             <span class="keyword">end</span>
0320             obj.parameters.setName(varargin); <span class="comment">%= updatedParams;</span>
0321         <span class="keyword">end</span>
0322         
0323         <a name="_sub12" href="#_subfunctions" class="code">function obj = setParamFit(obj,varargin)</a>
0324             <span class="comment">% Sets the 'fit' to off or on for parameter.</span>
0325             <span class="comment">% Expects index or name of parameter and</span>
0326             <span class="comment">% new fit flag</span>
0327             <span class="comment">%</span>
0328             <span class="comment">% problem.setParamFit(2, true);</span>
0329             obj.parameters.setFit(varargin);
0330         <span class="keyword">end</span>
0331         
0332         <a name="_sub13" href="#_subfunctions" class="code">function obj = setParamPrior(obj,varargin)</a>
0333             <span class="comment">% Sets the prior type of the parameter.</span>
0334             <span class="comment">% Expects index or name of parameter and</span>
0335             <span class="comment">% new prior type('uniform','gaussian','jeffreys')</span>
0336             <span class="comment">%</span>
0337             <span class="comment">% problem.setParamPrior(2, 'uniform');</span>
0338             obj.parameters.setPrior(varargin);  
0339         <span class="keyword">end</span>
0340         
0341         <span class="comment">% -----------------------------------------------------</span>
0342         
0343         <span class="comment">% Editing of layers block</span>
0344         <a name="_sub14" href="#_subfunctions" class="code">function obj = addLayerGroup(obj,varargin)</a>
0345             <span class="comment">% Adds a group of layers to the layers object. Expects</span>
0346             <span class="comment">% a cell array of layer cell arrays</span>
0347             <span class="comment">%</span>
0348             <span class="comment">% problem.addLayerGroup({'Layer 1'; 'Layer 2'});</span>
0349             input = varargin{:};
0350             <span class="keyword">if</span> ~iscell(input)
0351                 error(<span class="string">'Expecting a cell array of layers'</span>);
0352             <span class="keyword">end</span>
0353             
0354             <span class="keyword">for</span> i = 1:length(input)
0355                 obj = <a href="#_sub16" class="code" title="subfunction obj = addLayer(obj,varargin)">addLayer</a>(obj,input{i});
0356             <span class="keyword">end</span>
0357             
0358         <span class="keyword">end</span>
0359         
0360         
0361         <a name="_sub15" href="#_subfunctions" class="code">function obj = addLayer(obj,varargin)</a>
0362             <span class="comment">% Adds a single layer to the layers object. Expects a cell</span>
0363             <span class="comment">% array containing layer details which are name, thickness,</span>
0364             <span class="comment">% SLD, roughness, hydration, and hydrate with, or provided</span>
0365             <span class="comment">% a name to create an empty layer.</span>
0366             <span class="comment">%</span>
0367             <span class="comment">%  problem.addLayer('New Layer');</span>
0368             <span class="keyword">if</span> isempty(varargin)
0369                 <span class="comment">% No input, so empty layer</span>
0370                 whatToAdd = {<span class="string">'empty'</span>};
0371                 
0372             <span class="keyword">elseif</span> ischar(varargin{:})
0373                 <span class="comment">% Input is string, so named empty layer</span>
0374                 whatToAdd = {<span class="string">'empty named'</span>, varargin};
0375                 
0376             <span class="keyword">elseif</span> iscell(varargin{:})
0377                 <span class="comment">% Input is cell, so adding layer with parameters</span>
0378                 whatToAdd = {<span class="string">'full layer'</span>, varargin};
0379             <span class="keyword">end</span>
0380             
0381             <span class="comment">% Layers class will also need to know which parameters are</span>
0382             <span class="comment">% currently defined (could also be done here rather than in</span>
0383             <span class="comment">% object)</span>
0384             table = obj.parameters.paramsTable;
0385             paramNames = table(:,1);
0386             
0387             <span class="comment">% Call the addLayers method</span>
0388             obj.layers.addLayer(whatToAdd,paramNames);
0389             
0390         <span class="keyword">end</span>
0391         
0392         <a name="_sub16" href="#_subfunctions" class="code">function obj = setLayerValue(obj,varargin)</a>
0393             <span class="comment">% Sets a value of a given layer. Expects the row/name and</span>
0394             <span class="comment">% column of layer value to set, then the name/index of the</span>
0395             <span class="comment">% parameter to set the value to.</span>
0396             <span class="comment">%</span>
0397             <span class="comment">% problem.setLayerValue(1, 2, 'Tails Thickness');</span>
0398             <span class="keyword">if</span> length(varargin) ~= 3
0399                 error(<span class="string">'Three parameters expected into setLayerValue'</span>);
0400             <span class="keyword">end</span>
0401             inputPars = varargin;
0402             
0403             <span class="comment">% Check if set value exists as a parameter</span>
0404             inputVal = inputPars{3};
0405             parNames = obj.parameters.paramsTable{:,1};
0406             
0407             <span class="keyword">if</span> ischar(inputVal)
0408                 <span class="keyword">if</span> ~any(strcmpi(inputVal,parNames))
0409                     error(<span class="string">'Parameter %s not recognized'</span>,inputVal);
0410                 <span class="keyword">end</span>
0411             <span class="keyword">elseif</span> isnumeric(inputVal)
0412                 <span class="keyword">if</span> inputVal &lt; 1 || inputVal &gt; length(parNames)
0413                     error(<span class="string">'Parameter is out of range'</span>)
0414                 <span class="keyword">end</span>
0415                 inputPars{3} = parNames{inputVal};
0416             <span class="keyword">end</span>
0417             
0418             <span class="comment">% call the layers class to set the value</span>
0419             obj.layers.setLayerValue(inputPars);           
0420         <span class="keyword">end</span>
0421         
0422         <span class="comment">% ---------------------------------------------------------------</span>
0423         
0424         <span class="comment">% Editing of Backgrounds block</span>
0425         
0426         
0427         <span class="comment">%(1) Background Parameters</span>
0428         <a name="_sub17" href="#_subfunctions" class="code">function obj = addBacksPar(obj, varargin)</a>
0429             <span class="comment">% Adds a new background parameter. A parameter consists</span>
0430             <span class="comment">% of a name, min, value, max, fit flag, prior type', mu,</span>
0431             <span class="comment">% and sigma</span>
0432             <span class="comment">%</span>
0433             <span class="comment">% problem.addBacksPar('Backs Value D2O', 1e-8, 2.8e-6, 1e-5);</span>
0434             obj.background.addBacksPar(varargin);
0435         <span class="keyword">end</span>
0436         
0437         <a name="_sub18" href="#_subfunctions" class="code">function obj = removeBacksPar(obj, varargin)</a>
0438             <span class="comment">% Removes a given background parameter.</span>
0439             <span class="comment">% Expects index or name of parameter to remove</span>
0440             <span class="comment">%</span>
0441             <span class="comment">% problem.removeBacksPar(2);</span>
0442             obj.background.removeBacksPar(varargin{:});
0443         <span class="keyword">end</span>
0444         
0445         <a name="_sub19" href="#_subfunctions" class="code">function obj = setBacksParValue(obj,varargin)</a>
0446             <span class="comment">% Sets the value of existing background</span>
0447             <span class="comment">% parameter. Expects index or name of parameter</span>
0448             <span class="comment">% and new value to set</span>
0449             <span class="comment">%</span>
0450             <span class="comment">% problem.setBacksParValue(1, 5.5e-6);</span>
0451             obj.background.setBacksParValue(varargin);
0452         <span class="keyword">end</span>
0453         
0454         <a name="_sub20" href="#_subfunctions" class="code">function obj = setBacksParConstr(obj,varargin)</a>
0455             <span class="comment">% Sets the constraints of existing background</span>
0456             <span class="comment">% parameter. Expects index or name of parameter</span>
0457             <span class="comment">% and new min and max of the parameter's value</span>
0458             <span class="comment">%</span>
0459             <span class="comment">% problem.setBacksParConstr(1, 0, 1);</span>
0460             obj.background.setBacksParConstr(varargin);
0461         <span class="keyword">end</span>
0462         
0463         <a name="_sub21" href="#_subfunctions" class="code">function obj = setBacksParName(obj,varargin)</a>
0464             <span class="comment">% Sets the name of an existing background</span>
0465             <span class="comment">% parameter. Expects index or name of parameter</span>
0466             <span class="comment">% and the new name</span>
0467             <span class="comment">%</span>
0468             <span class="comment">% problem.setBacksParName(2, 'new name');</span>
0469             obj.background.setBacksParName(varargin);
0470         <span class="keyword">end</span>
0471         
0472         <span class="comment">% (2) Backgrounds</span>
0473         <a name="_sub22" href="#_subfunctions" class="code">function obj = addBackground(obj,varargin)</a>
0474             <span class="comment">% Adds a background to the project. Expects a</span>
0475             <span class="comment">% cell array with background name and type and</span>
0476             <span class="comment">% up to 4 parameters</span>
0477             <span class="comment">%</span>
0478             <span class="comment">% problem.addBackground('name','constant','par');</span>
0479             obj.background.addBackground(varargin);
0480         <span class="keyword">end</span>
0481         
0482         <a name="_sub23" href="#_subfunctions" class="code">function obj = removeBackground(obj,varargin)</a>
0483             <span class="comment">% Removes background from the project. Expects</span>
0484             <span class="comment">% index of background to remove</span>
0485             <span class="comment">%</span>
0486             <span class="comment">% problem.removeBackground(1);</span>
0487             obj.background.removeBackground(varargin);
0488         <span class="keyword">end</span>
0489         
0490         <a name="_sub24" href="#_subfunctions" class="code">function obj = setBackgroundValue(obj,varargin)</a>
0491             <span class="comment">% Sets the value of an existing background. Expects</span>
0492             <span class="comment">% index or name of background and keyword/value pairs to set</span>
0493             <span class="comment">%</span>
0494             <span class="comment">% problem.setBackgroundValue(1, 'name', 'Background ACMW');</span>
0495             obj.background.setBackgroundValue(varargin);
0496         <span class="keyword">end</span>
0497         
0498         <a name="_sub25" href="#_subfunctions" class="code">function obj = setBackgroundName(obj,varargin)</a>
0499             <span class="comment">% Sets the name of an existing Background.</span>
0500             <span class="comment">% Expects index or name of background and the new name</span>
0501             <span class="comment">%</span>
0502             <span class="comment">% problem.setBackgroundName(2, 'new name');</span>
0503             obj.background.setBackgroundName(varargin);
0504         <span class="keyword">end</span>
0505         
0506         <a name="_sub26" href="#_subfunctions" class="code">function obj = setBacksPar(obj,varargin);</a>
0507             <span class="comment">% Sets the value of an existing background parameter. Expects</span>
0508             <span class="comment">% index or name of parameter and keyword/value pairs to set</span>
0509             <span class="comment">%</span>
0510             <span class="comment">% problem.setBacksPar(1, 'name', 'Backs Value H2O');</span>
0511             obj.background.setBacksPar(varargin);
0512         <span class="keyword">end</span>
0513         
0514         <span class="comment">% -------------------------------------------------------------</span>
0515         <span class="comment">%   Editing of Resolutions block</span>
0516         
0517         <span class="comment">% Resol Pars</span>
0518         <a name="_sub27" href="#_subfunctions" class="code">function obj = setResolParValue(obj,varargin)</a>
0519             <span class="comment">% Sets the value of existing resolution</span>
0520             <span class="comment">% parameter. Expects index or name of parameter</span>
0521             <span class="comment">% and new value to set</span>
0522             <span class="comment">%</span>
0523             <span class="comment">% problem.setResolParValue(1, 5.5e-6);</span>
0524             obj.resolution.setResolParValue(varargin);
0525         <span class="keyword">end</span>
0526         
0527         <a name="_sub28" href="#_subfunctions" class="code">function obj = addResolPar(obj, varargin)</a>
0528             <span class="comment">% Adds a new resolution parameter. A parameter consists</span>
0529             <span class="comment">% of a name, min, value, max, fit flag, prior type', mu,</span>
0530             <span class="comment">% and sigma</span>
0531             <span class="comment">%</span>
0532             <span class="comment">% problem.addResolPar('ResolPar 1', 1e-8, 2.8e-6, 1e-5);</span>
0533             obj.resolution.addResolPar(varargin);
0534         <span class="keyword">end</span>
0535         
0536         <a name="_sub29" href="#_subfunctions" class="code">function obj = setResolPar(obj,varargin)</a>
0537             <span class="comment">% Sets the value of an existing resolution parameter. Expects</span>
0538             <span class="comment">% index or name of parameter and keyword/value pairs to set</span>
0539             <span class="comment">%</span>
0540             <span class="comment">% problem.setResolPar(1, 'name', 'ResolPar');</span>
0541             obj.resolution.setResolPar(varargin);
0542         <span class="keyword">end</span>
0543         
0544         <a name="_sub30" href="#_subfunctions" class="code">function obj = removeResolPar(obj,varargin)</a>
0545             <span class="comment">% Removes a given resolution parameter.</span>
0546             <span class="comment">% Expects index or name of parameter to remove</span>
0547             <span class="comment">%</span>
0548             <span class="comment">% problem.removeResolPar(2);</span>
0549             obj.resolution.removeResolPar(varargin{:});
0550         <span class="keyword">end</span>
0551         
0552         <span class="comment">% Resolutions</span>
0553         <a name="_sub31" href="#_subfunctions" class="code">function obj = addResolution(obj,varargin)</a>
0554             <span class="comment">% Adds a resolution to the project. Expects a</span>
0555             <span class="comment">% cell array with resolution name and type and</span>
0556             <span class="comment">% up to 4 parameters</span>
0557             <span class="comment">%</span>
0558             <span class="comment">% problem.addResolution('name','constant','par');</span>
0559             obj.resolution.addResolution(varargin);
0560         <span class="keyword">end</span>
0561         
0562         <a name="_sub32" href="#_subfunctions" class="code">function obj = removeResolution(obj,varargin)</a>
0563             <span class="comment">% Removes resolution from the project. Expects</span>
0564             <span class="comment">% index of resolution to remove</span>
0565             <span class="comment">%</span>
0566             <span class="comment">% problem.removeResolution(1);</span>
0567             obj.resolution.removeResolution(varargin);
0568         <span class="keyword">end</span>
0569         
0570         
0571         <span class="comment">% ------------------------------------------------------------</span>
0572         <span class="comment">%   Editing of Data block</span>
0573         
0574         <a name="_sub33" href="#_subfunctions" class="code">function obj = addData(obj, varargin)</a>
0575             <span class="comment">% Adds a new data parameter. Expects the name</span>
0576             <span class="comment">% of data and the data array</span>
0577             <span class="comment">%</span>
0578             <span class="comment">% problem.addData('Sim 2', data);</span>
0579             obj.data.addData(varargin);
0580         <span class="keyword">end</span>
0581         
0582         <a name="_sub34" href="#_subfunctions" class="code">function obj = removeData(obj,varargin)</a>
0583             <span class="comment">% This method is TODO, both here and in the dataClass subclass</span>
0584             disp(<span class="string">'Todo'</span>);
0585         <span class="keyword">end</span>
0586         
0587         <a name="_sub35" href="#_subfunctions" class="code">function obj = setData(obj, varargin)</a>
0588             <span class="comment">% Edits an existing data parameter. Expects the</span>
0589             <span class="comment">% index of data to edit and key-value pairs</span>
0590             <span class="comment">%</span>
0591             <span class="comment">% problem.setData(1, 'name', 'Sim 1', 'data', zeros(4, 3));</span>
0592             nameChanged = obj.data.setData(varargin);
0593             
0594             <span class="keyword">if</span> ~isempty(nameChanged)
0595                 obj.contrasts.updateContrastName(nameChanged);
0596             <span class="keyword">end</span>
0597         <span class="keyword">end</span>
0598         
0599         
0600         <span class="comment">% ---------------------------------------------------------------</span>
0601         <span class="comment">%   Editing of Bulk out block</span>
0602         
0603         <a name="_sub36" href="#_subfunctions" class="code">function obj = addBulkOut(obj,varargin)</a>
0604             <span class="comment">% Adds a new bulk-out parameter. Expects the name</span>
0605             <span class="comment">% of bulk-out, min, value, max, and if fit is off or on</span>
0606             <span class="comment">%</span>
0607             <span class="comment">% problem.addBulkOut('SLD ACMW', -1e-6, 0.0, 1e-6, true);</span>
0608             obj.bulkOut.addParam(varargin);
0609         <span class="keyword">end</span>
0610         
0611         <a name="_sub37" href="#_subfunctions" class="code">function obj = removeBulkOut(obj,varargin)</a>
0612             <span class="comment">% Removes specified bulk-out parameter. Expects the name/index</span>
0613             <span class="comment">% of bulk-out to remove</span>
0614             <span class="comment">%</span>
0615             <span class="comment">% problem.removeBulkOut(2);</span>
0616             obj.bulkOut.removeParam(varargin{:});
0617         <span class="keyword">end</span>
0618         
0619         <a name="_sub38" href="#_subfunctions" class="code">function obj = setBulkOut(obj,varargin)</a>
0620             <span class="comment">% Edits an existing bulk-out parameter. Expects the</span>
0621             <span class="comment">% index of bulk-out to edit and key-value pairs</span>
0622             <span class="comment">%</span>
0623             <span class="comment">% problem.setBulkOut(1, 'name', 'SLD H2O', 'min', 2.07e-6);</span>
0624             obj.bulkOut.setParameter(varargin);
0625         <span class="keyword">end</span>
0626         
0627         
0628         <span class="comment">% ------------------------------------------------------------------</span>
0629         <span class="comment">% Editing of bulk in block</span>
0630         
0631         <a name="_sub39" href="#_subfunctions" class="code">function obj = addBulkIn(obj,varargin)</a>
0632             <span class="comment">% Adds a new bulk-in parameter. Expects the name</span>
0633             <span class="comment">% of bulk-in, min, value, max, and if fit is off or on</span>
0634             <span class="comment">%</span>
0635             <span class="comment">% problem.addBulkIn('Silicon', -1e-6, 0.0, 1e-6, true);</span>
0636             obj.bulkIn.addParam(varargin);
0637         <span class="keyword">end</span>
0638         
0639         <a name="_sub40" href="#_subfunctions" class="code">function obj = removeBulkIn(obj,varargin)</a>
0640             <span class="comment">% Removes specified bulk-in parameter. Expects the name/index</span>
0641             <span class="comment">% of bulk-in to remove</span>
0642             <span class="comment">%</span>
0643             <span class="comment">% problem.removeBulkIn(2);</span>
0644             obj.bulkIn.removeParam(varargin{:});
0645         <span class="keyword">end</span>
0646         
0647         <a name="_sub41" href="#_subfunctions" class="code">function obj = setBulkIn(obj,varargin)</a>
0648             <span class="comment">% Edits an existing bulk-in parameter. Expects the</span>
0649             <span class="comment">% index of bulk-in to edit and key-value pairs</span>
0650             <span class="comment">%</span>
0651             <span class="comment">% problem.setBulkIn(1, 'name', 'Silicon', 'max', 2.07e-6);</span>
0652             obj.bulkIn.setParameter(varargin);
0653         <span class="keyword">end</span>
0654         
0655         <span class="comment">% -------------------------------------------------------------------</span>
0656         <span class="comment">% Editing of scalefactors block</span>
0657         
0658         <a name="_sub42" href="#_subfunctions" class="code">function obj = addScalefactor(obj,varargin)</a>
0659             <span class="comment">% Adds a new scale factor parameter. Expects the name</span>
0660             <span class="comment">% of scale factor, min, value, max, and if fit is off or on</span>
0661             <span class="comment">%</span>
0662             <span class="comment">% problem.addScalefactor({'Scalefactor 2', 0.1, 0.19, 1.0, true});</span>
0663             obj.scalefactors.addParam(varargin{:});
0664         <span class="keyword">end</span>
0665         
0666         <a name="_sub43" href="#_subfunctions" class="code">function obj = removeScalefactor(obj,varargin)</a>
0667             <span class="comment">% Removes specified scale factor parameter. Expects the name/index</span>
0668             <span class="comment">% of scale factor to remove</span>
0669             <span class="comment">%</span>
0670             <span class="comment">% problem.removeScalefactor(2);</span>
0671            obj.scalefactors.removeParam(varargin{:}); 
0672         <span class="keyword">end</span>
0673         
0674         <a name="_sub44" href="#_subfunctions" class="code">function obj = setScalefactor(obj,varargin)</a>
0675             <span class="comment">% Edits an existing scale factor parameter. Expects the</span>
0676             <span class="comment">% index of scale factor to edit and key-value pairs</span>
0677             <span class="comment">%</span>
0678             <span class="comment">% problem.setScalefactor(1, 'name','Scalefactor 1', 'value', 0.23251);</span>
0679             obj.scalefactors.setParameter(varargin);
0680         <span class="keyword">end</span>
0681         
0682 
0683         <span class="comment">% -----------------------------------------------------------------</span>
0684         <span class="comment">% Editing of qzshifts block</span>
0685         
0686         <a name="_sub45" href="#_subfunctions" class="code">function obj = addQzshift(obj,varargin)</a>
0687             <span class="comment">% Adds a new qz shift parameter. Expects the name</span>
0688             <span class="comment">% of qz shift, min, value, max, and if fit is off or on</span>
0689             <span class="comment">%</span>
0690             <span class="comment">% problem..addQzshift({'Qz shift 2', -0.2e-4, 0, 2e-4, false});</span>
0691             obj.qzshifts.addParam(varargin{:}); 
0692         <span class="keyword">end</span>
0693         
0694         
0695         <span class="comment">% -----------------------------------------------------------------</span>
0696         <span class="comment">% editing of custom models block</span>
0697         
0698         <a name="_sub46" href="#_subfunctions" class="code">function obj = addCustomFile(obj, varargin)            </a>
0699             <span class="comment">% Adds a new custom file parameter. Expects a parameter name, filename,</span>
0700             <span class="comment">% language (matlab, octave, or cpp), and working directory</span>
0701             <span class="comment">%</span>
0702             <span class="comment">% problem.addCustomFile('model 1', 'custom.m', 'matlab', 'pwd');</span>
0703             obj.customFile.addFile(varargin{:});
0704         <span class="keyword">end</span>
0705         
0706         <a name="_sub47" href="#_subfunctions" class="code">function obj = setCustomFile(obj,varargin)</a>
0707             <span class="comment">% Edits an existing custom file parameter. Expects the</span>
0708             <span class="comment">% index of custom file to edit and key-value pairs</span>
0709             <span class="comment">%</span>
0710             <span class="comment">% problem.setCustomFile(2, 'filename', 'custom.cpp');</span>
0711             obj.customFile.setCustomFile(varargin);
0712         <span class="keyword">end</span>
0713         
0714         
0715         <span class="comment">% ----------------------------------------------------------------</span>
0716         <span class="comment">%</span>
0717         <span class="comment">%   Editing of Contrasts Block</span>
0718         
0719         <a name="_sub48" href="#_subfunctions" class="code">function obj = addContrast(obj,varargin)</a>
0720             <span class="comment">% Adds a new contrast parameter. Expects a parameter name, and with</span>
0721             <span class="comment">% key-value pairs with one or more of the following &quot;data&quot;, &quot;background&quot;,</span>
0722             <span class="comment">% &quot;bulk in&quot;, &quot;bulk out&quot;, &quot;scalefactor&quot;, &quot;resolution&quot;, &quot;resample&quot;, &quot;model</span>
0723             <span class="comment">%</span>
0724             <span class="comment">% problem.addContrast('contrast 1', 'nba', 'Silicon');</span>
0725             allowedNames = obj.getAllAllowedNames();
0726             obj.contrasts.addContrast(allowedNames,varargin);
0727             
0728         <span class="keyword">end</span>
0729 
0730         <a name="_sub49" href="#_subfunctions" class="code">function obj = removeContrast(obj,varargin)</a>
0731             <span class="comment">% Removes a specified contrast parameter. Expects</span>
0732             <span class="comment">% index or name of resolution to remove</span>
0733             <span class="comment">%</span>
0734             <span class="comment">% problem.removeContrast(1);</span>
0735             obj.contrasts.removeContrast(varargin);
0736         <span class="keyword">end</span>
0737 
0738         
0739         <a name="_sub50" href="#_subfunctions" class="code">function obj = setContrast(obj,varargin)   </a>
0740             <span class="comment">% Allow setting of all parameters in terms of name value pairs.</span>
0741             <span class="comment">% First input must be contrast number or name, subsequent</span>
0742             <span class="comment">% inputs are name / value pairs for the parts involved</span>
0743             <span class="comment">%</span>
0744             <span class="comment">% problem.setContrast(1, 'name', 'contrast')</span>
0745             firstInput = varargin{1};
0746             inputVals = varargin(2:end);
0747             
0748             contrastNames = obj.contrasts.getAllContrastNames();
0749             numberOfContrasts = obj.contrasts.numberOfContrasts;
0750             
0751             <span class="comment">% Find if we are referencing and existing contrast</span>
0752             <span class="keyword">if</span> isnumeric(firstInput)
0753                 <span class="keyword">if</span> (firstInput &lt; 1 || firstInput &gt; numberOfContrasts)
0754                     error(<span class="string">'Contrast number %d is out of range'</span>,firstInput);
0755                 <span class="keyword">end</span>
0756                 thisContrast = firstInput;
0757                 
0758             <span class="keyword">elseif</span> ischar(firstInput)
0759                 [present,idx] = ismember(firstInput, contrastNames);
0760                 <span class="keyword">if</span> ~present
0761                     error(<span class="string">'Contrast %s is not recognised'</span>,firstInput)
0762                 <span class="keyword">end</span>
0763                 thisContrast = idx;
0764                 
0765             <span class="keyword">end</span>
0766             
0767             <span class="comment">% Get the list of allowed values depending on what is</span>
0768             <span class="comment">% set for the other contrasts.</span>
0769             allowedValues = obj.getAllAllowedNames;
0770             
0771             <span class="comment">% Call the setContrast method</span>
0772             obj.contrasts.setContrast(thisContrast,allowedValues,inputVals);
0773             
0774         <span class="keyword">end</span>
0775         
0776         <a name="_sub51" href="#_subfunctions" class="code">function obj = setContrastModel(obj,varargin)</a>
0777             <span class="comment">% Edits the model of an existing contrast parameter. Expects the</span>
0778             <span class="comment">% index of contrast parameter and cell array of layer names</span>
0779             <span class="comment">%</span>
0780             <span class="comment">% problem.setContrastModel(1, {'layer 1'})</span>
0781             firstInput = varargin{1};
0782             inputVals = varargin(2:end);
0783             
0784             contrastNames = obj.contrasts.getAllContrastNames();
0785             numberOfContrasts = obj.contrasts.numberOfContrasts;
0786             
0787             <span class="comment">% Find if we are referencing and existing contrast</span>
0788             <span class="keyword">if</span> isnumeric(firstInput)
0789                 <span class="keyword">if</span> (firstInput &lt; 1 || firstInput &gt; numberOfContrasts)
0790                     error(<span class="string">'Contrast number %d is out of range'</span>,firstInput);
0791                 <span class="keyword">end</span>
0792                 thisContrast = firstInput;
0793                 
0794             <span class="keyword">elseif</span> ischar(firstInput)
0795                 [present,idx] = ismember(firstInput, contrastNames);
0796                 <span class="keyword">if</span> ~present
0797                     error(<span class="string">'Contrast %s is not recognised'</span>,firstInput)
0798                 <span class="keyword">end</span>
0799                 thisContrast = idx;
0800                 
0801             <span class="keyword">end</span>
0802             
0803             <span class="comment">% Make a different allowed list depending on whether</span>
0804             <span class="comment">% it is custom or layers</span>
0805             ModelType = obj.ModelType;
0806             
0807             <span class="keyword">if</span> ~strcmpi(ModelType,{<span class="string">'custom layers'</span>,<span class="string">'custom xy'</span>})
0808                 <span class="comment">% Standard Layers</span>
0809                 allowedValues = obj.layers.getLayersNames();
0810                 ModelType = <span class="string">'standard'</span>;
0811                 inputVals = inputVals{:};
0812             <span class="keyword">else</span>
0813                 <span class="comment">% Custom models</span>
0814                 allowedValues = obj.customFile.getCustomNames();
0815                 ModelType = <span class="string">'custom'</span>;
0816             <span class="keyword">end</span>
0817             
0818             <span class="comment">% Call the setContrastModel method</span>
0819             obj.contrasts.setContrastModel(thisContrast,ModelType,allowedValues,inputVals);
0820 
0821         <span class="keyword">end</span>
0822         
0823         <a name="_sub52" href="#_subfunctions" class="code">function outStruct = toStruct(obj)    </a>
0824             <span class="comment">% Converts the class parameters into a struct array for input into</span>
0825             <span class="comment">% the RAT toolbox</span>
0826             
0827             <span class="comment">% Set which type of experiment this is</span>
0828             generalStruct.experimentName = obj.experimentName;
0829             generalStruct.TF = <span class="string">'standardTF'</span>;
0830             
0831             <span class="comment">% Add the 'general' fields</span>
0832             thisType = obj.ModelType;
0833             
0834             <span class="keyword">switch</span> lower(thisType)
0835                 <span class="keyword">case</span> <span class="string">'standard layers'</span>
0836                     generalStruct.ModelType = <span class="string">'layers'</span>;
0837                 <span class="keyword">case</span> <span class="string">'custom layers'</span>
0838                     generalStruct.ModelType = <span class="string">'custom layers'</span>;
0839                 <span class="keyword">case</span> <span class="string">'custom xy'</span>
0840                     generalStruct.ModelType = <span class="string">'custom xy'</span>;
0841             <span class="keyword">end</span>
0842                      
0843             generalStruct.geometry = obj.Geometry;
0844             
0845             <span class="comment">% Parameters</span>
0846             params = obj.parameters.toStruct();
0847             paramStruct = cell2struct(struct2cell(params),{<span class="string">'paramNames'</span>,<span class="keyword">...</span>
0848                 <span class="string">'nParams'</span>,<span class="string">'paramConstr'</span>,<span class="string">'params'</span>,<span class="string">'paramFitYesNo'</span>,<span class="string">'paramPriors'</span>});
0849             
0850             <span class="comment">% Backgrounds</span>
0851             backgroundStruct = obj.background.toStruct();
0852             
0853             <span class="comment">% Resolutions</span>
0854             resolutionStruct = obj.resolution.toStruct();
0855             
0856             <span class="comment">% Bulk in</span>
0857             bulkInStruct = obj.bulkIn.toStruct();
0858             bulkInStruct = cell2struct(struct2cell(bulkInStruct),{<span class="string">'nbairNames'</span>,<span class="keyword">...</span>
0859                 <span class="string">'nNba'</span>,<span class="string">'nbairConstr'</span>,<span class="string">'nbairs'</span>,<span class="string">'nbaFitYesNo'</span>,<span class="string">'nbaPriors'</span>});
0860             
0861             <span class="comment">% Bulk out</span>
0862             bulkOutStruct = obj.bulkOut.toStruct();
0863             bulkOutStruct = cell2struct(struct2cell(bulkOutStruct),{<span class="string">'nbsubNames'</span>,<span class="keyword">...</span>
0864                 <span class="string">'nNbs'</span>,<span class="string">'nbsubConstr'</span>,<span class="string">'nbsubs'</span>,<span class="string">'nbsFitYesNo'</span>,<span class="string">'nbsPriors'</span>});
0865             
0866             <span class="comment">% Scalefactors</span>
0867             scalefactorStruct = obj.scalefactors.toStruct();
0868             scalefactorStruct = cell2struct(struct2cell(scalefactorStruct),{<span class="string">'scalefactorNames'</span>,<span class="keyword">...</span>
0869                 <span class="string">'nScalefcators'</span>,<span class="string">'scalefactorConstr'</span>,<span class="string">'scalefactors'</span>,<span class="string">'scalefactorFitYesNo'</span>,<span class="string">'scalefactorPriors'</span>});
0870             
0871             <span class="comment">% Qzshifts</span>
0872             qzshiftStruct = obj.qzshifts.toStruct();
0873             qzshiftStruct = cell2struct(struct2cell(qzshiftStruct),{<span class="string">'qzshiftNames'</span>,<span class="keyword">...</span>
0874                 <span class="string">'nQzshifts'</span>,<span class="string">'qzshiftConstr'</span>,<span class="string">'qzshifts'</span>,<span class="string">'qzshiftFitYesNo'</span>,<span class="string">'qzshiftPriors'</span>});
0875             
0876             <span class="comment">% Layers</span>
0877             layersCell = obj.layers.toStruct();
0878             layersStruct.numberOfLayers = size(layersCell,1);
0879             layersStruct.layersnames = layersCell(:,1);
0880             
0881             <span class="comment">% parse the layers details</span>
0882             layersValues = layersCell(:,2:end);
0883             paramNames = string(paramStruct.paramNames);
0884             
0885             <span class="keyword">switch</span> generalStruct.ModelType
0886                 <span class="keyword">case</span> <span class="string">'layers'</span>
0887                     numberOfLayers = layersStruct.numberOfLayers;
0888                     
0889                     <span class="keyword">if</span> numberOfLayers &gt; 0
0890                         <span class="comment">% Standard layers with layers present</span>
0891                         <span class="keyword">for</span> i = 1:layersStruct.numberOfLayers
0892                             thisLayer = layersValues(i,:);
0893                             min = find(strcmpi(thisLayer{1},paramNames));
0894                             val = find(strcmpi(thisLayer{2},paramNames));
0895                             max = find(strcmpi(thisLayer{3},paramNames));
0896                             <span class="keyword">if</span> ismissing(thisLayer(4))
0897                                 hydr = NaN;
0898                             <span class="keyword">else</span>
0899                                 hydr = find(strcmpi(thisLayer{4},paramNames));
0900                             <span class="keyword">end</span>
0901                             <span class="keyword">if</span> strcmpi(thisLayer{5},<span class="string">'bulk in'</span>)
0902                                 hydrWhat = 1;
0903                             <span class="keyword">else</span>
0904                                 hydrWhat = 2;
0905                             <span class="keyword">end</span>
0906                             layersDetails{i} = [min val max hydr hydrWhat];
0907                         <span class="keyword">end</span>
0908                         layersStruct.layersDetails = layersDetails(:);
0909                     <span class="keyword">else</span>
0910                         <span class="comment">% No layers present - still need to set</span>
0911                         <span class="comment">% layersDetails</span>
0912                         layersStruct.layersDetails = {};
0913                     <span class="keyword">end</span>
0914                 <span class="keyword">otherwise</span>
0915                     <span class="comment">% Not standard layers experiment type</span>
0916                     layersStruct.layersDetails = {};
0917             <span class="keyword">end</span>
0918             
0919             <span class="comment">% Custom files</span>
0920             customFileStruct = obj.customFile.toStruct();
0921             
0922             <span class="comment">% Contrasts.</span>
0923             allNames = obj.getAllAllowedNames;
0924             dataTable = obj.data.dataTable;
0925             
0926             modelType = generalStruct.ModelType;
0927             contrastStruct = obj.contrasts.toStruct(allNames,modelType,dataTable);
0928             
0929             <span class="comment">% Merge all the outputs into one large structure</span>
0930             outStruct = <a href="mergeStructs.html" class="code" title="function outStruct = mergeStructs(varargin)">mergeStructs</a>(generalStruct,<span class="keyword">...</span>
0931                 paramStruct,<span class="keyword">...</span>
0932                 backgroundStruct,<span class="keyword">...</span>
0933                 resolutionStruct,<span class="keyword">...</span>
0934                 bulkInStruct,<span class="keyword">...</span>
0935                 bulkOutStruct,<span class="keyword">...</span>
0936                 scalefactorStruct,<span class="keyword">...</span>
0937                 qzshiftStruct,<span class="keyword">...</span>
0938                 layersStruct,<span class="keyword">...</span>
0939                 customFileStruct,<span class="keyword">...</span>
0940                 contrastStruct);
0941             
0942         <span class="keyword">end</span>
0943         
0944     <span class="keyword">end</span>     <span class="comment">% end public methods</span>
0945     
0946     <span class="comment">% ------------------------------------------------------------------</span>
0947     
0948     methods (Access = protected)
0949         
0950         <a name="_sub53" href="#_subfunctions" class="code">function paramNum = findPar(obj, paramName)</a>
0951             existingNames = obj.parameters.paramsTable{:,1};
0952             index = strcmp(paramName, existingNames);
0953             <span class="keyword">if</span> isempty(index)
0954                 paramNum = -1;
0955             <span class="keyword">else</span>
0956                 paramNum = find(index);
0957             <span class="keyword">end</span>
0958         <span class="keyword">end</span>
0959         
0960         <span class="comment">% Display methods</span>
0961         <a name="_sub54" href="#_subfunctions" class="code">function group = getPropertyGroup1(obj)</a>
0962             <span class="comment">% Initial Parameters at the start of the class</span>
0963             masterPropList = struct(<span class="string">'ModelType'</span>,{obj.ModelType},<span class="keyword">...</span>
0964                 <span class="string">'experimentName'</span>,{obj.experimentName},<span class="keyword">...</span>
0965                 <span class="string">'Geometry'</span>, obj.Geometry);
0966             
0967             <span class="keyword">if</span> isscalar(obj)
0968                 group = matlab.mixin.util.PropertyGroup(masterPropList);
0969             <span class="keyword">else</span>
0970                 group = <a href="#_sub55" class="code" title="subfunction group = getPropertyGroup1(obj)">getPropertyGroup1</a>@matlab.mixin.CustomDisplay(obj);
0971             <span class="keyword">end</span>
0972         <span class="keyword">end</span>
0973         
0974         <a name="_sub55" href="#_subfunctions" class="code">function displayScalarObject(obj)</a>
0975             <span class="comment">% Display the whole class. Call the display methods for</span>
0976             <span class="comment">% the sub-classes where appropriate</span>
0977             
0978             <span class="comment">% There are two versions, depending on whether the model</span>
0979             <span class="comment">% is standard layers or custom, the difference being</span>
0980             <span class="comment">% the display of the layers table..</span>
0981             
0982             <span class="comment">% Display initial properties</span>
0983             startProps = <a href="#_sub55" class="code" title="subfunction group = getPropertyGroup1(obj)">getPropertyGroup1</a>(obj);
0984             matlab.mixin.CustomDisplay.displayPropertyGroups(obj,startProps);
0985             
0986             <span class="comment">% Display the parameters table</span>
0987             fprintf(<span class="string">'\n    Parameters: ---------------------------------------------------------------------------------------------- \n\n'</span>);
0988             obj.parameters.displayParametersTable;
0989             
0990             <span class="comment">% Display the layers table if not a custom model</span>
0991             val = obj.ModelType;
0992             <span class="keyword">if</span> ~any(strcmpi(val,{<span class="string">'custom layers'</span>,<span class="string">'custom xy'</span>}))
0993                 fprintf(<span class="string">'\n    Layers: -------------------------------------------------------------------------------------------------- \n\n'</span>);
0994                 obj.layers.displayLayersTable;
0995             <span class="keyword">end</span>
0996             
0997             <span class="comment">% Display the Bulk In table</span>
0998             fprintf(<span class="string">'\n    Bulk In: -------------------------------------------------------------------------------------------------- \n\n'</span>);
0999             obj.bulkIn.displayParametersTable;
1000             
1001             <span class="comment">% Display the Bulk Out table</span>
1002             fprintf(<span class="string">'\n    Bulk Out: ------------------------------------------------------------------------------------------------- \n\n'</span>);
1003             obj.bulkOut.displayParametersTable;
1004             
1005             <span class="comment">% Display the Scalefactors table</span>
1006             fprintf(<span class="string">'\n    Scalefactors: ------------------------------------------------------------------------------------------------- \n\n'</span>);
1007             obj.scalefactors.displayParametersTable;
1008 
1009             <span class="comment">% Display the backgrounds object</span>
1010             obj.background.displayBackgroundsObject;
1011             
1012             <span class="comment">% Display the resolutions object</span>
1013             obj.resolution.displayResolutionsObject;
1014             
1015             <span class="comment">% Display the data object</span>
1016             obj.data.displayDataObject;
1017             
1018             <span class="comment">% Display custome files object</span>
1019             obj.customFile.displayCustomFileObject;
1020             
1021             <span class="comment">% Display the contrasts object</span>
1022             obj.contrasts.displayContrastsObject;
1023             
1024         <span class="keyword">end</span>
1025         
1026         
1027     <span class="keyword">end</span>
1028     
1029 <span class="keyword">end</span>
1030 
</pre></div>

<hr><address>Generated on Tue 07-Feb-2023 09:42:39 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>

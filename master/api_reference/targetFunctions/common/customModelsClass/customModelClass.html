<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of customModelClass</title>
  <meta name="keywords" content="customModelClass">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # targetFunctions -->
<!-- # common -->
<!-- menu.html customModelsClass -->

<h1>customModelClass
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../targetFunctions/common/backSort/backSort.html" class="code" title="function [backg,qshift,sf,nba,nbs,resol] = backSort(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res)">backSort</a>	Distributes the background and shift values among the different contrasts</li>
<li><a href="../../../targetFunctions/common/callCustomFunction/callCppFunction/callCppFunc.html" class="code" title="function [output,subRough] = callCppFunc(params, nba, nbs, contrast, domain, pointer)">callCppFunc</a>	</li>
<li><a href="../../../targetFunctions/common/callCustomFunction/callMatlabFunction/callMatlabCustomFunction.html" class="code" title="function [output,sRough] = callMatlabCustomFunction(params, contrast, funcName, bulkIn, bulkOut, nContrasts, domainNumber)">callMatlabCustomFunction</a>	Excecute a custom model function in the base Matlab workspace.</li>
<li><a href="applyHydrationImag.html" class="code" title="function thisContrastLayers = applyHydrationImag(thisContrastLayers,bulkIn,bulkOut)">applyHydrationImag</a>	Applies the hydration correction to real value of layers</li>
<li><a href="applyHydrationReal.html" class="code" title="function thisContrastLayers = applyHydrationReal(thisContrastLayers,bulkIn,bulkOut)">applyHydrationReal</a>	Applies the hydration correction to real value of layers</li>
<li><a href="customModelClass.html" class="code" title="">customModelClass</a>	</li>
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="customModelClass.html" class="code" title="">customModelClass</a>	</li>
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [allLayers,allRoughs] = processCustomLayers(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,</a></li>
<li><a href="#_sub2" class="code">functionHandle = customFiles{cCustFiles(i)};</a></li>
<li><a href="#_sub3" class="code">function [allSLDs,allRoughs] = processCustomXY(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,</a></li>
<li><a href="#_sub4" class="code">functionHandle = customFiles{cCustFiles(i)};</a></li>
<li><a href="#_sub5" class="code">function [allLayers,allRoughs] = processCustomLayersDomains(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,</a></li>
<li><a href="#_sub6" class="code">functionHandle = customFiles{cCustFiles(i)};</a></li>
<li><a href="#_sub7" class="code">function [allSLDs,allRoughs] = processCustomXYDomains(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,</a></li>
<li><a href="#_sub8" class="code">functionHandle = customFiles{cCustFiles(i)};</a></li>
</ul>


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="customModelClass.html" class="code" title="">customModelClass</a> &lt; handle
0002 
0003     <span class="comment">% A general class containing methods for running user defined custom</span>
0004     <span class="comment">% models. This version contains direct calls to the base Matlab</span>
0005 
0006     properties
0007 
0008     <span class="keyword">end</span>
0009 
0010     methods (Static)
0011 
0012         <a name="_sub0" href="#_subfunctions" class="code">function [allLayers,allRoughs] = processCustomLayers(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,</a><span class="keyword">...</span>
0013                 shifts,sf,nba,nbs,res,cCustFiles,numberOfContrasts,customFiles,params,useImaginary)
0014 
0015             <span class="comment">% Top-level function for processing custom layers for all the</span>
0016             <span class="comment">% contrasts.</span>
0017 
0018             <span class="comment">% Do some pre-definitions to keep the compiler happy...</span>
0019             tempAllLayers = cell(numberOfContrasts,1);
0020             allLayers = cell(numberOfContrasts,1);
0021             allRoughs = zeros(numberOfContrasts,1);
0022 
0023             <span class="keyword">for</span> i = 1:numberOfContrasts
0024                 allLayers{i} = [1 , 1];    <span class="comment">% Type def as double (size not important)</span>
0025                 tempAllLayers{i} = [0 0 0 0 0];
0026             <span class="keyword">end</span>
0027             coder.varsize(<span class="string">'tempAllLayers{:}'</span>,[10000 6],[1 1]);
0028 
0029 
0030             <span class="keyword">for</span> i = 1:numberOfContrasts     <span class="comment">% TODO - the ambition is for parfor here, but would fail for Matlab and Python CM's..</span>
0031 
0032                 <span class="comment">% Choose which custom file is associated with this contrast</span>
0033                 <a name="_sub1" href="#_subfunctions" class="code">functionHandle = customFiles{cCustFiles(i)};</a>
0034 
0035                 <span class="comment">% Find values of 'bulkIn' and 'bulkOut' for this</span>
0036                 <span class="comment">% contrast...</span>
0037                 [~,~,~,bulkIn,bulkOut,~] = <a href="../../../targetFunctions/common/backSort/backSort.html" class="code" title="function [backg,qshift,sf,nba,nbs,resol] = backSort(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res)">backSort</a>(cBacks(i),cShifts(i),cScales(i),cNbas(i),cNbss(i),cRes(i),backs,shifts,sf,nba,nbs,res);
0038 
0039                 thisContrastLayers = [1 1 1]; <span class="comment">% typeDef</span>
0040                 coder.varsize(<span class="string">'thisContrastLayers'</span>,[10000, 6],[1 1]);
0041 
0042                 <span class="keyword">if</span> isnan(str2double(functionHandle))
0043                     [thisContrastLayers,allRoughs(i)] = <a href="../../../targetFunctions/common/callCustomFunction/callMatlabFunction/callMatlabCustomFunction.html" class="code" title="function [output,sRough] = callMatlabCustomFunction(params, contrast, funcName, bulkIn, bulkOut, nContrasts, domainNumber)">callMatlabCustomFunction</a>(params,i,functionHandle,bulkIn,bulkOut,numberOfContrasts,0);
0044                 <span class="keyword">else</span>
0045                     [thisContrastLayers, allRoughs(i)] = <a href="../../../targetFunctions/common/callCustomFunction/callCppFunction/callCppFunc.html" class="code" title="function [output,subRough] = callCppFunc(params, nba, nbs, contrast, domain, pointer)">callCppFunc</a>(params, bulkIn, bulkOut, i, -1, functionHandle);
0046                 <span class="keyword">end</span>
0047 
0048                 <span class="comment">% If the output layers has 5 columns, then we need to do</span>
0049                 <span class="comment">% the hydration correction (the user has not done it in the</span>
0050                 <span class="comment">% custom function). Do that here....</span>
0051                 <span class="keyword">if</span> ~useImaginary
0052                    thisContrastLayers = <a href="applyHydrationReal.html" class="code" title="function thisContrastLayers = applyHydrationReal(thisContrastLayers,bulkIn,bulkOut)">applyHydrationReal</a>(thisContrastLayers,bulkIn,bulkOut);
0053                 <span class="keyword">else</span>
0054                    thisContrastLayers = <a href="applyHydrationImag.html" class="code" title="function thisContrastLayers = applyHydrationImag(thisContrastLayers,bulkIn,bulkOut)">applyHydrationImag</a>(thisContrastLayers,bulkIn,bulkOut);
0055                 <span class="keyword">end</span>
0056 
0057                 tempAllLayers{i} = thisContrastLayers;
0058             <span class="keyword">end</span>
0059 
0060             allLayers = tempAllLayers;
0061 
0062         <span class="keyword">end</span>
0063 
0064         <a name="_sub2" href="#_subfunctions" class="code">function [allSLDs,allRoughs] = processCustomXY(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,</a><span class="keyword">...</span>
0065                 shifts,sf,nba,nbs,res,cCustFiles,numberOfContrasts,customFiles,params)
0066 
0067             <span class="comment">% Top-level function for processing custom XY profiles for all the</span>
0068             <span class="comment">% contrasts.</span>
0069 
0070             <span class="comment">% Do some pre-definitions to keep the compiler happy...</span>
0071             tempAllSLDs = cell(numberOfContrasts,1);
0072             allSLDs = cell(numberOfContrasts,1);
0073             allRoughs = zeros(numberOfContrasts,1);
0074 
0075             <span class="keyword">for</span> i = 1:numberOfContrasts
0076                 allSLDs{i} = [1,1];    <span class="comment">% Type def as double (size not important)</span>
0077                 tempAllSLDs{i} = [0 0];
0078             <span class="keyword">end</span>
0079             coder.varsize(<span class="string">'tempAllSLDs{:}'</span>,[10000 3],[1 1]);    <span class="comment">% 3 columns to allow for potential imaginary curve</span>
0080 
0081             <span class="keyword">for</span> i = 1:numberOfContrasts     <span class="comment">% TODO - the ambition is for parfor here, but would fail for Matlab and Python CM's..</span>
0082 
0083                 <span class="comment">% Choose which custom file is associated with this contrast</span>
0084                 <a name="_sub3" href="#_subfunctions" class="code">functionHandle = customFiles{cCustFiles(i)};</a>
0085 
0086                 <span class="comment">% Find values of 'bulkIn' and 'bulkOut' for this</span>
0087                 <span class="comment">% contrast...</span>
0088                 [~,~,~,bulkIn,bulkOut,~] = <a href="../../../targetFunctions/common/backSort/backSort.html" class="code" title="function [backg,qshift,sf,nba,nbs,resol] = backSort(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res)">backSort</a>(cBacks(i),cShifts(i),cScales(i),cNbas(i),cNbss(i),cRes(i),backs,shifts,sf,nba,nbs,res);
0089 
0090                 <span class="keyword">if</span> isnan(str2double(functionHandle))
0091                     [tempAllSLDs{i}, allRoughs(i)] = <a href="../../../targetFunctions/common/callCustomFunction/callMatlabFunction/callMatlabCustomFunction.html" class="code" title="function [output,sRough] = callMatlabCustomFunction(params, contrast, funcName, bulkIn, bulkOut, nContrasts, domainNumber)">callMatlabCustomFunction</a>(params,i,functionHandle,bulkIn,bulkOut,numberOfContrasts,0);
0092                 <span class="keyword">else</span>
0093                     [tempAllSLDs{i}, allRoughs(i)] = <a href="../../../targetFunctions/common/callCustomFunction/callCppFunction/callCppFunc.html" class="code" title="function [output,subRough] = callCppFunc(params, nba, nbs, contrast, domain, pointer)">callCppFunc</a>(params, bulkIn, bulkOut, i, -1, functionHandle);
0094                 <span class="keyword">end</span>
0095             <span class="keyword">end</span>
0096 
0097             allSLDs = tempAllSLDs;
0098         <span class="keyword">end</span>
0099 
0100         <a name="_sub4" href="#_subfunctions" class="code">function [allLayers,allRoughs] = processCustomLayersDomains(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,</a><span class="keyword">...</span>
0101                 shifts,sf,nba,nbs,res,cCustFiles,numberOfContrasts,customFiles,params,useImaginary)
0102 
0103             <span class="comment">% Top-level function for processing custom layers for all the</span>
0104             <span class="comment">% contrasts.</span>
0105 
0106             <span class="comment">% Do some pre-definitions to keep the compiler happy...</span>
0107             <span class="comment">%totNumCalcs = numberOfContrasts * 2;</span>
0108             tempAllLayers = cell(numberOfContrasts,2);
0109             allLayers = cell(numberOfContrasts,2);
0110             allRoughs = zeros(numberOfContrasts,1);
0111 
0112             <span class="keyword">for</span> i = 1:numberOfContrasts
0113                 allLayers{i,1} = [1 , 1];    <span class="comment">% Type def as double (size not important)</span>
0114                 allLayers{i,2} = [1 , 1];
0115                 tempAllLayers{i,1} = [0 0 0 0 0];
0116                 tempAllLayers{i,2} = [0 0 0 0 0];
0117             <span class="keyword">end</span>
0118             coder.varsize(<span class="string">'tempAllLayers{:}'</span>,[10000 6],[1 1]);
0119             coder.varsize(<span class="string">'allLayers{:}'</span>,[10000 6],[1 1]);
0120 
0121             <span class="keyword">for</span> i = 1:numberOfContrasts
0122 
0123                 <span class="comment">% Choose which custom file is associated with this contrast</span>
0124                 <a name="_sub5" href="#_subfunctions" class="code">functionHandle = customFiles{cCustFiles(i)};</a>
0125 
0126                 <span class="comment">% Find values of 'bulkIn' and 'bulkOut' for this</span>
0127                 <span class="comment">% contrast...</span>
0128                 [~,~,~,bulkIn,bulkOut,~] = <a href="../../../targetFunctions/common/backSort/backSort.html" class="code" title="function [backg,qshift,sf,nba,nbs,resol] = backSort(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res)">backSort</a>(cBacks(i),cShifts(i),cScales(i),cNbas(i),<span class="keyword">...</span>
0129                     cNbss(i),cRes(i),backs,shifts,sf,nba,nbs,res);
0130 
0131                 thisContrastLayers1 = [1 1 1]; <span class="comment">% typeDef</span>
0132                 coder.varsize(<span class="string">'thisContrastLayers1'</span>,[10000, 6],[1 1]);
0133 
0134                 thisContrastLayers2 = [1 1 1]; <span class="comment">% typeDef</span>
0135                 coder.varsize(<span class="string">'thisContrastLayers2'</span>,[10000, 6],[1 1]);
0136 
0137                 <span class="keyword">if</span> isnan(str2double(functionHandle))
0138                     [thisContrastLayers1, allRoughs(i)] = <a href="../../../targetFunctions/common/callCustomFunction/callMatlabFunction/callMatlabCustomFunction.html" class="code" title="function [output,sRough] = callMatlabCustomFunction(params, contrast, funcName, bulkIn, bulkOut, nContrasts, domainNumber)">callMatlabCustomFunction</a>(params,i,functionHandle,bulkIn,bulkOut,numberOfContrasts,1);
0139                     [thisContrastLayers2, ~] = <a href="../../../targetFunctions/common/callCustomFunction/callMatlabFunction/callMatlabCustomFunction.html" class="code" title="function [output,sRough] = callMatlabCustomFunction(params, contrast, funcName, bulkIn, bulkOut, nContrasts, domainNumber)">callMatlabCustomFunction</a>(params,i,functionHandle,bulkIn,bulkOut,numberOfContrasts,2);
0140                 <span class="keyword">else</span>
0141                     [thisContrastLayers1, allRoughs(i)] = <a href="../../../targetFunctions/common/callCustomFunction/callCppFunction/callCppFunc.html" class="code" title="function [output,subRough] = callCppFunc(params, nba, nbs, contrast, domain, pointer)">callCppFunc</a>(params, bulkIn, bulkOut, i, 0, functionHandle);
0142                     [thisContrastLayers2, ~] = <a href="../../../targetFunctions/common/callCustomFunction/callCppFunction/callCppFunc.html" class="code" title="function [output,subRough] = callCppFunc(params, nba, nbs, contrast, domain, pointer)">callCppFunc</a>(params, bulkIn, bulkOut, i, 1, functionHandle);
0143                 <span class="keyword">end</span>
0144 
0145                 <span class="comment">% If the output layers has 5 columns, then we need to do</span>
0146                 <span class="comment">% the hydration correction (the user has not done it in the</span>
0147                 <span class="comment">% custom function). Do that here....</span>
0148                 <span class="keyword">if</span> ~useImaginary
0149                    thisContrastLayers1 = <a href="applyHydrationReal.html" class="code" title="function thisContrastLayers = applyHydrationReal(thisContrastLayers,bulkIn,bulkOut)">applyHydrationReal</a>(thisContrastLayers1,bulkIn,bulkOut);
0150                    thisContrastLayers2 = <a href="applyHydrationReal.html" class="code" title="function thisContrastLayers = applyHydrationReal(thisContrastLayers,bulkIn,bulkOut)">applyHydrationReal</a>(thisContrastLayers2,bulkIn,bulkOut);
0151                 <span class="keyword">else</span>
0152                    thisContrastLayers1 = <a href="applyHydrationImag.html" class="code" title="function thisContrastLayers = applyHydrationImag(thisContrastLayers,bulkIn,bulkOut)">applyHydrationImag</a>(thisContrastLayers1,bulkIn,bulkOut);
0153                    thisContrastLayers2 = <a href="applyHydrationImag.html" class="code" title="function thisContrastLayers = applyHydrationImag(thisContrastLayers,bulkIn,bulkOut)">applyHydrationImag</a>(thisContrastLayers2,bulkIn,bulkOut);
0154                 <span class="keyword">end</span>
0155 
0156                 tempAllLayers{i,1} = thisContrastLayers1;
0157                 tempAllLayers{i,2} = thisContrastLayers2;
0158             <span class="keyword">end</span>
0159         
0160             allLayers = tempAllLayers;
0161 
0162         <span class="keyword">end</span>
0163 
0164         <a name="_sub6" href="#_subfunctions" class="code">function [allSLDs,allRoughs] = processCustomXYDomains(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,</a><span class="keyword">...</span>
0165                 shifts,sf,nba,nbs,res,cCustFiles,numberOfContrasts,customFiles,params)
0166 
0167             <span class="comment">% Top-level function for processing custom XY profiles for all the</span>
0168             <span class="comment">% contrasts.</span>
0169 
0170             <span class="comment">% Do some pre-definitions to keep the compiler happy...</span>
0171             tempAllSLDs = cell(numberOfContrasts,2);
0172             allSLDs = cell(numberOfContrasts,2);
0173             allRoughs = zeros(numberOfContrasts,1);
0174 
0175             <span class="keyword">for</span> i = 1:numberOfContrasts
0176                 allSLDs{i,1} = [1,1];    <span class="comment">% Type def as double (size not important)</span>
0177                 allSLDs{i,2} = [1,1];
0178                 tempAllSLDs{i,1} = [0 0];
0179                 tempAllSLDs{i,2} = [0 0];
0180             <span class="keyword">end</span>
0181             coder.varsize(<span class="string">'tempAllSLDs{:}'</span>,[10000 3],[1 1]);    <span class="comment">% 3 columns to allow for potential imaginary curve</span>
0182 
0183             <span class="keyword">for</span> i = 1:numberOfContrasts     <span class="comment">% TODO - the ambition is for parfor here, but would fail for Matlab and Python CM's..</span>
0184 
0185                 <span class="comment">% Choose which custom file is associated with this contrast</span>
0186                 <a name="_sub7" href="#_subfunctions" class="code">functionHandle = customFiles{cCustFiles(i)};</a>
0187 
0188                 <span class="comment">% Find values of 'bulkIn' and 'bulkOut' for this contrast...</span>
0189                 [~,~,~,bulkIn,bulkOut,~] = <a href="../../../targetFunctions/common/backSort/backSort.html" class="code" title="function [backg,qshift,sf,nba,nbs,resol] = backSort(cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res)">backSort</a>(cBacks(i),cShifts(i),cScales(i),cNbas(i),cNbss(i),cRes(i),backs,shifts,sf,nba,nbs,res);
0190 
0191                 <span class="keyword">if</span> isnan(str2double(functionHandle))
0192                     [tempAllSLDs{i, 1}, allRoughs(i)] = <a href="../../../targetFunctions/common/callCustomFunction/callMatlabFunction/callMatlabCustomFunction.html" class="code" title="function [output,sRough] = callMatlabCustomFunction(params, contrast, funcName, bulkIn, bulkOut, nContrasts, domainNumber)">callMatlabCustomFunction</a>(params,i,functionHandle,bulkIn,bulkOut,numberOfContrasts,1);
0193                     [tempAllSLDs{i, 2}, ~] = <a href="../../../targetFunctions/common/callCustomFunction/callMatlabFunction/callMatlabCustomFunction.html" class="code" title="function [output,sRough] = callMatlabCustomFunction(params, contrast, funcName, bulkIn, bulkOut, nContrasts, domainNumber)">callMatlabCustomFunction</a>(params,i,functionHandle,bulkIn,bulkOut,numberOfContrasts,2);
0194                 <span class="keyword">else</span>
0195                     [tempAllSLDs{i, 1}, allRoughs(i)] = <a href="../../../targetFunctions/common/callCustomFunction/callCppFunction/callCppFunc.html" class="code" title="function [output,subRough] = callCppFunc(params, nba, nbs, contrast, domain, pointer)">callCppFunc</a>(params, bulkIn, bulkOut, i, 0, functionHandle);
0196                     [tempAllSLDs{i, 2}, ~] = <a href="../../../targetFunctions/common/callCustomFunction/callCppFunction/callCppFunc.html" class="code" title="function [output,subRough] = callCppFunc(params, nba, nbs, contrast, domain, pointer)">callCppFunc</a>(params, bulkIn, bulkOut, i, 1, functionHandle);
0197                 <span class="keyword">end</span>
0198             <span class="keyword">end</span>
0199 
0200             allSLDs = tempAllSLDs;
0201         <span class="keyword">end</span>
0202         
0203     <span class="keyword">end</span>
0204 <span class="keyword">end</span>
</pre></div>

<hr><address>Generated on Tue 14-Nov-2023 16:00:59 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>

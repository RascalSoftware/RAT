
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Events and Live Updating Plots &#8212; RAT 1.0.0-beta documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/design-tabs.js"></script>
    <link rel="icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Convert between RAT and RasCAL1" href="conversionFuncs.html" />
    <link rel="prev" title="Plotting Bayesian Analysis" href="plotFunsBayes.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.png" alt="Logo" />
    
  </a>
</p>









<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="calcTypes.html">Different Calculation Types</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="utilities.html">Utility Functions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plotFuns.html">Basic Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotFunsBayes.html">Plotting Bayesian Analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Events and Live Updating Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="conversionFuncs.html">Convert between RAT and RasCAL1</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>


        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="events-and-live-updating-plots">
<span id="liveplot"></span><h1>Events and Live Updating Plots<a class="headerlink" href="#events-and-live-updating-plots" title="Permalink to this heading">¶</a></h1>
<p>Sometimes it is useful to be able to monitor the progress / success of a fit in real time for long simulations. For Simplex and DE fits, RAT sends out ‘events’, which send out data concerning the
reflectivity, SLD’s and so on as the fit progresses. By writing functions that ‘listen’ to these events, you can use this information to build various kinds of graphical updates to suit your needs.
In this section, we’ll use this capability to build a live, updating plot of reflectivity and SLD, similar to that of the main RasCAL GUI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The code in this section already exists in the repo (utilities / plotting), and you can activate the full updating plot at any time by just typing ‘useLivePlot()’ at the Matlab command window. But we detail it here to illustrate how to interact with events.</p>
</div>
<p><strong>Registering Listeners</strong></p>
<p>On the Matlab side, the interaction with RAT event is via the ‘eventManager’ class. To register a listener, we use the ‘register’ method to associate a function with the event.</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">eventManager</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">eventTypes</span><span class="p">.</span><span class="n">Plot</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;updatePlot&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>In this line, we’ve done two things: we’ve registered a ‘listener’ for ‘Plot’ events, and defined the function ‘updatePlot’ as the function that runs when the event is triggered (known as a ‘handler’)
We need to define the handler function:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">updatePlot</span><span class="p">(</span>varargin<span class="p">)</span>

<span class="w">    </span><span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">figure</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w">                   </span><span class="c">% Select / open the figure</span>

<span class="w">    </span><span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">cla</span><span class="w">                 </span><span class="s">%</span><span class="w"> </span><span class="s">Reflectivity</span><span class="w"> </span><span class="s">plot</span><span class="w"> </span><span class="s">panel</span>
<span class="w">    </span><span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">cla</span><span class="w">                 </span><span class="s">%</span><span class="w"> </span><span class="s">SLD</span><span class="w"> </span><span class="s">plot</span><span class="w"> </span><span class="s">panel</span>
<span class="w">    </span><span class="n">plotRefSLDHelper</span><span class="p">(</span><span class="nb">varargin</span><span class="p">{:});</span><span class="w">      </span><span class="c">% Use the standard RAT reflectivity plot</span>
<span class="w">    </span><span class="nb">drawnow</span><span class="w"> </span><span class="n">limitrate</span><span class="w">                   </span><span class="c">% Make sure it updates</span>

<span class="k">end</span>
</pre></div>
</div>
<p>We can put a breakpoint in our function to examine the contents of varargin</p>
<a class="reference internal image-reference" href="_images/updateBreakPoint.png"><img alt="breakpoint in update function" src="_images/updateBreakPoint.png" style="width: 300px;" /></a>
<p>We see that it’s a struct containing everything needed to make our custom plot:</p>
<a class="reference internal image-reference" href="_images/eventContents.png"><img alt="contents of events" src="_images/eventContents.png" style="width: 300px;" /></a>
<p>In other words, RAT has packaged the current state of the reflectivity and SLD’s, along with a number of other items that you can use to make a plot however you like.
For these purposes, we just make use of the existing RAT plot routine to make our plot. The result is the updating plot routine bundled with RAT.</p>
<p><strong>Frequency of events</strong></p>
<p>To control how often the event is triggered, we set the ‘updatePlotFreq’ parameter in the controls block, which defaults to 20:</p>
<a class="reference internal image-reference" href="_images/updatePlotFreq.png"><img alt="contents of events" src="_images/updatePlotFreq.png" style="width: 300px;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you set the plot frequency too low (i.e. make the plot update too often), this will slow your fit as Matlab takes time out of the analysis to update the figure.
Updating every 20 iterations is a reasonable compromise between speed and utility.</p>
</div>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2022-2024, ISIS Neutron and Muon Source.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 6.2.1</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/livePlot.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>